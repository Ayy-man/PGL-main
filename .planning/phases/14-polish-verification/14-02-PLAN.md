---
phase: 14-polish-verification
plan: 02
type: execute
wave: 2
depends_on: [14-01]
files_modified:
  - .planning/STATE.md
  - .planning/ROADMAP.md
autonomous: true
requirements: [UI-03, UI-05, UI-06]

must_haves:
  truths:
    - "pnpm build exits with code 0 — zero TypeScript errors, zero ESLint errors"
    - "vitest run passes — all existing tests green"
    - "Global design system compliance audit passes all checks with zero violations"
    - "STATE.md and ROADMAP.md updated to mark Phase 14 and v2.0 milestone as complete"
  artifacts:
    - path: ".planning/STATE.md"
      provides: "Updated project state declaring Phase 14 complete"
      contains: "Phase 14 COMPLETE"
    - path: ".planning/ROADMAP.md"
      provides: "Updated roadmap with Phase 14 status"
      contains: "COMPLETE"
  key_links:
    - from: "pnpm build"
      to: "all src/**/*.tsx files"
      via: "TypeScript compiler + ESLint"
      pattern: "exit code 0"
---

<objective>
Run the final build verification, execute the comprehensive design system compliance audit, and update STATE.md + ROADMAP.md to declare Phase 14 and the v2.0 UI Redesign milestone complete.

Purpose: This is the final gate before the UI redesign is considered production-ready. The build must compile clean, all tests must pass, and a comprehensive grep-driven audit must confirm zero design system violations remain.

Output: Clean build, green tests, passing compliance checklist, updated STATE.md and ROADMAP.md.
</objective>

<execution_context>
@/Users/aymanbaig/.claude/get-shit-done/workflows/execute-plan.md
@/Users/aymanbaig/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/14-polish-verification/14-RESEARCH.md
@.planning/phases/14-polish-verification/14-01-PLAN.md
@design-system/MASTER.md

<interfaces>
The compliance audit uses grep commands from the research file (14-RESEARCH.md §Comprehensive Audit Checklist).
All checks must pass with zero violations for Phase 14 to be considered complete.
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build verification and comprehensive design system compliance audit</name>
  <files>(no files modified — audit only)</files>
  <action>
**Step 1: Build verification**

Run `pnpm build` in the project root. The build must exit with code 0. Capture output and confirm:
- Zero TypeScript errors
- Zero ESLint errors (warnings about `img` elements and "Dynamic server usage" messages are expected and acceptable — these are pre-existing informational messages, not errors)

If the build fails, diagnose and fix the issue. Common causes after Phase 14-01 edits:
- Import path typo in new loading.tsx files
- Syntax error in globals.css media query
- TypeScript type mismatch from token changes in lookalike-discovery.tsx

After build passes, run `pnpm vitest run` (or `npx vitest run`). Existing test suite must be green.

**Step 2: Comprehensive design system compliance audit**

Run each grep check from the research file. Document pass/fail for each:

```bash
# Check 1: Raw Tailwind base color classes (zinc, gray, emerald, yellow)
grep -rn "zinc-\|gray-[0-9]\|emerald-\|yellow-" src/ --include="*.tsx" | grep "className" | grep -v "//\|node_modules"
# Expected: 0 results = PASS

# Check 2: Raw semantic colors (red/green/blue) — excluding shadcn toast.tsx internals
grep -rn "bg-red-\|text-red-\|border-red-\|bg-green-\|text-green-\|bg-blue-\|text-blue-" src/ --include="*.tsx" | grep "className" | grep -v "//\|node_modules\|toast\.tsx"
# Expected: 0 results = PASS

# Check 3: Scale transforms on hover (anti-pattern per MASTER.md)
grep -rn "hover:scale" src/ --include="*.tsx" | grep -v "//\|node_modules"
# Expected: 0 results = PASS

# Check 4: prefers-reduced-motion guard present
grep -c "prefers-reduced-motion" src/app/globals.css
# Expected: >= 1 = PASS

# Check 5: font-cormorant class (wrong — must use font-serif)
grep -rn "font-cormorant" src/ --include="*.tsx"
# Expected: 0 results = PASS

# Check 6: All error boundaries have design system buttons (no bg-primary)
grep -c "bg-primary" src/app/global-error.tsx src/app/\[orgId\]/error.tsx src/app/admin/error.tsx
# Expected: all 0 = PASS

# Check 7: Loading.tsx files exist for async route segments
ls src/app/\[orgId\]/loading.tsx src/app/admin/loading.tsx src/app/\[orgId\]/exports/loading.tsx src/app/\[orgId\]/lists/loading.tsx src/app/\[orgId\]/lists/\[listId\]/loading.tsx src/app/\[orgId\]/dashboard/activity/loading.tsx src/app/\[orgId\]/dashboard/analytics/loading.tsx
# Expected: all files exist = PASS

# Check 8: Flat solid hex backgrounds on card containers
grep -rn 'bg-\[#' src/ --include="*.tsx" | grep -v "//\|node_modules\|var("
# Expected: 0 results = PASS (or only results that are inside style={{ }} attributes using CSS variables)

# Check 9: Icon-only buttons without aria-label (spot check)
# Manual verification — confirm prospect-slide-over.tsx, top-bar.tsx, and breadcrumbs.tsx have aria-labels on icon-only buttons
grep -n "aria-label" src/components/prospect/prospect-slide-over.tsx src/components/layout/top-bar.tsx src/components/ui/breadcrumbs.tsx
# Expected: multiple matches per file = PASS
```

Document each check result as PASS/FAIL. If any check fails, fix the violation before proceeding.

**Step 3: Responsive design verification (UI-03)**

This is a code-level spot check, not visual testing (no browser available). Verify responsive patterns are correctly applied:

```bash
# Verify sidebar hidden on mobile
grep -n "hidden lg:flex" src/components/layout/sidebar.tsx src/app/admin/layout.tsx
# Expected: matches confirming sidebar uses hidden lg:flex

# Verify data tables have overflow-x-auto
grep -rn "overflow-x-auto" src/ --include="*.tsx" | grep -i "table\|grid"
# Expected: data table wrappers have overflow-x-auto

# Verify slide-over is full-width on mobile
grep -n "w-full\|sm:max-w" src/components/prospect/prospect-slide-over.tsx
# Expected: Sheet uses responsive width
```

Document results.

If ALL checks pass and build is green, proceed to Task 2.
  </action>
  <verify>
    <automated>cd /Users/aymanbaig/Desktop/Manual\ Library/Phronesis-main && pnpm build 2>&1 | tail -5</automated>
  </verify>
  <done>pnpm build exits 0. vitest run passes. All 9 compliance checks pass. Responsive spot checks confirm correct patterns. Zero design system violations remain.</done>
</task>

<task type="auto">
  <name>Task 2: Update STATE.md and ROADMAP.md to declare Phase 14 and v2.0 complete</name>
  <files>.planning/STATE.md, .planning/ROADMAP.md</files>
  <action>
**STATE.md updates:**

1. Update the frontmatter:
   - `status: complete`
   - `last_updated:` current ISO timestamp
   - `progress.completed_phases: 12` (was 11)
   - `progress.total_plans:` increment by 2 (add 14-01 and 14-02)
   - `progress.completed_plans:` same increment

2. Update `Current focus:` to `Phase 14 (Polish + Verification) — COMPLETE`

3. Update `Current Position` section:
   - Phase: 14 of 14 (Polish + Verification)
   - Plan: 2 of 2 — COMPLETE
   - Status: Phase 14 COMPLETE — All 2 plans executed, design system compliance audit passes, build verified clean
   - Last activity: current date — Phase 14 complete. Cross-cutting audit: prefers-reduced-motion added, raw Tailwind color violations fixed, error boundaries polished, 5 loading.tsx stubs added. Build clean, all compliance checks pass. v2.0 UI Redesign COMPLETE.

4. Update `Session Continuity`:
   - Last session: current date
   - Stopped at: v2.0 UI Redesign milestone complete. All 14 phases (06-14) executed. Next: deploy to Vercel and test with real API keys.

5. Add Phase 14 entry to the Performance Metrics table.

**ROADMAP.md updates:**

1. Update Phase 14 section:
```markdown
### Phase 14: Polish + Verification — COMPLETE

**Goal:** Responsive testing (375/768/1024/1440px), raw Tailwind class audit, surface gradient verification, keyboard nav, empty states, accessibility, build + test pass.

**Dependencies:** Phases 8–13

**Status:** COMPLETE — All 2 plans executed. Global design system audit, accessibility fixes, loading state skeletons, error boundary polish, build verification.

**Plans:** 2/2 complete

Plans:
- [x] 14-01-PLAN.md — Cross-cutting fixes: prefers-reduced-motion, raw color violations, error boundary polish, loading.tsx stubs
- [x] 14-02-PLAN.md — Build verification + comprehensive design system compliance audit + STATE/ROADMAP update
```

2. If a "v2.0 UI Redesign" summary exists at the top of the roadmap, update it to reflect all phases complete.

**Do NOT:**
- Modify any source code files
- Change requirements status (they are already all marked complete in REQUIREMENTS.md)
- Add new phases or future work items
  </action>
  <verify>
    <automated>cd /Users/aymanbaig/Desktop/Manual\ Library/Phronesis-main && grep -c "Phase 14 COMPLETE" .planning/STATE.md && grep -c "COMPLETE" .planning/ROADMAP.md | tail -1</automated>
  </verify>
  <done>STATE.md declares Phase 14 complete with updated metrics. ROADMAP.md shows Phase 14 as COMPLETE with plan checklist. v2.0 milestone documentation is finalized.</done>
</task>

</tasks>

<verification>
1. `pnpm build` exits with code 0
2. `vitest run` passes (all existing tests green)
3. All 9 design system compliance checks pass with zero violations
4. STATE.md contains "Phase 14 COMPLETE"
5. ROADMAP.md Phase 14 section shows "COMPLETE" with plan checklist
6. Responsive code patterns verified (hidden lg:flex, overflow-x-auto, responsive widths)
</verification>

<success_criteria>
- Build compiles clean (zero errors)
- Test suite passes
- All compliance audit checks pass
- STATE.md and ROADMAP.md updated to reflect Phase 14 and v2.0 completion
- No functional regressions from Phase 14 changes
</success_criteria>

<output>
After completion, create `.planning/phases/14-polish-verification/14-02-SUMMARY.md`
</output>
