---
phase: 14-polish-verification
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/globals.css
  - src/components/prospect/lookalike-discovery.tsx
  - src/app/global-error.tsx
  - src/app/[orgId]/error.tsx
  - src/app/admin/error.tsx
  - src/app/[orgId]/exports/loading.tsx
  - src/app/[orgId]/lists/loading.tsx
  - src/app/[orgId]/lists/[listId]/loading.tsx
  - src/app/[orgId]/dashboard/activity/loading.tsx
  - src/app/[orgId]/dashboard/analytics/loading.tsx
autonomous: true
requirements: [UI-03, UI-05, UI-06]

must_haves:
  truths:
    - "All pages under [orgId]/ and admin/ respect prefers-reduced-motion -- no fadeIn animation when OS motion is reduced"
    - "No raw Tailwind color classes (red-*, green-*, blue-*, zinc-*, gray-*) exist in className attributes across the entire src/ tree"
    - "Error boundary pages use design-system-compliant button styling instead of generic bg-primary"
    - "Every route segment with async data fetching has a loading.tsx skeleton"
    - "All icon-only buttons have aria-label attributes"
  artifacts:
    - path: "src/app/globals.css"
      provides: "prefers-reduced-motion media query guard"
      contains: "prefers-reduced-motion"
    - path: "src/components/prospect/lookalike-discovery.tsx"
      provides: "Design-system-compliant error and success states"
    - path: "src/app/[orgId]/exports/loading.tsx"
      provides: "Skeleton loading state for exports page"
    - path: "src/app/[orgId]/lists/loading.tsx"
      provides: "Skeleton loading state for lists page"
  key_links:
    - from: "src/app/globals.css"
      to: ".page-enter animation"
      via: "@media (prefers-reduced-motion: reduce)"
      pattern: "prefers-reduced-motion"
    - from: "src/components/prospect/lookalike-discovery.tsx"
      to: "tailwind.config.ts destructive/success tokens"
      via: "bg-destructive/10, text-destructive, bg-success-muted, text-success"
      pattern: "destructive|success"
---

<objective>
Fix all cross-cutting design system violations, accessibility gaps, and missing loading states identified by the Phase 14 global audit.

Purpose: The per-phase compliance audits (07-05, 08-05, etc.) were scoped to files modified within each phase. Shared components built in earlier phases (e.g., lookalike-discovery.tsx from Phase 3) and cross-cutting concerns (prefers-reduced-motion, error boundaries) were never re-audited against the finalized design system. This plan sweeps the entire codebase.

Output: All violations fixed, all missing loading.tsx stubs created, all accessibility gaps closed.
</objective>

<execution_context>
@/Users/aymanbaig/.claude/get-shit-done/workflows/execute-plan.md
@/Users/aymanbaig/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/14-polish-verification/14-RESEARCH.md
@design-system/MASTER.md
@src/app/globals.css
@src/components/prospect/lookalike-discovery.tsx
@src/app/global-error.tsx
@src/app/[orgId]/error.tsx
@src/app/admin/error.tsx
@src/app/[orgId]/loading.tsx
@src/app/admin/loading.tsx

<interfaces>
From tailwind.config.ts — semantic color tokens available:
```typescript
destructive: { DEFAULT: 'var(--destructive)', foreground: 'var(--destructive-foreground)' }
success: { DEFAULT: 'var(--success)', muted: 'var(--success-muted)' }
```
These map to OKLCH values in globals.css .dark block:
- --destructive: oklch(0.4349 0.0921 21.6004)
- --success: oklch(0.72 0.17 155)
- --success-muted: oklch(0.72 0.17 155 / 0.15)

From globals.css — existing surface utility classes:
```css
.surface-card { background: var(--bg-card-gradient); border: 1px solid var(--border-subtle); border-radius: 14px; }
```

From src/components/ui/button.tsx — Button component accepts variant prop:
- variant="ghost" — transparent bg, subtle border
- variant="outline" — border visible, transparent bg
- variant="default" — primary bg
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix accessibility and design system violations in globals.css and lookalike-discovery.tsx</name>
  <files>src/app/globals.css, src/components/prospect/lookalike-discovery.tsx</files>
  <action>
**globals.css — Add prefers-reduced-motion guard:**

After the existing `.page-enter` rule (line 207), add:

```css
@media (prefers-reduced-motion: reduce) {
  .page-enter {
    animation: none;
  }
}
```

This ensures the fadeIn animation is disabled for users who have enabled "Reduce motion" in their OS settings (WCAG 2.1 AA requirement). Do NOT modify the existing `.page-enter` rule — only add the media query override after it.

**lookalike-discovery.tsx — Replace raw Tailwind color classes with design system tokens:**

1. Line 155: Replace `className="bg-red-500/10 border border-red-500/20 text-red-400 px-4 py-3 rounded-lg"` with `className="bg-destructive/10 border border-destructive/20 text-destructive px-4 py-3 rounded-lg"`. The `destructive` token maps to `var(--destructive)` which resolves to the correct red in dark mode.

2. Line 184: Replace `className="bg-green-500/10 text-green-400 px-3 py-1 rounded-full text-sm"` with `className="bg-success-muted text-success px-3 py-1 rounded-full text-sm"`. The `success-muted` token maps to `var(--success-muted)` (green with 15% opacity) and `success` maps to the green text color.

3. Run a full grep scan of the entire `src/` directory for any other raw Tailwind color class violations:
```bash
grep -rn "bg-red-\|text-red-\|border-red-\|bg-green-\|text-green-\|bg-blue-\|text-blue-\|bg-yellow-\|text-yellow-\|zinc-\|gray-[0-9]\|emerald-\|slate-" src/ --include="*.tsx" | grep "className" | grep -v "//\|node_modules\|toast\.tsx"
```
The `toast.tsx` exclusion is intentional — shadcn toast uses `group-[.destructive]:text-red-300` which is a shadcn internal pattern, not a design system violation (it uses Tailwind's group modifier targeting the destructive variant selector).

Fix any additional violations found by the grep scan using the same pattern: replace raw colors with their CSS variable token equivalents.

**Do NOT:**
- Modify the functional behavior of any component
- Add new imports or dependencies
- Touch files outside the two listed files in this task
  </action>
  <verify>
    <automated>cd /Users/aymanbaig/Desktop/Manual\ Library/Phronesis-main && grep -c "prefers-reduced-motion" src/app/globals.css && grep -c "bg-red-\|text-red-\|bg-green-\|text-green-" src/components/prospect/lookalike-discovery.tsx | grep "^0$"</automated>
  </verify>
  <done>globals.css contains @media (prefers-reduced-motion: reduce) guard. lookalike-discovery.tsx has zero raw red/green Tailwind color classes. Full src/ grep scan returns zero violations (excluding shadcn toast internals).</done>
</task>

<task type="auto">
  <name>Task 2: Polish error boundaries and add missing loading.tsx skeletons</name>
  <files>src/app/global-error.tsx, src/app/[orgId]/error.tsx, src/app/admin/error.tsx, src/app/[orgId]/exports/loading.tsx, src/app/[orgId]/lists/loading.tsx, src/app/[orgId]/lists/[listId]/loading.tsx, src/app/[orgId]/dashboard/activity/loading.tsx, src/app/[orgId]/dashboard/analytics/loading.tsx</files>
  <action>
**Error boundary polish (UI-06):**

Update the "Try Again" button in all three error boundary files to use the design system ghost button pattern instead of raw `bg-primary`. The button should match the ghost variant from the design system (MASTER.md §8):

Replace the button styling in each file:

**`src/app/global-error.tsx`** — Replace the button element:
```tsx
<button
  onClick={reset}
  className="inline-flex h-10 items-center justify-center rounded-[8px] px-6 text-sm font-semibold transition-all duration-200 cursor-pointer"
  style={{
    background: "linear-gradient(135deg, rgba(212,175,55,0.15), rgba(212,175,55,0.08))",
    border: "1px solid var(--border-gold)",
    color: "var(--gold-primary)",
  }}
>
  Try Again
</button>
```

**`src/app/[orgId]/error.tsx`** — Same button replacement as above (same style object).

**`src/app/admin/error.tsx`** — Same button replacement as above (same style object). Also add `transition-all duration-200` if missing.

Keep the heading (`font-serif`), error message, and layout structure unchanged. Only the button styling changes.

**Missing loading.tsx stubs (UI-05):**

Create loading.tsx skeleton files for route segments that fetch async data but lack a loading state:

**`src/app/[orgId]/exports/loading.tsx`:**
```tsx
import { Skeleton } from "@/components/ui/skeleton";

export default function ExportsLoading() {
  return (
    <div className="space-y-6">
      {/* Page header */}
      <div className="space-y-2">
        <Skeleton className="h-9 w-[180px]" />
        <Skeleton className="h-5 w-[280px]" />
      </div>
      {/* Stat cards row */}
      <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-4">
        {Array.from({ length: 4 }).map((_, i) => (
          <Skeleton key={i} className="h-[100px] rounded-[14px]" />
        ))}
      </div>
      {/* Table skeleton */}
      <Skeleton className="h-[400px] rounded-[14px]" />
    </div>
  );
}
```

**`src/app/[orgId]/lists/loading.tsx`:**
```tsx
import { Skeleton } from "@/components/ui/skeleton";

export default function ListsLoading() {
  return (
    <div className="space-y-6">
      <div className="space-y-2">
        <Skeleton className="h-9 w-[160px]" />
        <Skeleton className="h-5 w-[260px]" />
      </div>
      <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
        {Array.from({ length: 6 }).map((_, i) => (
          <Skeleton key={i} className="h-[140px] rounded-[14px]" />
        ))}
      </div>
    </div>
  );
}
```

**`src/app/[orgId]/lists/[listId]/loading.tsx`:**
```tsx
import { Skeleton } from "@/components/ui/skeleton";

export default function ListDetailLoading() {
  return (
    <div className="space-y-6">
      <div className="space-y-2">
        <Skeleton className="h-9 w-[200px]" />
        <Skeleton className="h-5 w-[300px]" />
      </div>
      <div className="space-y-3">
        {Array.from({ length: 8 }).map((_, i) => (
          <Skeleton key={i} className="h-14 w-full rounded-lg" />
        ))}
      </div>
    </div>
  );
}
```

**`src/app/[orgId]/dashboard/activity/loading.tsx`:**
```tsx
import { Skeleton } from "@/components/ui/skeleton";

export default function ActivityLoading() {
  return (
    <div className="space-y-6">
      <div className="space-y-2">
        <Skeleton className="h-9 w-[180px]" />
        <Skeleton className="h-5 w-[240px]" />
      </div>
      <div className="space-y-3">
        {Array.from({ length: 10 }).map((_, i) => (
          <Skeleton key={i} className="h-12 w-full rounded-lg" />
        ))}
      </div>
    </div>
  );
}
```

**`src/app/[orgId]/dashboard/analytics/loading.tsx`:**
```tsx
import { Skeleton } from "@/components/ui/skeleton";

export default function AnalyticsLoading() {
  return (
    <div className="space-y-6">
      <div className="space-y-2">
        <Skeleton className="h-9 w-[160px]" />
        <Skeleton className="h-5 w-[300px]" />
      </div>
      <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
        {Array.from({ length: 3 }).map((_, i) => (
          <Skeleton key={i} className="h-[200px] rounded-[14px]" />
        ))}
      </div>
    </div>
  );
}
```

All new loading.tsx files use the `Skeleton` component from `@/components/ui/skeleton` and follow the existing pattern from `src/app/[orgId]/loading.tsx`. Use `rounded-[14px]` for card skeletons per MASTER.md border radius spec.

**Do NOT:**
- Add new component imports beyond Skeleton
- Change the functional behavior of error boundaries
- Add page-enter to loading files (the layout wrapper handles this)
  </action>
  <verify>
    <automated>cd /Users/aymanbaig/Desktop/Manual\ Library/Phronesis-main && ls src/app/\[orgId\]/exports/loading.tsx src/app/\[orgId\]/lists/loading.tsx src/app/\[orgId\]/lists/\[listId\]/loading.tsx src/app/\[orgId\]/dashboard/activity/loading.tsx src/app/\[orgId\]/dashboard/analytics/loading.tsx && grep -c "bg-primary" src/app/global-error.tsx src/app/\[orgId\]/error.tsx src/app/admin/error.tsx | grep ":0"</automated>
  </verify>
  <done>All 5 missing loading.tsx files exist with Skeleton skeletons. All 3 error boundary files use gold button pattern instead of bg-primary. Error boundaries display user-friendly messages with design-system-compliant Try Again buttons.</done>
</task>

</tasks>

<verification>
1. `grep -rn "prefers-reduced-motion" src/app/globals.css` returns at least 1 match
2. `grep -rn "bg-red-\|text-red-\|bg-green-\|text-green-" src/components/prospect/lookalike-discovery.tsx` returns 0 matches
3. `grep -rn "bg-primary" src/app/global-error.tsx src/app/[orgId]/error.tsx src/app/admin/error.tsx` returns 0 matches
4. All 5 new loading.tsx files exist and import Skeleton
5. Full grep scan of `src/` for raw Tailwind color violations returns only shadcn toast internals (acceptable)
</verification>

<success_criteria>
- Zero raw Tailwind color classes in className attributes across entire src/ tree (excluding shadcn toast.tsx internals)
- prefers-reduced-motion guard present in globals.css
- 5 new loading.tsx files created for exports, lists, list detail, activity, analytics routes
- Error boundary buttons use gold design system pattern
- No functional regressions introduced
</success_criteria>

<output>
After completion, create `.planning/phases/14-polish-verification/14-01-SUMMARY.md`
</output>
