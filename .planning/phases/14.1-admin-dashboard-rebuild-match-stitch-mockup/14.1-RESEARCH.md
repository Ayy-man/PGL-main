# Phase 14.1: Admin Dashboard Rebuild — Match Stitch Mockup - Research

**Researched:** 2026-03-01
**Domain:** React UI rebuild, data visualization, admin dashboard layout
**Confidence:** HIGH

---

## Summary

Phase 14.1 is a visual rebuild of the existing `/admin` (Command Center) page to match the `stitch/executive_strategy_dashboard_2` mockup pixel-by-pixel. The current admin dashboard has all the right data and working API connections — what it lacks is the richer visual treatment shown in the mockup: a multi-metric "Platform Pulse" card with sparkline bars and inline progress bars, an "Enrichment Health (CB)" circuit-breaker status card with colored status dots, a "Unit Economics" cost-per-provider card, an "Export Activity (24h)" micro-bar chart, a Tenant Management table with Plan/MRR columns and icon avatars, a styled "Live Error Feed" with severity icons, and a 2x2 "System Actions" grid.

The current implementation is structurally sound but visually sparse. The PlatformPulse component shows 4 simple stat cards with large Cormorant numerals. The TenantHeatmap table exists but lacks the plan badge, MRR column, seat utilization display, and icon avatar per tenant. The ErrorFeed is table-based with rows; the mockup renders it as a vertical card feed with colored severity icons. The AdminNavLinks already has the "Platform Control" section header and correct nav items for Command Center, but needs a second section "System Config" with Global API Keys, Master Data Schema, Security Policies, Integrations (stub links). The sidebar footer currently shows just the user email — the mockup shows a styled "Super Admin" user card with avatar initials.

All work is confined to the `/admin` page and its sub-components — the layout shell (sidebar, TopBar, layout.tsx) only needs targeted additions. No new API routes are needed: the mockup's "Unit Economics" card uses hardcoded mock data, "System Actions" buttons are stubs, the circuit-breaker card derives from existing enrichment health data, and the mini bar chart for exports is decorative.

**Primary recommendation:** Rebuild `src/app/admin/page.tsx` and its 5 admin components as a targeted replacement. Do NOT touch the layout shell, API routes, or other admin pages (tenants/users/analytics). The mockup's color scheme uses `#221e10`/`#f1bf27` (warm brown/bright gold) as a design aspirational target — translate this into the existing project CSS variable system (`--admin-card-bg`, `--gold-primary`, `--border-gold`, etc.) which already approximates it.

---

## Standard Stack

### Core

| Library | Version | Purpose | Why Standard |
|---------|---------|---------|--------------|
| React + Next.js 15 | 15.x | Component model and routing | Project standard |
| Tailwind CSS v3 | 3.x | Utility classes | Project standard |
| Lucide React | latest | Icons — no Material Symbols allowed | Project rule: Lucide only |
| Recharts | 2.x | Bar chart for Export Activity card | Already in project, used by enrichment-health-chart |

### Supporting

| Library | Version | Purpose | When to Use |
|---------|---------|---------|-------------|
| CSS Custom Properties | n/a | All color and surface tokens | Every component — never raw hex |
| `useCountUp` hook | project | Animated number counters on stat values | Reuse from `src/hooks/use-count-up.ts` |

### Alternatives Considered

| Instead of | Could Use | Tradeoff |
|------------|-----------|----------|
| Recharts BarChart | Pure CSS bar divs | Pure CSS bars (like the mockup HTML) are simpler for the "Export Activity" mini chart — no Recharts needed for decorative sparklines |
| Recharts for Provider Health | Custom dot+label rows | Circuit-breaker health uses simple status-dot + label + badge rows, no chart library needed |

**Installation:**

No new packages needed. All dependencies already in project.

---

## Architecture Patterns

### Recommended Project Structure

```
src/
├── app/admin/
│   ├── page.tsx                      ← REBUILD — "Global Command Center"
│   ├── layout.tsx                    ← TARGETED UPDATE — sidebar footer user card + second nav section
│   └── admin-nav-links.tsx           ← TARGETED UPDATE — add "System Config" section
├── components/admin/
│   ├── platform-pulse.tsx            ← REBUILD — multi-metric card with progress bars + sparkline
│   ├── enrichment-health-chart.tsx   ← REBUILD — circuit-breaker status card (dots + badges)
│   ├── api-quota-card.tsx            ← RENAME/REBUILD as unit-economics.tsx — cost/provider table
│   ├── export-activity-chart.tsx     ← NEW — mini bar chart card (replaces funnel-chart.tsx in layout)
│   ├── tenant-heatmap.tsx            ← REBUILD — add plan badge + MRR + icon avatar + seats
│   ├── error-feed.tsx                ← REBUILD — card-feed layout with severity icons
│   ├── system-actions.tsx            ← NEW — 2x2 stub action buttons grid
│   └── funnel-chart.tsx              ← KEEP AS-IS (used in analytics page context, do not delete)
```

### Pattern 1: Mockup Color Translation

**What:** The stitch mockup uses `#221e10` (warm dark brown) and `#f1bf27` (bright gold). The project uses `#08080a`/`#d4af37`. These are visually close — translate mockup warmth using existing CSS variables.

**Translation table:**

| Mockup value | Project CSS variable |
|---|---|
| `#221e10` (surface-dark) | `var(--admin-card-bg)` |
| `bg-white/5` borders | `var(--admin-border)` / `var(--border-subtle)` |
| `text-white/50` labels | `var(--admin-text-secondary)` |
| `#f1bf27` / `text-primary` | `var(--gold-primary)` |
| `bg-primary/10` | `var(--gold-bg)` |
| `border-primary/20` | `var(--border-gold)` |
| Green status dot `bg-green-500` | `var(--success)` |
| Amber status dot `bg-amber-500` | `var(--warning)` |
| Red status dot `bg-red-500` | `text-destructive` / `oklch(...)` |

**Rule:** Never use the mockup's raw hex values — always translate to project CSS variables.

### Pattern 2: No Material Symbols — Lucide Only

**What:** The mockup HTML uses `material-symbols-outlined` icons. The project rule is **Lucide React exclusively**.

**Translation table:**

| Mockup Material icon | Lucide equivalent |
|---|---|
| `dashboard` | `LayoutDashboard` |
| `domain` | `Building2` |
| `monitoring` | `BarChart3` |
| `vpn_key` | `Key` |
| `schema` | `Database` |
| `security` | `Shield` |
| `integration_instructions` | `Plug` |
| `ecg_heart` | `Activity` |
| `health_and_safety` | `ShieldCheck` |
| `report` | `AlertCircle` |
| `bolt` | `Zap` |
| `error` | `XCircle` |
| `warning` | `AlertTriangle` |
| `info` | `Info` |
| `key` | `Key` |
| `database` | `Database` |
| `campaign` | `Megaphone` |
| `download` | `Download` |
| `add_business` | `Plus` |
| `filter_list` | `Filter` |
| `login` (impersonate) | `LogIn` |
| `history` (logs) | `History` |
| `block` (suspend) | `Ban` |

### Pattern 3: CSS Variables for Progress Bars and Status Dots

**What:** The mockup shows inline progress bars (thin `h-1` bars), sparkline-like mini charts, and status indicator dots with glow shadows. These are pure CSS/div implementations.

```tsx
// Progress bar pattern (Platform Pulse card)
<div className="w-full h-1 rounded-full" style={{ background: "rgba(255,255,255,0.05)" }}>
  <div
    className="h-1 rounded-full transition-all duration-500"
    style={{ width: `${pct}%`, background: "var(--gold-primary)" }}
  />
</div>

// Status dot with glow (circuit-breaker health)
// GREEN:
<div
  className="size-2 rounded-full"
  style={{ background: "var(--success)", boxShadow: "0 0 8px rgba(34,197,94,0.6)" }}
/>
// AMBER:
<div
  className="size-2 rounded-full animate-pulse"
  style={{ background: "var(--warning)", boxShadow: "0 0 8px rgba(245,158,11,0.6)" }}
/>
// RED:
<div
  className="size-2 rounded-full"
  style={{ background: "oklch(0.62 0.19 22)", boxShadow: "0 0 8px rgba(239,68,68,0.6)" }}
/>
```

### Pattern 4: Mini Bar Chart (Export Activity) — Pure CSS Bars

**What:** The mockup "Export Activity (24h)" uses 5 equal-width divs with varying heights and hover effects. This is simpler and more reliable than Recharts for a decorative sparkline.

```tsx
// Pure CSS mini bar chart — no Recharts needed
const bars = [
  { height: "40%", label: "W Team" },
  { height: "85%", label: "Vertex" },
  { height: "60%", label: "Helix" },
  { height: "25%", label: "Global" },
  { height: "50%", label: "Other" },
];

<div className="flex-1 flex items-end gap-2 px-2 pb-2">
  {bars.map((bar) => (
    <div
      key={bar.label}
      className="flex-1 rounded-t-sm group/bar relative cursor-default"
      style={{
        height: bar.height,
        background: "rgba(255,255,255,0.05)",
        transition: "background 0.15s ease",
      }}
      onMouseEnter={(e) => (e.currentTarget.style.background = "var(--gold-bg-strong)")}
      onMouseLeave={(e) => (e.currentTarget.style.background = "rgba(255,255,255,0.05)")}
      title={bar.label}
    />
  ))}
</div>
```

Note: In production this chart would be driven by real data — for now, mock data is acceptable per the mockup.

### Pattern 5: Tenant Management Table Enhancements

**What:** The current TenantHeatmap shows Tenant / Users / Searches / Enrichments / Exports / Last Active. The mockup's "Tenant Management" table shows Client/Tenant (with icon avatar) / Plan & Rev (badge + MRR) / Seats (used/total) / Status (dot + label) / Actions (icon buttons).

**Key additions:**

```tsx
// Plan badge — Enterprise (gold), Pro Tier (purple), Basic (amber)
function PlanBadge({ plan }: { plan: "enterprise" | "pro" | "basic" }) {
  const styles = {
    enterprise: { bg: "var(--gold-bg)", border: "var(--border-gold)", color: "var(--gold-primary)" },
    pro:        { bg: "rgba(168,85,247,0.10)", border: "rgba(168,85,247,0.20)", color: "#c084fc" },
    basic:      { bg: "rgba(245,158,11,0.10)", border: "rgba(245,158,11,0.20)", color: "#f59e0b" },
  };
  // ...
}

// Icon avatar placeholder (since real tenant logos not stored)
<div
  className="size-10 rounded-lg flex items-center justify-center"
  style={{ background: "rgba(255,255,255,0.05)", border: "1px solid var(--border-subtle)" }}
>
  <Building2 className="h-5 w-5" style={{ color: "var(--admin-text-secondary)" }} />
</div>
```

**Data gap:** Current API at `/api/admin/tenants/activity` returns searches/enrichments/exports but NOT plan, MRR, or seats. These columns must be either: (a) added to the API response from the `tenants` table, or (b) shown as "—" / mock data. Decision: fetch from `tenants` table directly (it has `name`, `slug`, `is_active`, `created_at` — no `plan` or `mrr` column currently). Use `is_active` for the status dot; for Plan/MRR/Seats show "—" as those columns don't exist in the DB schema. The mockup's rich plan data is aspirational UI.

### Pattern 6: Error Feed — Card Layout vs Table

**What:** Current ErrorFeed is a table. Mockup shows a vertical card-feed with icon+severity+timestamp on the left, title+description on the right, and colored severity icons (red for error, amber for warning, blue for info).

The existing data from `/api/admin/errors` returns enrichment failures — these map to the "error" severity level. The mockup also shows warnings and info items which don't exist in current data. Implementation: render existing error data in the new card-feed layout, all as red/error severity. The warning and info items from the mockup are aspirational — stub with current data only.

### Pattern 7: System Actions — Stub Buttons

**What:** 2x2 grid of action buttons in the mockup: Rotate Master Keys, Flush Cache (Global), Broadcast Alert, Export System Logs. These are non-functional in the current app and remain stubs (console.log or toast "Coming soon").

```tsx
const SYSTEM_ACTIONS = [
  { icon: Key,      label: "Rotate Master Keys" },
  { icon: Database, label: "Flush Cache (Global)" },
  { icon: Megaphone, label: "Broadcast Alert" },
  { icon: Download, label: "Export System Logs" },
];
```

### Pattern 8: Sidebar "System Config" Section + Super Admin User Card

**What:** The mockup sidebar has two nav sections:
1. "Platform Control" — Command Center, Tenant Registry, Usage Metrics (already exists, partially)
2. "System Config" — Global API Keys, Master Data Schema, Security Policies, Integrations (new, stub links)

The sidebar footer shows a styled user card (avatar initials + "Super Admin" name + email), not just the bare email text.

**AdminNavLinks update:**

```tsx
const ADMIN_NAV_PLATFORM = [
  { label: "Command Center", href: "/admin",           icon: LayoutDashboard, exact: true },
  { label: "Tenant Registry", href: "/admin/tenants",  icon: Building2,       exact: false },
  { label: "Usage Metrics",   href: "/admin/analytics", icon: BarChart3,      exact: false },
];

const ADMIN_NAV_SYSTEM = [
  { label: "Global API Keys",      href: "/admin/api-keys",   icon: Key,      exact: false },
  { label: "Master Data Schema",   href: "/admin/schema",     icon: Database, exact: false },
  { label: "Security Policies",    href: "/admin/security",   icon: Shield,   exact: false },
  { label: "Integrations",         href: "/admin/integrations", icon: Plug,   exact: false },
];
```

Note: The System Config links are stub links — the pages don't exist. Clicking them will 404. They should render with the inactive nav style but NOT be wrapped in Next.js `<Link>` to a non-existent route — use `<span>` or `<a href="#" onClick={e => e.preventDefault()}>` to avoid 404. Alternatively, let them 404 and add `not-found.tsx` as a sub-task. The simpler approach is stub anchor tags.

**Sidebar footer user card:**

```tsx
// In layout.tsx — replace current bare email text with:
<div
  className="rounded-lg p-3 flex items-center gap-3"
  style={{ background: "rgba(255,255,255,0.05)", border: "1px solid var(--border-subtle)" }}
>
  <div
    className="size-8 rounded-full flex items-center justify-center text-xs font-bold shrink-0"
    style={{
      background: "var(--gold-bg-strong)",
      color: "var(--gold-primary)",
      border: "1px solid var(--border-gold)",
    }}
  >
    {userInitials}
  </div>
  <div className="overflow-hidden min-w-0">
    <p className="text-sm font-medium truncate" style={{ color: "var(--text-primary-ds)" }}>
      Super Admin
    </p>
    <p className="text-xs truncate" style={{ color: "var(--text-ghost)" }}>
      {user.email}
    </p>
  </div>
</div>
```

### Pattern 9: Page Header — "Global Command Center"

**What:** Current page header says "Platform Health". Mockup top bar says "Global Command Center" with a status line below.

```tsx
// In page.tsx header section — replace current h1 block
<div>
  <h2 className="font-medium tracking-wide" style={{ fontSize: "18px", color: "var(--text-primary-ds)" }}>
    Global Command Center
  </h2>
  <p className="text-xs flex items-center gap-2 mt-0.5" style={{ color: "var(--admin-text-secondary)" }}>
    System Status:{" "}
    <span className="font-mono tracking-tight" style={{ color: "var(--success)" }}>OPERATIONAL</span>
    {" "}• v2.5.0 •{" "}
    <span style={{ color: "var(--gold-text)" }}>PGL Core</span>
  </p>
</div>
```

Note: The mockup places this header inside the `<header>` bar (TopBar). In the actual Next.js layout, the TopBar is a shared component used by both tenant and admin. The "Global Command Center" text with status line should live in the page's own content header (inside `page.tsx`), not in TopBar, to avoid breaking the tenant shell.

### Anti-Patterns to Avoid

- **Using Material Symbols icons:** The mockup HTML uses them. Project rule is Lucide only. Never import or use Material icons.
- **Using raw hex colors from the mockup:** `#221e10`, `#f1bf27`, `rgba(241,191,39,0.1)` must all be translated to CSS variables.
- **Touching the TopBar component:** It is shared between admin and tenant. Changes break the whole shell. The "Global Command Center" header goes in `page.tsx`, not `TopBar`.
- **Touching tenant layout or non-admin pages:** This phase is admin-only.
- **Removing funnel-chart.tsx:** It may be referenced elsewhere (analytics page). Don't delete it — just stop using it in `page.tsx`.
- **Wiring System Config nav links to real routes:** Those pages don't exist — stub them.
- **Over-engineering the mini bar chart with Recharts:** Pure CSS divs are more reliable for the decorative sparkline.
- **Breaking existing data flows:** The page.tsx fetch pattern (Promise.all of 6 endpoints, 60s polling) is correct — preserve it.

---

## Don't Hand-Roll

| Problem | Don't Build | Use Instead | Why |
|---------|-------------|-------------|-----|
| Status dot with glow | Custom glow component | Inline `boxShadow` style | 2 lines, no abstraction needed |
| Progress bars | Custom ProgressBar component | Inline div with CSS var width | Simple enough inline |
| Mini bar chart | Recharts BarChart | Pure CSS div bars with mouse handlers | Zero dependency, simpler |
| Circuit-breaker status | New API endpoint | Map existing enrichment data to status display | No new backend work needed |
| Tenant plan badges | External library | Inline badge pattern already in project | `surface-admin-card` patterns well-established |

**Key insight:** This is a visual rebuild, not a data architecture change. Almost everything can be achieved with CSS and existing data.

---

## Common Pitfalls

### Pitfall 1: Touching the TopBar / Layout Shell

**What goes wrong:** Developer puts "Global Command Center" heading in TopBar, breaking tenant navigation.
**Why it happens:** The mockup shows it in the header bar.
**How to avoid:** Keep page-specific headings in `page.tsx` content, not in shared layout components.
**Warning signs:** Any edit to `src/components/layout/top-bar.tsx` or `src/app/admin/layout.tsx` header section.

### Pitfall 2: CSS Variable Collision with Mockup Colors

**What goes wrong:** Developer uses raw `rgba(241,191,39,...)` or `#221e10` from the mockup HTML, bypassing the design system.
**Why it happens:** Copy-pasting from the mockup HTML.
**How to avoid:** Always translate through the CSS variable table above before writing any color value.
**Warning signs:** Any raw hex or non-CSS-variable rgba in JSX className or style attributes.

### Pitfall 3: Recharts Key Warning on FlatList Map

**What goes wrong:** In `EnrichmentHealthChart`, mapping over `SOURCES` returns two `<Bar>` elements without explicit keys. This causes React reconciliation warnings.
**Why it happens:** JSX fragments inside map without keys.
**How to avoid:** Already exists as a bug in current code — the new "circuit-breaker" version uses simple rows, not Recharts at all, so this is resolved.
**Warning signs:** Console warnings about missing key props.

### Pitfall 4: Data Missing for Plan/MRR Columns

**What goes wrong:** Developer tries to display Plan badge and MRR from tenant activity API, but that data doesn't exist in the current DB schema or API response.
**Why it happens:** The mockup shows rich billing data.
**How to avoid:** Display "—" for Plan and MRR until a DB migration adds those columns. Do NOT add a DB migration in this phase.
**Warning signs:** TypeScript errors accessing `.plan` or `.mrr` on the tenant type.

### Pitfall 5: System Config Links Causing 404

**What goes wrong:** Next.js `<Link href="/admin/api-keys">` navigates to a non-existent page, crashing with 404.
**Why it happens:** The routes don't exist.
**How to avoid:** Render stub nav items as `<button>` or `<a href="#">` with `onClick={(e) => e.preventDefault()}` and add a `title="Coming soon"` attribute.
**Warning signs:** TypeScript complaints about href types on `<a>` elements.

### Pitfall 6: Breaking the 60-second Polling Pattern

**What goes wrong:** Rebuilding `page.tsx` loses the `useCallback` + `useRef(errorPage)` stale-closure guard pattern.
**Why it happens:** Rewriting the component from scratch without reading the existing data-fetch logic carefully.
**How to avoid:** Preserve the exact `fetchAll` + `errorPageRef` + interval pattern from the current `page.tsx`. Only change the rendering layer.
**Warning signs:** Error feed pagination stops working, or page fetches on every re-render.

### Pitfall 7: Inline hover for CSS variable values

**What goes wrong:** Using Tailwind `hover:bg-[var(--gold-bg)]` — this does not work in Tailwind v3 for CSS variable values.
**Why it happens:** Instinct to use Tailwind hover utilities.
**How to avoid:** Use `onMouseEnter`/`onMouseLeave` handlers for CSS variable-based hover states. This pattern is already established throughout the project (Phase 05-03 decision).
**Warning signs:** Hover states having no effect.

---

## Code Examples

### Platform Pulse Card — Multi-Metric With Progress Bars

```tsx
// Source: Derived from stitch/executive_strategy_dashboard_2/code.html + project CSS variables
function PlatformPulseCard({ data }: { data: PulseData | null }) {
  return (
    <div className="surface-admin-card rounded-[14px] p-6 relative overflow-hidden">
      {/* Decorative background icon */}
      <div className="absolute top-0 right-0 p-4 pointer-events-none" style={{ opacity: 0.05 }}>
        <Activity className="h-20 w-20" style={{ color: "var(--gold-primary)" }} />
      </div>
      <div className="relative z-10">
        <p className="text-[10px] font-semibold uppercase tracking-widest mb-4 flex items-center gap-2"
           style={{ color: "var(--admin-text-secondary)" }}>
          <span className="size-2 rounded-full animate-pulse" style={{ background: "var(--gold-primary)" }} />
          Platform Pulse
        </p>
        <div className="space-y-4">
          {/* Metric row */}
          <div>
            <div className="flex justify-between items-end mb-1">
              <span className="text-xs" style={{ color: "var(--admin-text-secondary)" }}>Total Users</span>
              <span className="font-mono text-lg" style={{ color: "var(--text-primary-ds)" }}>
                {data?.totalUsers ?? "—"}
              </span>
            </div>
            <div className="w-full h-1 rounded-full" style={{ background: "rgba(255,255,255,0.05)" }}>
              <div className="h-1 rounded-full transition-all duration-500"
                   style={{ width: `${data?.userPct ?? 0}%`, background: "var(--gold-primary)" }} />
            </div>
          </div>
          {/* ... more metric rows */}
        </div>
      </div>
    </div>
  );
}
```

### Circuit-Breaker Health Card — Status Dots

```tsx
// Source: Derived from stitch/executive_strategy_dashboard_2/code.html
const PROVIDERS = [
  { label: "Apollo Scraper",  status: "closed" as const },
  { label: "Exa Neural",      status: "half-open" as const },
  { label: "ContactOut",      status: "closed" as const },
];

const STATUS_CONFIG = {
  "closed":    { color: "var(--success)",  glow: "rgba(34,197,94,0.6)",   label: "Closed",    pulse: false },
  "half-open": { color: "var(--warning)",  glow: "rgba(245,158,11,0.6)",  label: "Half-Open", pulse: true  },
  "open":      { color: "oklch(0.62 0.19 22)", glow: "rgba(239,68,68,0.6)", label: "Open",    pulse: false },
};

function CircuitBreakerRow({ label, status }: { label: string; status: keyof typeof STATUS_CONFIG }) {
  const cfg = STATUS_CONFIG[status];
  return (
    <div className="flex items-center justify-between p-2 rounded"
         style={{ background: "rgba(255,255,255,0.05)", border: "1px solid rgba(255,255,255,0.05)" }}>
      <div className="flex items-center gap-2">
        <div
          className={`size-2 rounded-full ${cfg.pulse ? "animate-pulse" : ""}`}
          style={{ background: cfg.color, boxShadow: `0 0 8px ${cfg.glow}` }}
        />
        <span className="text-xs font-medium" style={{ color: "var(--text-primary-ds)" }}>{label}</span>
      </div>
      <span className="text-[10px] uppercase tracking-wider rounded px-1.5 py-0.5"
            style={{
              color: cfg.color,
              background: `${cfg.color}20`,
              border: `1px solid ${cfg.color}30`,
            }}>
        {cfg.label}
      </span>
    </div>
  );
}
```

### Tenant Management Table Row — With Plan Badge, Avatar, Seats

```tsx
// Plan badge colors
const PLAN_STYLES = {
  enterprise: {
    bg: "var(--gold-bg)",      border: "var(--border-gold)",        color: "var(--gold-primary)" },
  pro:        {
    bg: "rgba(168,85,247,0.10)", border: "rgba(168,85,247,0.20)",  color: "#c084fc" },
  basic:      {
    bg: "rgba(245,158,11,0.10)", border: "rgba(245,158,11,0.20)", color: "#f59e0b" },
};

// Row structure
<tr className="admin-row-hover" style={{ borderBottom: "1px solid var(--admin-row-border)" }}>
  <td className="px-6 py-4">
    <div className="flex items-center gap-4">
      <div className="size-10 rounded-lg flex items-center justify-center"
           style={{ background: "rgba(255,255,255,0.05)", border: "1px solid var(--border-subtle)" }}>
        <Building2 className="h-5 w-5" style={{ color: "var(--admin-text-secondary)" }} />
      </div>
      <div>
        <p className="text-sm font-semibold" style={{ color: "var(--text-primary-ds)" }}>
          {tenant.name}
        </p>
        <p className="text-xs font-mono" style={{ color: "var(--admin-text-secondary)" }}>
          ID: {tenant.id.substring(0, 12)}
        </p>
      </div>
    </div>
  </td>
  <td className="px-6 py-4">
    {/* Plan badge + MRR */}
    <span className="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wide"
          style={{ background: PLAN_STYLES.enterprise.bg, border: `1px solid ${PLAN_STYLES.enterprise.border}`,
                   color: PLAN_STYLES.enterprise.color }}>
      Enterprise
    </span>
    <span className="text-xs font-mono ml-2" style={{ color: "var(--text-primary-ds)" }}>—</span>
  </td>
  {/* Status dot */}
  <td className="px-6 py-4">
    <div className="flex items-center gap-2">
      <div className="size-2 rounded-full"
           style={{ background: tenant.is_active ? "var(--success)" : "oklch(0.62 0.19 22)",
                    boxShadow: tenant.is_active ? "0 0 8px rgba(34,197,94,0.6)" : "0 0 8px rgba(239,68,68,0.6)" }} />
      <span className="text-xs" style={{ color: "var(--admin-text-secondary)" }}>
        {tenant.is_active ? "Active" : "Inactive"}
      </span>
    </div>
  </td>
  {/* Actions */}
  <td className="px-6 py-4 text-right">
    <div className="flex items-center justify-end gap-1">
      <button title="Impersonate" className="p-2 rounded-lg transition-colors"
              style={{ color: "var(--admin-text-secondary)" }}
              onMouseEnter={(e) => { e.currentTarget.style.color = "var(--text-primary-ds)"; e.currentTarget.style.background = "rgba(255,255,255,0.08)"; }}
              onMouseLeave={(e) => { e.currentTarget.style.color = "var(--admin-text-secondary)"; e.currentTarget.style.background = ""; }}>
        <LogIn className="h-4 w-4" />
      </button>
      {/* ... History, Ban buttons */}
    </div>
  </td>
</tr>
```

### Error Feed — Card Layout

```tsx
// Source: Derived from stitch/executive_strategy_dashboard_2/code.html
<div className="flex gap-4 p-4 cursor-pointer"
     style={{ borderBottom: "1px solid var(--admin-row-border)" }}
     onMouseEnter={(e) => (e.currentTarget.style.background = "rgba(255,255,255,0.02)")}
     onMouseLeave={(e) => (e.currentTarget.style.background = "")}>
  {/* Severity icon */}
  <div className="mt-0.5 shrink-0">
    <div className="p-1.5 rounded" style={{ color: "oklch(0.62 0.19 22)", background: "rgba(239,68,68,0.1)" }}>
      <XCircle className="h-4 w-4" />
    </div>
  </div>
  {/* Content */}
  <div className="flex-1 min-w-0">
    <div className="flex justify-between items-start">
      <p className="text-sm font-medium" style={{ color: "var(--text-primary-ds)" }}>
        {record.fullName} — Enrichment Failed
      </p>
      <span className="text-[10px] whitespace-nowrap ml-2" style={{ color: "var(--text-ghost)" }}>
        {formatRelativeTime(record.updatedAt)}
      </span>
    </div>
    <p className="text-xs mt-0.5" style={{ color: "var(--admin-text-secondary)" }}>
      Tenant: {record.tenantName} · Failed sources: {Object.keys(record.sourceDetails).filter(k => record.sourceDetails[k].status === "failed").join(", ") || "unknown"}
    </p>
  </div>
</div>
```

---

## Gap Analysis: Current vs Mockup

| Section | Current State | Mockup Target | Work Required |
|---------|--------------|---------------|---------------|
| Page title | "Platform Health" (h1, 38px serif) | "Global Command Center" (18px, with status line) | Edit page header in `page.tsx` |
| Sidebar nav | 4 items, 1 section "Platform Control" | 7 items, 2 sections ("Platform Control" + "System Config") | Update `admin-nav-links.tsx` |
| Sidebar footer | Bare email text | Styled user card with avatar + "Super Admin" | Update `layout.tsx` footer |
| Stat card 1 (Platform Pulse) | Large serif number, subtitle | Multi-metric with inline progress bars, sparkline dots | Rebuild `platform-pulse.tsx` |
| Stat card 2 (Enrichment) | Large serif number "success rate%" | Circuit-breaker status dots per provider | Rebuild `enrichment-health-chart.tsx` as new component |
| Stat card 3 (API Quota) | Provider bars (current `api-quota-card`) | Unit Economics cost/provider table | Repurpose `api-quota-card.tsx` → unit economics |
| Stat card 4 (Active Users) | Large serif number | Export Activity mini-bar chart | New `export-activity-chart.tsx` component |
| Tenant table | 6 columns: name/users/searches/enrichments/exports/last-active | 5 columns: client-tenant/plan-rev/seats/status/actions | Rebuild `tenant-heatmap.tsx` |
| Error section | Full-width table with expand rows | Left panel: card feed with severity icons | Rebuild `error-feed.tsx` |
| System Actions | Does not exist | Right panel: 2x2 grid of stub action buttons | New `system-actions.tsx` component |
| Bottom layout | Single full-width error feed | Two-column: error feed (left) + system actions (right) | Update `page.tsx` section layout |

---

## Open Questions

1. **Circuit-breaker health data source**
   - What we know: `/api/admin/enrichment/health` returns daily success/failure counts per provider
   - What's unclear: There is no actual circuit-breaker state endpoint. The current `EnrichmentHealthChart` shows historical bars, not real-time circuit status
   - Recommendation: Derive circuit-breaker display state from the most recent day's data — if failures > 50% of calls that day, show "Half-Open"; if 0 failures, show "Closed"; if all failures, show "Open". This is a heuristic derivation, not a real circuit-breaker read. Acceptable for the visual rebuild.

2. **Platform Pulse "Total Users" and "Prospects Scraped" metrics**
   - What we know: `/api/admin/dashboard` currently returns `totalProspects`, `enrichmentCoverage`, `enrichmentFailed`, `activeUsersToday`, `activeUsers7dAvg`
   - What's unclear: The mockup shows "Total Users: 1,248" and "Prospects Scraped: 842k" — not the same field names
   - Recommendation: Map `totalProspects` → "Prospects Scraped", derive "Total Users" from a cross-tenant user count (may need a new query to `/api/admin/dashboard`). If the API doesn't return user count, show `activeUsersToday` with label "Active Users Today" and rename the card metrics accordingly.

3. **Export Activity chart — real vs mock data**
   - What we know: The mockup shows 5 bars representing per-tenant export activity in the last 24h
   - What's unclear: No existing API endpoint returns per-tenant export counts over 24h windows
   - Recommendation: Use the existing `heatmapData` exports7d values as the bar chart data (one bar per tenant). It won't be "last 24h" but it's real data. Label it "Exports (7d)" instead.

---

## File Inventory: What to Edit vs Create

| File | Action | Scope |
|------|--------|-------|
| `src/app/admin/page.tsx` | REBUILD | Replace all JSX — preserve data-fetch logic (fetchAll, polling, errorPageRef) |
| `src/app/admin/layout.tsx` | TARGETED UPDATE | Footer: swap bare email for user card |
| `src/app/admin/admin-nav-links.tsx` | TARGETED UPDATE | Add "System Config" section with 4 stub nav items |
| `src/components/admin/platform-pulse.tsx` | REBUILD | Multi-metric card with progress bars |
| `src/components/admin/enrichment-health-chart.tsx` | REBUILD | Circuit-breaker status dots card |
| `src/components/admin/api-quota-card.tsx` | REBUILD | Unit Economics cost/provider table |
| `src/components/admin/tenant-heatmap.tsx` | REBUILD | Icon avatar + plan badge + status dot + actions |
| `src/components/admin/error-feed.tsx` | REBUILD | Card-feed layout with severity icons |
| `src/components/admin/system-actions.tsx` | CREATE | 2x2 stub action buttons |
| `src/components/admin/export-activity-chart.tsx` | CREATE | Mini bar chart card (pure CSS) |
| `src/components/admin/funnel-chart.tsx` | KEEP AS-IS | Not used in page.tsx anymore but don't delete |

---

## Sources

### Primary (HIGH confidence)
- `stitch/executive_strategy_dashboard_2/screen.png` — Visual target (read directly)
- `stitch/executive_strategy_dashboard_2/code.html` — HTML reference (read directly)
- `src/app/admin/page.tsx` — Current implementation (read directly)
- `src/components/admin/*.tsx` — All current admin components (read directly)
- `src/app/globals.css` — CSS variable definitions (read directly)
- `design-system/MASTER.md` — Design system rules (read directly)
- `design-system/pages/dashboard.md` — Admin dashboard overrides (read directly)

### Secondary (MEDIUM confidence)
- Project memory and STATE.md accumulated decisions re: onMouseEnter/Leave pattern for CSS variable hovers, admin-scoped tokens, inline style for gradient backgrounds

---

## Metadata

**Confidence breakdown:**
- Standard stack: HIGH — project uses fixed stack, no new libraries needed
- Architecture: HIGH — all components identified, file-by-file plan clear
- Design translation: HIGH — mockup HTML and screenshot both read; CSS variable mapping complete
- Data gaps: MEDIUM — circuit-breaker status, total users count, 24h export bars require heuristic derivation

**Research date:** 2026-03-01
**Valid until:** 2026-04-01 (stable — no external APIs change, mockup is fixed)
