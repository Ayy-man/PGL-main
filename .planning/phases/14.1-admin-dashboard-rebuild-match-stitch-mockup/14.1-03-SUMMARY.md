---
phase: 14.1-admin-dashboard-rebuild-match-stitch-mockup
plan: "03"
subsystem: ui
tags: [react, admin, tailwind, css-variables, lucide, pure-css-chart]

# Dependency graph
requires:
  - phase: 14.1-admin-dashboard-rebuild-match-stitch-mockup
    provides: Plan 01 (layout footer + nav) and Plan 02 (EnrichmentHealthChart rebuild) — same phase, prior plans

provides:
  - ApiQuotaCard rebuilt as "Unit Economics (Cost/Enrich)" card with 3 provider rows (Apollo, Exa AI, ContactOut) and blended cost footer
  - ExportActivityChart new pure CSS mini bar chart derived from heatmap exports7d data with hover effects
  - TenantHeatmap rebuilt as "Tenant Management" 5-column table with icon avatar, plan badge, status dot, action buttons, header with Filter View + Provision New Tenant buttons, and pagination footer

affects:
  - 14.1-04 (page.tsx wiring — these components must be imported and rendered)
  - admin page visual layout

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "Pure CSS bar chart pattern — flex items-end container with div bars whose height is % computed from data max; hover via onMouseEnter/Leave"
    - "onMouseEnter/Leave for multi-property hover state on action buttons (color + background)"
    - "isActive derived from tenant 7d metrics + lastActive presence — no DB plan/status column"

key-files:
  created:
    - src/components/admin/export-activity-chart.tsx
  modified:
    - src/components/admin/api-quota-card.tsx
    - src/components/admin/tenant-heatmap.tsx

key-decisions:
  - "ApiQuotaCard renders hardcoded Unit Economics costs (not live API data) — DB has no cost-per-call columns; aspirational display values per RESEARCH.md"
  - "ExportActivityChart receives heatmapData and derives bar heights from exports7d; labeled Export Activity (7d) not (24h) since no 24h endpoint exists"
  - "TenantHeatmap plan badge hardcoded as Enterprise — DB tenants table has no plan/mrr column; shown as aspirational UI with MRR as em dash"
  - "isActive status derived from 7d metrics + lastActive presence rather than a DB is_active flag (field not in Tenant interface)"
  - "Suspend button hover uses red (oklch(0.62 0.19 22) + rgba(239,68,68,0.08)) to signal destructive action"

patterns-established:
  - "Pure CSS bar chart: flex items-end + gap-2 + individual div heights as percentage strings, min 5% floor"
  - "TenantRow extracted as named internal component for clean tbody iteration"
  - "Action icon buttons: p-2 rounded-lg + onMouseEnter/Leave for both color and background together"

requirements-completed: [SA-01, SA-04, ANLY-03]

# Metrics
duration: 8min
completed: 2026-03-01
---

# Phase 14.1 Plan 03: Admin Cards + Tenant Table Rebuild Summary

**ApiQuotaCard rebuilt as cost/provider Unit Economics table, new pure CSS ExportActivityChart bar chart, and TenantHeatmap rewritten as 5-column Tenant Management table with icon avatars, plan badges, status dots, and action buttons.**

## Performance

- **Duration:** ~8 min
- **Started:** 2026-02-28T23:31:00Z
- **Completed:** 2026-02-28T23:39:26Z
- **Tasks:** 2
- **Files modified:** 3 (1 created, 2 rebuilt)

## Accomplishments

- Rebuilt `api-quota-card.tsx` from API quota progress bars into a clean "Unit Economics (Cost/Enrich)" card showing hardcoded cost-per-operation for Apollo, Exa AI, and ContactOut with a blended cost footer; backward-compatible props interface preserved
- Created new `export-activity-chart.tsx` — pure CSS mini bar chart deriving bar heights from `heatmapData.exports7d`; includes skeleton, empty, and data states; hover effects via `onMouseEnter`/`onMouseLeave`; no Recharts dependency
- Rebuilt `tenant-heatmap.tsx` into a full "Tenant Management" card with header (title, subtitle, Filter View + Provision New Tenant gold button), 5-column table (Client/Tenant with icon avatar and ID, Plan & Rev with gold Enterprise badge, Seats with font-mono count, Status with glow dot, Actions with LogIn/History/Ban icon buttons), and pagination footer

## Task Commits

1. **Task 1: Rebuild ApiQuotaCard as Unit Economics + Create ExportActivityChart** - `d81f6ba` (feat)
2. **Task 2: Rebuild TenantHeatmap as mockup-style Tenant Management table** - `4993781` (feat)

## Files Created/Modified

- `src/components/admin/api-quota-card.tsx` — Rebuilt as Unit Economics cost table; retains `ApiQuotaCardProps` interface; data prop unused in render (costs are hardcoded)
- `src/components/admin/export-activity-chart.tsx` — New component; `ExportActivityChartProps` accepts same heatmap tenant shape (name + exports7d); pure CSS bars with min 5% floor
- `src/components/admin/tenant-heatmap.tsx` — Complete rewrite; removed `getHeatmapClass`, `isNewTenant`, expand-row logic, `ChevronDown`/`ChevronRight`; added `Building2`, `LogIn`, `History`, `Ban`, `Filter`, `Plus` Lucide icons; `TenantRow` extracted as internal component; all CSS variables, no raw hex

## Decisions Made

- **Unit Economics hardcoded:** The DB and API have no cost-per-call columns. Costs ($0.012 Apollo, $0.045 Exa AI, $0.080 ContactOut, $0.034 blended) are aspirational display values per RESEARCH.md guidance. The `data` prop is accepted for backward compatibility but unused in the current render.
- **Export Activity uses 7d not 24h:** No endpoint returns per-tenant export counts over 24h windows. The existing `exports7d` field from heatmap data is the closest available signal. Card label updated to "Export Activity (7d)".
- **Plan badge hardcoded Enterprise:** The `tenants` DB table has no `plan` or `mrr` column. All tenants show Enterprise badge + em dash for MRR — aspirational UI matching the mockup without requiring a migration.
- **isActive derived heuristically:** The `Tenant` interface has no `is_active` boolean field (that's on the raw DB row, not the API response shape). Active status derived from `searches7d > 0 || enrichments7d > 0 || exports7d > 0 || lastActive !== null`.

## Deviations from Plan

None — plan executed exactly as written.

## Issues Encountered

- `git commit` with heredoc (`<<'EOF'`) caused exit 138 (SIGKILL from process limit) on both commits; commits still succeeded as verified by `git log`. Subsequent commit commands used single-line commit messages to avoid the issue.

## User Setup Required

None — no external service configuration required.

## Next Phase Readiness

- Both new components (`ExportActivityChart`, rebuilt `ApiQuotaCard`) and rebuilt `TenantHeatmap` are ready for wiring into `page.tsx` in Plan 04
- Components accept their existing prop types (backward-compatible) — no page.tsx prop shape changes needed for the rebuilt cards
- `ExportActivityChart` expects `{ tenants: Array<{ name: string; exports7d: number }> } | null` — same shape as `heatmapData` in page.tsx

---
*Phase: 14.1-admin-dashboard-rebuild-match-stitch-mockup*
*Completed: 2026-03-01*

## Self-Check: PASSED

- FOUND: src/components/admin/api-quota-card.tsx
- FOUND: src/components/admin/export-activity-chart.tsx
- FOUND: src/components/admin/tenant-heatmap.tsx
- FOUND: .planning/phases/14.1-admin-dashboard-rebuild-match-stitch-mockup/14.1-03-SUMMARY.md
- FOUND commit d81f6ba (Task 1)
- FOUND commit 4993781 (Task 2)
