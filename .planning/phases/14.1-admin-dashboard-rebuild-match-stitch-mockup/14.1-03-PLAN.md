---
phase: 14.1-admin-dashboard-rebuild-match-stitch-mockup
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/admin/api-quota-card.tsx
  - src/components/admin/export-activity-chart.tsx
  - src/components/admin/tenant-heatmap.tsx
autonomous: true
requirements: [SA-01, SA-04, ANLY-03]

must_haves:
  truths:
    - Unit Economics card shows 3 provider rows (Apollo, Exa AI, ContactOut) with cost/unit values and a blended cost footer
    - Export Activity card shows pure CSS mini bar chart with 5 bars, hover effect, and time axis labels
    - Tenant Management table shows 5 columns (Client/Tenant, Plan & Rev, Seats, Status, Actions) with icon avatar, plan badge, status dot, and action buttons per row
    - Tenant table has styled header with title, subtitle, Filter View ghost button, and Provision New Tenant gold button
    - Tenant table footer shows count and Previous/Next pagination buttons
    - Action buttons (Impersonate, Logs, Suspend) render with Lucide icons and hover effects via onMouseEnter/Leave
  artifacts:
    - src/components/admin/api-quota-card.tsx
    - src/components/admin/export-activity-chart.tsx
    - src/components/admin/tenant-heatmap.tsx
  key_links:
    - api-quota-card.tsx rebuilt as Unit Economics — receives same quotaData shape, renders cost table
    - export-activity-chart.tsx is NEW — receives heatmapData to derive per-tenant export bars
    - tenant-heatmap.tsx rebuilt — receives same data shape, renders mockup table columns with plan/status/actions
---

<objective>
Rebuild the Unit Economics card (from api-quota-card), create the Export Activity mini chart, and rebuild the Tenant Management table to match the stitch mockup.

Purpose: The mockup shows a cost-per-provider card (not API quota bars), a decorative mini bar chart for exports (not the funnel chart), and a rich tenant table with plan badges, MRR, seats, status dots, and action buttons (not the current heatmap with expand rows).

Output: Rebuilt api-quota-card.tsx as Unit Economics, new export-activity-chart.tsx, rebuilt tenant-heatmap.tsx.
</objective>

<execution_context>
@/Users/aymanbaig/.claude/get-shit-done/workflows/execute-plan.md
@/Users/aymanbaig/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/14.1-admin-dashboard-rebuild-match-stitch-mockup/14.1-RESEARCH.md

@src/components/admin/api-quota-card.tsx
@src/components/admin/tenant-heatmap.tsx
@src/app/admin/page.tsx
@design-system/MASTER.md
@stitch/executive_strategy_dashboard_2/screen.png

<interfaces>
From src/components/admin/api-quota-card.tsx:
```typescript
interface ApiQuotaCardProps {
  data: { totals: Record<string, number>; days: number } | null;
}
export function ApiQuotaCard({ data }: ApiQuotaCardProps) { ... }
// Currently renders provider bars with gold progress fill
// Will be rebuilt as "Unit Economics (Cost/Enrich)" card with hardcoded cost data
```

From src/components/admin/tenant-heatmap.tsx:
```typescript
interface Tenant {
  id: string;
  name: string;
  userCount: number;
  searches7d: number;
  enrichments7d: number;
  exports7d: number;
  lastActive: string | null;
  users: TenantUser[];
}
interface TenantHeatmapProps {
  data: { tenants: Tenant[] } | null;
}
export function TenantHeatmap({ data }: TenantHeatmapProps) { ... }
// Currently renders 6-col table with expand rows
// Will be rebuilt as 5-col mockup table (Client/Tenant, Plan&Rev, Seats, Status, Actions)
```

From src/app/admin/page.tsx:
```typescript
// page.tsx currently: <PlatformPulse data={pulseData} quotaData={quotaData} />
// After Plan 02, PlatformPulse no longer renders ApiQuotaCard
// So page.tsx will need to render Unit Economics and Export Activity as separate cards
// This plan builds the components; Plan 04 wires them into page.tsx
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rebuild api-quota-card as Unit Economics + Create export-activity-chart</name>
  <files>src/components/admin/api-quota-card.tsx, src/components/admin/export-activity-chart.tsx</files>
  <action>
**api-quota-card.tsx — Rebuild as "Unit Economics (Cost/Enrich)":**

Keep the same export name `ApiQuotaCard` and same `ApiQuotaCardProps` interface for backward compatibility. Completely rewrite the rendering.

The Unit Economics card shows hardcoded cost-per-operation for each provider (the current API doesn't return cost data — these are aspirational values per RESEARCH.md).

```tsx
"use client";

interface ApiQuotaCardProps {
  data: { totals: Record<string, number>; days: number } | null;
}

const PROVIDERS = [
  { label: "Apollo",     cost: "$0.012", unit: "/rec" },
  { label: "Exa AI",     cost: "$0.045", unit: "/query" },
  { label: "ContactOut", cost: "$0.080", unit: "/email" },
];

export function ApiQuotaCard({ data }: ApiQuotaCardProps) { ... }
```

**Card structure:**
- `className="surface-admin-card rounded-[14px] p-6 relative overflow-hidden"`
- Header: `<p className="text-[10px] font-semibold uppercase tracking-widest mb-4" style={{ color: "var(--admin-text-secondary)" }}>Unit Economics (Cost/Enrich)</p>`
- Content: `<div className="flex-1 flex flex-col justify-center gap-4">`

**Each provider row:**
```tsx
<div className="flex items-center justify-between pb-2"
     style={{ borderBottom: "1px solid var(--border-subtle)" }}>
  <span className="text-sm" style={{ color: "var(--admin-text-secondary)" }}>
    {provider.label}
  </span>
  <span className="font-mono text-sm" style={{ color: "var(--text-primary-ds)" }}>
    {provider.cost}
    <span className="text-xs ml-0.5" style={{ color: "var(--text-ghost)" }}>
      {provider.unit}
    </span>
  </span>
</div>
```

**Footer:**
```tsx
<div className="mt-auto pt-2 text-right">
  <span className="text-[10px]" style={{ color: "var(--gold-primary)" }}>
    Avg Blended Cost: $0.034
  </span>
</div>
```

**Skeleton state:** Render card shell with 3 placeholder rows.

Remove the `Activity` icon import (no longer needed). Remove `PROVIDERS` constant with key/label format — replace with the new label/cost/unit format.

---

**export-activity-chart.tsx — CREATE NEW:**

A pure CSS mini bar chart showing per-tenant export activity. Receives heatmap data to derive bar heights.

```tsx
"use client";

interface ExportActivityChartProps {
  data: {
    tenants: Array<{
      name: string;
      exports7d: number;
    }>;
  } | null;
}

export function ExportActivityChart({ data }: ExportActivityChartProps) { ... }
```

**Card structure:**
- `className="surface-admin-card rounded-[14px] p-6 flex flex-col"`
- Header: `<p className="text-[10px] font-semibold uppercase tracking-widest mb-4" style={{ color: "var(--admin-text-secondary)" }}>Export Activity (7d)</p>`

**Bar chart area:**
Take the first 5 tenants from data (or fewer if less exist). Compute max export count. Each bar height = `Math.max((tenant.exports7d / maxExports) * 100, 5)%` (minimum 5% so zero-export tenants still show a sliver).

```tsx
<div className="flex-1 flex items-end gap-2 px-2 pb-2 min-h-[120px]">
  {bars.map((bar) => (
    <div
      key={bar.name}
      className="flex-1 rounded-t-sm relative cursor-default"
      style={{
        height: `${bar.heightPct}%`,
        background: "rgba(255,255,255,0.05)",
        transition: "background 0.15s ease",
      }}
      title={`${bar.name}: ${bar.exports} exports`}
      onMouseEnter={(e) => {
        e.currentTarget.style.background = "var(--gold-bg-strong)";
      }}
      onMouseLeave={(e) => {
        e.currentTarget.style.background = "rgba(255,255,255,0.05)";
      }}
    />
  ))}
</div>
```

**Footer axis:**
```tsx
<div className="mt-1" style={{ borderTop: "1px solid rgba(255,255,255,0.10)" }} />
<div className="flex justify-between text-[10px] mt-1" style={{ color: "var(--text-ghost)" }}>
  {bars.map((bar) => (
    <span key={bar.name} className="flex-1 text-center truncate px-0.5">
      {bar.name.split(' ')[0]}
    </span>
  ))}
</div>
```

**Skeleton state:** Card shell + 5 skeleton bars + axis placeholders.
**Empty/no-tenant state:** "No export data yet" centered message.

**Do NOT use Recharts** — this is pure CSS divs per RESEARCH.md guidance.
  </action>
  <verify>
    <automated>cd "/Users/aymanbaig/Desktop/Manual Library/Phronesis-main" && npx tsc --noEmit --pretty 2>&1 | head -30</automated>
  </verify>
  <done>
ApiQuotaCard renders as "Unit Economics" cost table with 3 provider rows and blended cost footer. ExportActivityChart renders as pure CSS mini bar chart from heatmap export data. No TypeScript errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Rebuild TenantHeatmap as mockup-style Tenant Management table</name>
  <files>src/components/admin/tenant-heatmap.tsx</files>
  <action>
Completely rewrite `tenant-heatmap.tsx` to match the mockup's "Tenant Management" table.

**Keep the same export name and props interface:**
```typescript
export function TenantHeatmap({ data }: TenantHeatmapProps)
```
Keep the `Tenant`, `TenantUser`, `TenantHeatmapProps` interfaces.

**Remove:**
- `getHeatmapClass` function (no longer needed — no color-coded metrics)
- `isNewTenant` function (replaced by `is_active` status)
- Expand-row logic (`expandedId`, `handleRowClick`, nested `<table>`)
- `ChevronDown`, `ChevronRight` imports

**Add imports:**
```typescript
import { Building2, LogIn, History, Ban, Filter, Plus } from "lucide-react";
```

**Card structure (replaces bare `<table>` wrapper):**
```tsx
<div className="surface-admin-card rounded-[14px] overflow-hidden relative">
  {/* Decorative blur */}
  <div className="absolute -top-20 -left-20 w-64 h-64 rounded-full blur-3xl pointer-events-none"
       style={{ background: "rgba(212,175,55,0.05)" }} />

  {/* Header */}
  <div className="p-6 flex flex-col md:flex-row justify-between items-start md:items-center gap-4 relative z-10"
       style={{ borderBottom: "1px solid var(--border-subtle)", background: "rgba(255,255,255,0.02)" }}>
    <div>
      <h3 className="text-xl font-serif font-medium flex items-center gap-2"
          style={{ color: "var(--text-primary-ds)" }}>
        Tenant Management
      </h3>
      <p className="text-sm mt-1" style={{ color: "var(--admin-text-secondary)" }}>
        Manage client instances, quotas, revenue tracking, and access controls.
      </p>
    </div>
    <div className="flex gap-3">
      <button
        className="px-4 py-2 rounded-lg text-xs font-medium flex items-center gap-2 transition-colors"
        style={{
          background: "rgba(255,255,255,0.05)",
          border: "1px solid rgba(255,255,255,0.10)",
          color: "var(--admin-text-secondary)",
        }}
        onMouseEnter={(e) => {
          e.currentTarget.style.background = "rgba(255,255,255,0.10)";
          e.currentTarget.style.color = "var(--text-primary-ds)";
        }}
        onMouseLeave={(e) => {
          e.currentTarget.style.background = "rgba(255,255,255,0.05)";
          e.currentTarget.style.color = "var(--admin-text-secondary)";
        }}
      >
        <Filter className="h-4 w-4" /> Filter View
      </button>
      <button
        className="px-4 py-2 rounded-lg text-xs font-bold flex items-center gap-2 transition-colors"
        style={{
          background: "var(--gold-primary)",
          color: "var(--bg-root)",
          boxShadow: "0 0 15px rgba(212,175,55,0.3)",
        }}
      >
        <Plus className="h-4 w-4" /> Provision New Tenant
      </button>
    </div>
  </div>

  {/* Table */}
  <div className="overflow-x-auto relative z-10">
    <table className="w-full text-left border-collapse">
      <thead>
        <tr style={{ background: "rgba(255,255,255,0.02)", borderBottom: "1px solid var(--border-subtle)" }}>
          <th className="px-6 py-4 text-[11px] font-semibold uppercase tracking-wider w-1/4"
              style={{ color: "var(--admin-text-secondary)" }}>Client / Tenant</th>
          <th className="px-6 py-4 text-[11px] font-semibold uppercase tracking-wider"
              style={{ color: "var(--admin-text-secondary)" }}>Plan &amp; Rev</th>
          <th className="px-6 py-4 text-[11px] font-semibold uppercase tracking-wider text-center"
              style={{ color: "var(--admin-text-secondary)" }}>Seats</th>
          <th className="px-6 py-4 text-[11px] font-semibold uppercase tracking-wider"
              style={{ color: "var(--admin-text-secondary)" }}>Status</th>
          <th className="px-6 py-4 text-[11px] font-semibold uppercase tracking-wider text-right"
              style={{ color: "var(--admin-text-secondary)" }}>Actions</th>
        </tr>
      </thead>
      <tbody>
        {tenants.map((tenant) => ( <TenantRow key={tenant.id} tenant={tenant} /> ))}
      </tbody>
    </table>
  </div>

  {/* Footer */}
  <div className="p-4 flex justify-between items-center text-xs"
       style={{ borderTop: "1px solid var(--border-subtle)", background: "rgba(255,255,255,0.02)", color: "var(--admin-text-secondary)" }}>
    <span>Showing {tenants.length} tenant{tenants.length !== 1 ? "s" : ""}</span>
    <div className="flex gap-2">
      <button className="px-3 py-1 rounded text-xs disabled:opacity-50 transition-colors"
              style={{ background: "rgba(255,255,255,0.05)", color: "var(--text-primary-ds)" }}
              disabled>Previous</button>
      <button className="px-3 py-1 rounded text-xs transition-colors"
              style={{ background: "rgba(255,255,255,0.05)", color: "var(--text-primary-ds)" }}>
        Next
      </button>
    </div>
  </div>
</div>
```

**TenantRow rendering — each row:**
- Column 1 (Client/Tenant): Icon avatar (Building2 in 40px rounded-lg box) + tenant.name (text-sm font-semibold) + "ID: {tenant.id.substring(0, 12)}" (text-xs font-mono, ghost color)
- Column 2 (Plan & Rev): Enterprise plan badge (gold bg/border/text, text-[10px] font-bold uppercase) + "---" for MRR (data doesn't exist). Per RESEARCH.md, show dash since DB has no plan/MRR column.
- Column 3 (Seats): `{tenant.userCount}` in font-mono + "/ --" (no seat limit in DB)
- Column 4 (Status): Green dot with glow + "Active" label (derive from tenant data — if all 7d metrics are 0 and no lastActive, could show "Inactive" with red dot; otherwise "Active" with green dot)
- Column 5 (Actions): 3 icon buttons — LogIn (Impersonate), History (Logs), Ban (Suspend). Each with `title`, onMouseEnter/Leave for hover color change.

**Row hover:** Use `onMouseEnter`/`onMouseLeave` on the `<tr>` to set background to `rgba(255,255,255,0.02)`.

**Skeleton state:** Keep a similar skeleton to current but with 5 column skeletons per row.

**Empty state:** Full-width centered "No tenant data available."

**Keep `formatRelativeTime`** — may be useful for tooltip on lastActive.
  </action>
  <verify>
    <automated>cd "/Users/aymanbaig/Desktop/Manual Library/Phronesis-main" && npx tsc --noEmit --pretty 2>&1 | head -30</automated>
  </verify>
  <done>
TenantHeatmap renders as "Tenant Management" card with header (title, subtitle, 2 buttons), 5-column table (Client/Tenant with icon avatar, Plan & Rev with badge, Seats, Status with glow dot, Actions with 3 icon buttons), and pagination footer. No expand rows. No TypeScript errors.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. ApiQuotaCard renders "Unit Economics" with 3 cost rows and blended cost footer
3. ExportActivityChart renders pure CSS bars (no Recharts) from heatmap export data
4. TenantHeatmap renders 5-column table with icon avatars, plan badges, status dots, action buttons
5. All components use CSS variables only — no raw hex, no Tailwind color classes
6. Hover effects use onMouseEnter/Leave pattern (not Tailwind hover: with CSS vars)
</verification>

<success_criteria>
- Unit Economics card matches mockup cost table layout
- Export Activity card shows pure CSS mini bars with hover effect
- Tenant Management table matches mockup 5-column structure
- All 3 components accept their existing prop types (backward-compatible)
- TypeScript compiles cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/14.1-admin-dashboard-rebuild-match-stitch-mockup/14.1-03-SUMMARY.md`
</output>
