---
phase: 14.1-admin-dashboard-rebuild-match-stitch-mockup
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/admin/platform-pulse.tsx
  - src/components/admin/enrichment-health-chart.tsx
autonomous: true
requirements: [SA-01, ANLY-03]

must_haves:
  truths:
    - Platform Pulse card shows 3 metric rows (Total Users, Prospects Scraped, Success Rate) each with label-value pair and thin progress bar
    - Platform Pulse card has decorative background icon (Activity) at top-right with 5% opacity, increasing on hover
    - Platform Pulse card header shows pulsing gold dot + "Platform Pulse" uppercase label
    - Enrichment Health card shows 3 provider rows (Apollo Scraper, Exa Neural, ContactOut) with colored status dots and status badges
    - Status dots have glow shadows — green for Closed, amber+pulse for Half-Open, red for Open
    - Status is heuristically derived from enrichment health data (failures vs successes ratio)
    - Both cards use surface-admin-card with rounded-[14px], CSS variables only — no raw hex or Tailwind color classes
  artifacts:
    - src/components/admin/platform-pulse.tsx
    - src/components/admin/enrichment-health-chart.tsx
  key_links:
    - PlatformPulse receives data prop with totalProspects, enrichmentCoverage, enrichmentFailed, activeUsersToday, activeUsers7dAvg
    - EnrichmentHealthChart receives data prop with per-source daily success/failure counts, derives circuit-breaker state heuristically
---

<objective>
Rebuild PlatformPulse and EnrichmentHealthChart components to match the stitch mockup's visual treatment.

Purpose: The mockup shows a multi-metric Platform Pulse card with inline progress bars (not the current 4 separate stat cards) and a circuit-breaker status card with colored dots (not the current Recharts stacked bar chart). These are the top-left two cards in the 4-column stat row.

Output: Rebuilt platform-pulse.tsx (single multi-metric card) and rebuilt enrichment-health-chart.tsx (circuit-breaker status card with dots and badges).
</objective>

<execution_context>
@/Users/aymanbaig/.claude/get-shit-done/workflows/execute-plan.md
@/Users/aymanbaig/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/14.1-admin-dashboard-rebuild-match-stitch-mockup/14.1-RESEARCH.md

@src/components/admin/platform-pulse.tsx
@src/components/admin/enrichment-health-chart.tsx
@src/app/admin/page.tsx
@design-system/MASTER.md
@stitch/executive_strategy_dashboard_2/screen.png

<interfaces>
<!-- PlatformPulse current interface -->
From src/components/admin/platform-pulse.tsx:
```typescript
interface PlatformPulseProps {
  data: {
    totalProspects: number;
    enrichmentCoverage: number;
    enrichmentFailed: number;
    activeUsersToday: number;
    activeUsers7dAvg: number;
  } | null;
  quotaData?: { totals: Record<string, number>; days: number } | null;
}
// Currently renders 4 StatCards in a grid + ApiQuotaCard
// Will be rebuilt to render a SINGLE card with 3 inline metrics
// IMPORTANT: The new PlatformPulse must NOT render ApiQuotaCard — that moves to page.tsx
```

From src/components/admin/enrichment-health-chart.tsx:
```typescript
interface EnrichmentHealthChartProps {
  data: Array<{
    date: string;
    contactout_success: number;
    contactout_failed: number;
    exa_success: number;
    exa_failed: number;
    edgar_success: number;
    edgar_failed: number;
    claude_success: number;
    claude_failed: number;
  }> | null;
}
// Currently renders Recharts stacked BarChart
// Will be rebuilt to derive circuit-breaker status per provider and render dot+badge rows
```

From src/app/admin/page.tsx:
```typescript
// page.tsx passes: <PlatformPulse data={pulseData} quotaData={quotaData} />
// page.tsx passes: <EnrichmentHealthChart data={enrichmentData} />
// These prop signatures must remain compatible with page.tsx
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rebuild PlatformPulse as single multi-metric card with progress bars</name>
  <files>src/components/admin/platform-pulse.tsx</files>
  <action>
Completely rewrite `platform-pulse.tsx` to render a SINGLE card (not a 4-card grid) matching the mockup's "Platform Pulse" card.

**Props interface change:**
Keep the same `PlatformPulseProps` interface shape (`data` and `quotaData`). The component will now ONLY render itself as one card. Remove the `StatCard` sub-component, the `useCountUp` import, the `ApiQuotaCard` import, and the grid wrapper. The `quotaData` prop is no longer used inside this component but keep it in the interface for backward compatibility (page.tsx will handle quota separately).

**New structure:**
```tsx
"use client";

import { Activity } from "lucide-react";

interface PlatformPulseProps {
  data: {
    totalProspects: number;
    enrichmentCoverage: number;
    enrichmentFailed: number;
    activeUsersToday: number;
    activeUsers7dAvg: number;
  } | null;
  quotaData?: { totals: Record<string, number>; days: number } | null;
}

export function PlatformPulse({ data }: PlatformPulseProps) { ... }
```

**Skeleton state (data === null):**
Render a single `surface-admin-card rounded-[14px] p-6 animate-pulse` card with 3 skeleton metric rows (each: label placeholder + value placeholder + thin bar placeholder).

**Loaded state — card shell:**
- `className="surface-admin-card rounded-[14px] p-6 relative overflow-hidden group"`
- Decorative background icon: `<div className="absolute top-0 right-0 p-4 pointer-events-none opacity-[0.05] group-hover:opacity-[0.10] transition-opacity"><Activity className="h-20 w-20" style={{ color: "var(--gold-primary)" }} /></div>`
- Content wrapper: `<div className="relative z-10">`

**Card header:**
```tsx
<p className="text-[10px] font-semibold uppercase tracking-widest mb-4 flex items-center gap-2"
   style={{ color: "var(--admin-text-secondary)" }}>
  <span className="size-2 rounded-full animate-pulse" style={{ background: "var(--gold-primary)" }} />
  Platform Pulse
</p>
```

**3 metric rows in a `<div className="space-y-4">`:**

Row 1 — Total Users:
- Label: "Active Users" (maps to `data.activeUsersToday`)
- Value: `data.activeUsersToday` displayed with `.toLocaleString()`, font-mono text-lg, color var(--text-primary-ds)
- Progress bar: gold, width = `Math.min(data.activeUsersToday * 10, 100)%` (heuristic — cap at 100%)

Row 2 — Prospects Scraped:
- Label: "Prospects Scraped" (maps to `data.totalProspects`)
- Value: format as "Xk" if >= 1000 using `(data.totalProspects / 1000).toFixed(0) + 'k'`, otherwise `.toLocaleString()`; font-mono text-lg, color var(--text-primary-ds)
- Progress bar: use `var(--gold-primary)`, width = `Math.min((data.totalProspects / 1000) * 10, 100)%` (heuristic)

Row 3 — Success Rate:
- Label: "Success Rate"
- Value: compute as `data.totalProspects > 0 ? Math.round(((data.totalProspects - data.enrichmentFailed) / data.totalProspects) * 100) : 0` + "%" suffix; font-mono text-lg, color var(--success)
- Progress bar: use `var(--success)`, width = successRate%

**Each metric row pattern:**
```tsx
<div>
  <div className="flex justify-between items-end mb-1">
    <span className="text-xs" style={{ color: "var(--admin-text-secondary)" }}>{label}</span>
    <span className="font-mono text-lg" style={{ color: valueColor }}>{displayValue}</span>
  </div>
  <div className="w-full h-1 rounded-full" style={{ background: "rgba(255,255,255,0.05)" }}>
    <div className="h-1 rounded-full transition-all duration-500"
         style={{ width: `${pct}%`, background: barColor }} />
  </div>
</div>
```

**Do NOT:**
- Import or render ApiQuotaCard (that will be handled by page.tsx in a later plan)
- Import useCountUp (no longer needed)
- Use any raw Tailwind color classes (zinc-*, green-*, etc.)
- Use any hex values from the mockup (#221e10, #f1bf27)
  </action>
  <verify>
    <automated>cd "/Users/aymanbaig/Desktop/Manual Library/Phronesis-main" && npx tsc --noEmit --pretty 2>&1 | head -30</automated>
  </verify>
  <done>
PlatformPulse renders as a single card with decorative Activity icon, pulsing gold dot header, and 3 inline metric rows with thin progress bars. Skeleton state renders on null data. No TypeScript errors. No raw hex colors. No Recharts or grid layout.
  </done>
</task>

<task type="auto">
  <name>Task 2: Rebuild EnrichmentHealthChart as circuit-breaker status card with dots and badges</name>
  <files>src/components/admin/enrichment-health-chart.tsx</files>
  <action>
Completely rewrite `enrichment-health-chart.tsx` to render a circuit-breaker status card instead of a Recharts stacked bar chart.

**Remove all Recharts imports** (BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer). Remove SUCCESS_COLORS, FAILED_COLORS constants.

**Keep the same props interface** — the component still receives `data: Array<{ date, *_success, *_failed }> | null`. But instead of rendering a bar chart, it heuristically derives a circuit-breaker status per provider from the most recent day's data.

**Providers to display (3 rows per mockup):**
```typescript
const PROVIDERS = [
  { key: "contactout", label: "Apollo Scraper" },  // Note: Apollo data comes via contactout endpoint in current schema
  { key: "exa",        label: "Exa Neural" },
  { key: "edgar",      label: "ContactOut" },       // Map edgar to ContactOut display label
] as const;
```

Actually — looking at the data shape more carefully, the API returns contactout, exa, edgar, claude. The mockup shows "Apollo Scraper", "Exa Neural", "ContactOut". Map them as:
```typescript
const PROVIDERS = [
  { dataPrefix: "contactout", label: "Apollo Scraper" },
  { dataPrefix: "exa",        label: "Exa Neural" },
  { dataPrefix: "edgar",      label: "ContactOut" },
] as const;
```

**Status derivation heuristic (from RESEARCH.md):**
For each provider, look at the LAST (most recent) entry in the data array:
- `successCount = latestDay[`${prefix}_success`]`
- `failCount = latestDay[`${prefix}_failed`]`
- `total = successCount + failCount`
- If total === 0: status = "closed" (no activity = healthy)
- If failCount / total > 0.5: status = "open"
- If failCount / total > 0.2: status = "half-open"
- Else: status = "closed"

**Status config:**
```typescript
const STATUS_CONFIG = {
  closed:    { color: "var(--success)",        glow: "rgba(34,197,94,0.6)",   label: "Closed",    pulse: false },
  "half-open": { color: "var(--warning)",      glow: "rgba(245,158,11,0.6)",  label: "Half-Open", pulse: true  },
  open:      { color: "oklch(0.62 0.19 22)",   glow: "rgba(239,68,68,0.6)",   label: "Open",      pulse: false },
};
```

**Card structure:**
- `className="surface-admin-card rounded-[14px] p-6 relative overflow-hidden group"`
- Same decorative background icon pattern as PlatformPulse but using `ShieldCheck` icon (import from lucide-react)
- Header: `<p className="text-[10px] font-semibold uppercase tracking-widest mb-4" style={{ color: "var(--admin-text-secondary)" }}>Enrichment Health (CB)</p>`

**Each provider row:**
```tsx
<div className="flex items-center justify-between p-2 rounded"
     style={{ background: "rgba(255,255,255,0.05)", border: "1px solid rgba(255,255,255,0.05)" }}>
  <div className="flex items-center gap-2">
    <div
      className={`size-2 rounded-full ${cfg.pulse ? "animate-pulse" : ""}`}
      style={{ background: cfg.color, boxShadow: `0 0 8px ${cfg.glow}` }}
    />
    <span className="text-xs font-medium" style={{ color: "var(--text-primary-ds)" }}>{provider.label}</span>
  </div>
  <span className="text-[10px] uppercase tracking-wider rounded px-1.5 py-0.5"
        style={{ color: cfg.color, background: `color-mix(in srgb, ${cfg.color} 10%, transparent)`, border: `1px solid color-mix(in srgb, ${cfg.color} 20%, transparent)` }}>
    {cfg.label}
  </span>
</div>
```

Note: For the badge background/border, if `color-mix` is not available, use inline rgba fallbacks matching STATUS_CONFIG colors:
- Closed: `background: "rgba(34,197,94,0.10)"`, `border: "1px solid rgba(34,197,94,0.20)"`
- Half-Open: `background: "rgba(245,158,11,0.10)"`, `border: "1px solid rgba(245,158,11,0.20)"`
- Open: `background: "rgba(239,68,68,0.10)"`, `border: "1px solid rgba(239,68,68,0.20)"`

Store these as `badgeBg` and `badgeBorder` in STATUS_CONFIG.

**Skeleton state (data === null):**
Render the card shell with header + 3 skeleton rows (each `h-10 bg-white/[0.06] rounded animate-pulse`).

**Empty data state (data.length === 0):**
Render the card with "No enrichment data yet" centered message.

**Do NOT:**
- Import Recharts (remove all imports)
- Use raw Tailwind color classes
- Use hex values from the mockup
  </action>
  <verify>
    <automated>cd "/Users/aymanbaig/Desktop/Manual Library/Phronesis-main" && npx tsc --noEmit --pretty 2>&1 | head -30</automated>
  </verify>
  <done>
EnrichmentHealthChart renders as a circuit-breaker status card with 3 provider rows, each showing a colored glow dot and status badge. Status derived heuristically from most recent day's success/failure data. No Recharts imports. No TypeScript errors. No raw hex colors.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. PlatformPulse renders a single card (not a 4-card grid)
3. PlatformPulse shows 3 metric rows with progress bars
4. EnrichmentHealthChart shows 3 provider rows with status dots and badges
5. No Recharts imports remain in enrichment-health-chart.tsx
6. All colors use CSS variables — no raw hex, no raw Tailwind color classes
7. Skeleton states render correctly when data is null
</verification>

<success_criteria>
- PlatformPulse is a single multi-metric card with decorative icon, pulsing dot header, and 3 progress bar metric rows
- EnrichmentHealthChart is a circuit-breaker status card with colored dots, glow shadows, and status label badges
- Both components accept the same prop types as before (backward-compatible with page.tsx)
- TypeScript compiles cleanly
- No Recharts dependency in enrichment-health-chart.tsx
</success_criteria>

<output>
After completion, create `.planning/phases/14.1-admin-dashboard-rebuild-match-stitch-mockup/14.1-02-SUMMARY.md`
</output>
