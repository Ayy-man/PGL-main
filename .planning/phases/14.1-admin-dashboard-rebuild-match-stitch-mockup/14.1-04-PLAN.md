---
phase: 14.1-admin-dashboard-rebuild-match-stitch-mockup
plan: 04
type: execute
wave: 2
depends_on: [14.1-02, 14.1-03]
files_modified:
  - src/components/admin/error-feed.tsx
  - src/components/admin/system-actions.tsx
  - src/app/admin/page.tsx
autonomous: true
requirements: [SA-01, SA-02, SA-03, SA-04, SA-05, ANLY-03]

must_haves:
  truths:
    - Error Feed renders as a vertical card-feed (not a table) with severity icon, title, description, and relative timestamp per entry
    - Error entries show red XCircle icon with red-tinted background for error severity
    - Error Feed has "Live Error Feed" header with red pulsing dot + "Live" label
    - System Actions card shows 2x2 grid of stub buttons (Rotate Master Keys, Flush Cache, Broadcast Alert, Export System Logs)
    - System action buttons show Lucide icon + label, hover transitions border to gold
    - page.tsx header shows "Global Command Center" with status line (OPERATIONAL, version, PGL Core)
    - page.tsx layout is 4-column stat cards row, then Tenant Management full-width, then 2-column bottom (Error Feed left + System Actions right)
    - page.tsx renders PlatformPulse, EnrichmentHealthChart, ApiQuotaCard, ExportActivityChart as 4 individual cards in the top row
    - All data-fetching logic (fetchAll, polling, errorPageRef pattern) is PRESERVED exactly from current page.tsx
  artifacts:
    - src/components/admin/error-feed.tsx
    - src/components/admin/system-actions.tsx
    - src/app/admin/page.tsx
  key_links:
    - page.tsx imports all 7 admin components and wires them into the mockup grid layout
    - ErrorFeed receives same data prop shape and onPageChange callback
    - SystemActions is self-contained with no props (stub buttons)
    - fetchAll pattern preserved — same 6 API calls, same 60s polling, same errorPageRef guard
---

<objective>
Rebuild the Error Feed as a card-feed layout, create the System Actions grid, and rewrite page.tsx to wire all rebuilt components into the mockup's grid layout.

Purpose: This is the final assembly plan — it takes all rebuilt components from Plans 02 and 03 and arranges them in the mockup's layout: 4-column stat row + full-width tenant table + 2-column bottom row (errors + actions). The page header changes from "Platform Health" to "Global Command Center" with a status line.

Output: Rebuilt error-feed.tsx (card feed), new system-actions.tsx (2x2 grid), rebuilt page.tsx (full layout assembly with preserved data fetching).
</objective>

<execution_context>
@/Users/aymanbaig/.claude/get-shit-done/workflows/execute-plan.md
@/Users/aymanbaig/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/14.1-admin-dashboard-rebuild-match-stitch-mockup/14.1-RESEARCH.md

@src/components/admin/error-feed.tsx
@src/app/admin/page.tsx
@design-system/MASTER.md
@stitch/executive_strategy_dashboard_2/screen.png

<interfaces>
From src/components/admin/error-feed.tsx:
```typescript
interface ErrorRecord {
  id: string;
  fullName: string;
  userName: string;
  tenantName: string;
  tenantId: string;
  enrichmentStatus: string;
  sourceDetails: Record<string, { status: string; error?: string; at?: string }>;
  updatedAt: string;
}
interface ErrorFeedProps {
  data: {
    data: ErrorRecord[];
    total: number;
    page: number;
    limit: number;
  } | null;
  onPageChange: (page: number) => void;
}
export function ErrorFeed({ data, onPageChange }: ErrorFeedProps)
// Currently renders a 6-column table with expand rows
// Will be rebuilt as vertical card-feed with severity icons
```

From src/app/admin/page.tsx (data-fetching logic to PRESERVE):
```typescript
// STATE: pulseData, heatmapData, enrichmentData, funnelData, errorData, quotaData
// REFS: errorPageRef
// FETCH: fetchAll with Promise.all of 6 API endpoints
// POLLING: 60-second interval
// TICKER: secondsAgo counter
// ERROR PAGINATION: handleErrorPageChange
// ALL OF THIS MUST BE PRESERVED EXACTLY — only the JSX rendering changes
```

After Plan 02 + 03, the following components exist:
```typescript
// Rebuilt:
import { PlatformPulse } from "@/components/admin/platform-pulse";      // Single card
import { EnrichmentHealthChart } from "@/components/admin/enrichment-health-chart"; // CB status card
import { ApiQuotaCard } from "@/components/admin/api-quota-card";       // Unit Economics card
import { ExportActivityChart } from "@/components/admin/export-activity-chart"; // Mini bar chart
import { TenantHeatmap } from "@/components/admin/tenant-heatmap";      // Tenant Management table
import { ErrorFeed } from "@/components/admin/error-feed";              // Card feed (this plan)
import { SystemActions } from "@/components/admin/system-actions";      // 2x2 grid (this plan)
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rebuild ErrorFeed as card-feed layout + Create SystemActions grid</name>
  <files>src/components/admin/error-feed.tsx, src/components/admin/system-actions.tsx</files>
  <action>
**error-feed.tsx — Rebuild as card-feed:**

Keep the same export name, props interface, and `ErrorFeedProps` type. Remove the table-based rendering. Remove `getSourceBadgeClass`, `SkeletonRow`, `expandedId` state, `handleRowClick`. Remove `ChevronDown`, `ChevronRight`, `Link` imports.

Add imports:
```typescript
import { XCircle, AlertTriangle, Info } from "lucide-react";
```

**Card structure:**
```tsx
<div className="surface-admin-card rounded-[14px] overflow-hidden flex flex-col h-full">
  {/* Header */}
  <div className="p-5 flex justify-between items-center"
       style={{ borderBottom: "1px solid var(--border-subtle)" }}>
    <h3 className="text-sm font-semibold uppercase tracking-wider flex items-center gap-2"
        style={{ color: "var(--text-primary-ds)" }}>
      <XCircle className="h-[18px] w-[18px]" style={{ color: "oklch(0.62 0.19 22)" }} />
      Live Error Feed
    </h3>
    <div className="flex items-center gap-2">
      <span className="size-2 rounded-full animate-pulse" style={{ background: "oklch(0.62 0.19 22)" }} />
      <span className="text-[10px] uppercase" style={{ color: "var(--admin-text-secondary)" }}>Live</span>
    </div>
  </div>

  {/* Error entries — scrollable */}
  <div className="flex-1 overflow-y-auto max-h-[300px]">
    {data.data.map((record) => (
      <ErrorEntry key={record.id} record={record} />
    ))}
  </div>

  {/* Pagination footer — keep existing pagination logic */}
</div>
```

**ErrorEntry sub-component:**
```tsx
function ErrorEntry({ record }: { record: ErrorRecord }) {
  const failedSources = Object.entries(record.sourceDetails)
    .filter(([, d]) => d.status === "failed")
    .map(([k]) => k);

  return (
    <div
      className="flex gap-4 p-4 cursor-pointer"
      style={{ borderBottom: "1px solid var(--border-subtle)" }}
      onMouseEnter={(e) => { e.currentTarget.style.background = "rgba(255,255,255,0.02)"; }}
      onMouseLeave={(e) => { e.currentTarget.style.background = ""; }}
    >
      {/* Severity icon */}
      <div className="mt-0.5 shrink-0">
        <div className="p-1.5 rounded" style={{ color: "oklch(0.62 0.19 22)", background: "rgba(239,68,68,0.1)" }}>
          <XCircle className="h-4 w-4" />
        </div>
      </div>
      {/* Content */}
      <div className="flex-1 min-w-0">
        <div className="flex justify-between items-start">
          <p className="text-sm font-medium" style={{ color: "var(--text-primary-ds)" }}>
            {record.fullName} — Enrichment Failed
          </p>
          <span className="text-[10px] whitespace-nowrap ml-2" style={{ color: "var(--text-ghost)" }}>
            {formatRelativeTime(record.updatedAt)}
          </span>
        </div>
        <p className="text-xs mt-0.5" style={{ color: "var(--admin-text-secondary)" }}>
          Tenant: {record.tenantName}
          {failedSources.length > 0 && ` · Failed: ${failedSources.join(", ")}`}
        </p>
      </div>
    </div>
  );
}
```

**Keep `formatRelativeTime` helper.** Keep pagination footer — adapt from table footer to match card layout:
```tsx
{totalPages > 1 && (
  <div className="p-4 flex items-center justify-between text-xs"
       style={{ borderTop: "1px solid var(--border-subtle)", color: "var(--admin-text-secondary)" }}>
    <span>Page {data.page} of {totalPages}</span>
    <div className="flex gap-2">
      <button onClick={() => onPageChange(data.page - 1)} disabled={data.page <= 1}
              className="px-3 py-1 rounded text-xs disabled:opacity-40 disabled:cursor-not-allowed transition-colors"
              style={{ background: "rgba(255,255,255,0.05)", color: "var(--text-primary-ds)" }}>
        Previous
      </button>
      <button onClick={() => onPageChange(data.page + 1)} disabled={data.page >= totalPages}
              className="px-3 py-1 rounded text-xs disabled:opacity-40 disabled:cursor-not-allowed transition-colors"
              style={{ background: "rgba(255,255,255,0.05)", color: "var(--text-primary-ds)" }}>
        Next
      </button>
    </div>
  </div>
)}
```

**Skeleton state (data === null):** Card shell with header + 3 skeleton entry placeholders.
**Empty state (data.data.length === 0):** "No failed enrichments found." centered.

---

**system-actions.tsx — CREATE NEW:**

Self-contained component, no props (all actions are stubs).

```tsx
"use client";

import { Key, Database, Megaphone, Download, Zap } from "lucide-react";

const SYSTEM_ACTIONS = [
  { icon: Key,       label: "Rotate Master Keys" },
  { icon: Database,  label: "Flush Cache (Global)" },
  { icon: Megaphone, label: "Broadcast Alert" },
  { icon: Download,  label: "Export System Logs" },
];

export function SystemActions() {
  return (
    <div className="surface-admin-card rounded-[14px] overflow-hidden flex flex-col h-full">
      {/* Header */}
      <div className="p-5" style={{ borderBottom: "1px solid var(--border-subtle)" }}>
        <h3 className="text-sm font-semibold uppercase tracking-wider flex items-center gap-2"
            style={{ color: "var(--text-primary-ds)" }}>
          <Zap className="h-[18px] w-[18px]" style={{ color: "var(--gold-primary)" }} />
          System Actions
        </h3>
      </div>

      {/* 2x2 Grid */}
      <div className="p-5 grid grid-cols-2 gap-4 flex-1">
        {SYSTEM_ACTIONS.map(({ icon: Icon, label }) => (
          <button
            key={label}
            className="p-4 rounded-lg flex flex-col items-start gap-2 text-left transition-all"
            style={{
              background: "rgba(255,255,255,0.02)",
              border: "1px solid var(--border-subtle)",
            }}
            onMouseEnter={(e) => {
              e.currentTarget.style.background = "rgba(255,255,255,0.05)";
              e.currentTarget.style.borderColor = "rgba(212,175,55,0.30)";
              const icon = e.currentTarget.querySelector("svg");
              if (icon) icon.style.color = "var(--gold-primary)";
            }}
            onMouseLeave={(e) => {
              e.currentTarget.style.background = "rgba(255,255,255,0.02)";
              e.currentTarget.style.borderColor = "var(--border-subtle)";
              const icon = e.currentTarget.querySelector("svg");
              if (icon) icon.style.color = "var(--admin-text-secondary)";
            }}
            onClick={() => {
              // Stub — no-op for now
              console.log(`[SystemActions] ${label} clicked (stub)`);
            }}
            title="Coming soon"
          >
            <Icon className="h-5 w-5 transition-colors" style={{ color: "var(--admin-text-secondary)" }} />
            <span className="text-sm font-medium" style={{ color: "var(--text-primary-ds)" }}>
              {label}
            </span>
          </button>
        ))}
      </div>
    </div>
  );
}
```
  </action>
  <verify>
    <automated>cd "/Users/aymanbaig/Desktop/Manual Library/Phronesis-main" && npx tsc --noEmit --pretty 2>&1 | head -30</automated>
  </verify>
  <done>
ErrorFeed renders as card-feed with severity icons, timestamps, and pagination. SystemActions renders as 2x2 grid of stub buttons with hover effects. No TypeScript errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Rewrite page.tsx layout assembly — Global Command Center with all rebuilt components</name>
  <files>src/app/admin/page.tsx</files>
  <action>
Rewrite the JSX rendering in `page.tsx` to match the mockup's grid layout. **CRITICAL: Preserve ALL data-fetching logic exactly as-is** — the `fetchAll`, `useCallback`, `useRef(errorPage)`, polling `useEffect`, ticker `useEffect`, `handleErrorPageChange`, all state variables, all types, and the `formatSecondsAgo` helper.

**Import changes:**
```typescript
// Remove:
import { FunnelChart as FunnelChartComponent } from "@/components/admin/funnel-chart";

// Add:
import { ExportActivityChart } from "@/components/admin/export-activity-chart";
import { SystemActions } from "@/components/admin/system-actions";

// Keep:
import { PlatformPulse } from "@/components/admin/platform-pulse";
import { TenantHeatmap } from "@/components/admin/tenant-heatmap";
import { EnrichmentHealthChart } from "@/components/admin/enrichment-health-chart";
import { ErrorFeed } from "@/components/admin/error-feed";
import { RefreshCw } from "lucide-react";
```

Note: `ApiQuotaCard` is now rendered directly by PlatformPulse in Plan 02 — WAIT, no. Plan 02 REMOVED ApiQuotaCard from PlatformPulse. So page.tsx needs to import and render it directly:
```typescript
import { ApiQuotaCard } from "@/components/admin/api-quota-card";
```

**State variables:** Keep ALL existing state: `pulseData`, `heatmapData`, `enrichmentData`, `funnelData`, `errorData`, `quotaData`, `lastFetched`, `isRefreshing`, `errorPage`, `secondsAgo`. Note: `funnelData` is still fetched (the API call remains) but won't be rendered — that's fine, it doesn't hurt to fetch it.

**New JSX layout (replace entire return statement):**

```tsx
return (
  <div className="space-y-8 page-enter">
    {/* Header — Global Command Center */}
    <div className="flex items-center justify-between">
      <div>
        <h2 className="font-medium tracking-wide"
            style={{ fontSize: "18px", color: "var(--text-primary-ds)" }}>
          Global Command Center
        </h2>
        <p className="text-xs flex items-center gap-2 mt-0.5"
           style={{ color: "var(--admin-text-secondary)" }}>
          System Status:{" "}
          <span className="font-mono tracking-tight" style={{ color: "var(--success)" }}>
            OPERATIONAL
          </span>
          {" "}• v2.5.0 •{" "}
          <span style={{ color: "var(--gold-text)" }}>PGL Core</span>
        </p>
      </div>
      <div className="flex items-center gap-3 text-sm" style={{ color: "var(--admin-text-secondary)" }}>
        {isRefreshing && (
          <RefreshCw className="h-4 w-4 animate-spin" style={{ color: "var(--gold-primary)" }} />
        )}
        {lastFetched && (
          <span className="text-xs">Updated {formatSecondsAgo(secondsAgo)}</span>
        )}
      </div>
    </div>

    {/* Section 1: 4-column stat cards */}
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
      <PlatformPulse data={pulseData} quotaData={quotaData} />
      <EnrichmentHealthChart data={enrichmentData} />
      <ApiQuotaCard data={quotaData} />
      <ExportActivityChart data={heatmapData} />
    </div>

    {/* Section 2: Tenant Management (full-width) */}
    <TenantHeatmap data={heatmapData} />

    {/* Section 3: Bottom 2-column — Error Feed + System Actions */}
    <div className="grid grid-cols-1 md:grid-cols-2 gap-6 pb-6">
      <ErrorFeed data={errorData} onPageChange={handleErrorPageChange} />
      <SystemActions />
    </div>
  </div>
);
```

**Key differences from current page.tsx:**
1. Header: "Global Command Center" (18px, not serif 38px) with status line instead of "Platform Health"
2. Section 1: 4 individual cards in a grid (not PlatformPulse rendering all 4)
3. Section 2: TenantHeatmap alone (no section heading wrapper)
4. Section 3: 2-column bottom with ErrorFeed + SystemActions (not full-width error table)
5. FunnelChart is no longer rendered (still fetched — data goes to `funnelData` state but unused in JSX)
6. Enrichment chart section heading removed (it's a standalone card now)
7. Section headings (`<h2>`) are removed — each card has its own internal header per mockup

**Do NOT:**
- Touch fetchAll or any useEffect/useCallback/useRef
- Remove any state variables (even funnelData — it's harmless)
- Change API endpoints
- Remove the 60s polling interval
- Remove the errorPageRef pattern
  </action>
  <verify>
    <automated>cd "/Users/aymanbaig/Desktop/Manual Library/Phronesis-main" && npx tsc --noEmit --pretty 2>&1 | head -30</automated>
  </verify>
  <done>
page.tsx renders "Global Command Center" header with status line, 4-column stat card grid (PlatformPulse, EnrichmentHealthChart, ApiQuotaCard, ExportActivityChart), full-width TenantHeatmap, and 2-column bottom row (ErrorFeed + SystemActions). All data-fetching logic preserved. No TypeScript errors.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. Page header says "Global Command Center" with OPERATIONAL status line
3. 4 stat cards render in a row (Platform Pulse, Enrichment Health, Unit Economics, Export Activity)
4. Tenant Management table renders full-width below stat cards
5. Bottom section shows Error Feed (left) and System Actions (right) in 2-column grid
6. Error Feed displays card-feed entries with red severity icons
7. System Actions shows 2x2 button grid with hover effects
8. 60-second polling continues to work
9. Error feed pagination works
10. All colors use CSS variables — no raw hex
</verification>

<success_criteria>
- Admin dashboard layout matches the stitch mockup grid structure
- All 7 admin components render correctly in their positions
- Data fetching and polling logic is 100% preserved from the original page.tsx
- Error feed pagination works
- System action buttons are stubs with "Coming soon" title
- TypeScript compiles cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/14.1-admin-dashboard-rebuild-match-stitch-mockup/14.1-04-SUMMARY.md`
</output>
