# Plan 13-03: Design System Compliance Pass on Admin Components + Page Polish

---
phase: 13-admin-dashboard
plan: 03
type: execute
wave: 2
depends_on: [13-01, 13-02]
files_modified:
  - src/components/admin/tenant-heatmap.tsx
  - src/components/admin/enrichment-health-chart.tsx
  - src/components/admin/funnel-chart.tsx
  - src/components/admin/error-feed.tsx
  - src/app/admin/page.tsx
autonomous: true
requirements: [SA-01, SA-02, SA-03, SA-04, ANLY-03]

must_haves:
  truths:
    - "All admin table headers use text-[11px] font-semibold uppercase tracking-wider styling per dashboard.md override"
    - "All admin table row borders use var(--admin-row-border) — no raw Tailwind border classes"
    - "All text colors use CSS variables (--admin-text-secondary, --text-secondary, --text-ghost, --gold-primary) — no raw Tailwind text-white/* classes"
    - "Admin page header uses font-serif (Cormorant Garamond) for h1 per MASTER.md h1 spec"
    - "Admin page has page-enter fade-in class on the top-level container"
    - "Chart tooltips use var(--card) background, var(--border) border, 8px radius"
    - "Enrichment chart and funnel chart section title labels use text-xs not text-sm"
  artifacts:
    - path: "src/components/admin/tenant-heatmap.tsx"
      provides: "Design-system-compliant tenant heatmap table"
    - path: "src/components/admin/enrichment-health-chart.tsx"
      provides: "Design-system-compliant enrichment health chart"
    - path: "src/components/admin/funnel-chart.tsx"
      provides: "Design-system-compliant funnel chart"
    - path: "src/components/admin/error-feed.tsx"
      provides: "Design-system-compliant error feed table"
    - path: "src/app/admin/page.tsx"
      provides: "Polished admin page with design system compliant header"
  key_links:
    - from: "src/app/admin/page.tsx"
      to: "all admin components"
      via: "imports and renders each component in section layout"
      pattern: "PlatformPulse|TenantHeatmap|EnrichmentHealthChart|FunnelChart|ErrorFeed"
---

<objective>
Run a design system compliance pass across all admin dashboard components, fixing CSS variable usage, typography, table styling, and page-level polish to match MASTER.md and dashboard.md override specs.

Purpose: The existing admin components are functionally complete but contain minor deviations from the design system: some table headers use text-sm instead of text-xs, some chart labels use text-sm instead of text-xs, the expanded row background uses raw `bg-white/[0.05]` where admin tokens exist, and a few text colors use Tailwind muted classes instead of CSS variables. This plan aligns them all.

Output: All 5 admin components and the page itself fully comply with the design system. No functional changes — styling refinements only.
</objective>

<execution_context>
@/Users/aymanbaig/.claude/get-shit-done/workflows/execute-plan.md
@/Users/aymanbaig/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/phases/13-admin-dashboard/13-RESEARCH.md

@src/components/admin/tenant-heatmap.tsx
@src/components/admin/enrichment-health-chart.tsx
@src/components/admin/funnel-chart.tsx
@src/components/admin/error-feed.tsx
@src/app/admin/page.tsx
@design-system/MASTER.md
@design-system/pages/dashboard.md

<interfaces>
Design system compliance checklist (from 13-RESEARCH.md):
```
- [ ] All stat card values: font-serif at 36px, gold if non-zero, --text-secondary if zero
- [ ] All labels: text-xs font-semibold uppercase tracking-wider, color --admin-text-secondary
- [ ] All card containers: surface-admin-card class
- [ ] Section headings: font-serif text-xl font-semibold mb-4 admin-section-heading
- [ ] Table headers: text-[11px] font-semibold uppercase tracking-wider, color --admin-text-secondary
- [ ] Table row borders: var(--admin-row-border)
- [ ] Table row hover: admin-row-hover class
- [ ] Table thead: admin-thead class
- [ ] Chart tooltips: background var(--card), border 1px solid var(--border), borderRadius 8px
- [ ] Empty states: centered muted text
- [ ] No raw Tailwind color classes (text-white/40, bg-white/5) — use CSS variable equivalents
- [ ] Icons: All h-4 w-4 shrink-0, Lucide only
- [ ] No scale transforms on hover
- [ ] Page fade-in: page-enter class
```

Admin CSS tokens (from globals.css):
```css
--admin-card-bg: linear-gradient(145deg, rgba(255,255,255,0.07), rgba(255,255,255,0.03));
--admin-border: rgba(255,255,255,0.12);
--admin-thead-bg: rgba(255,255,255,0.05);
--admin-row-hover: rgba(255,255,255,0.04);
--admin-row-border: rgba(255,255,255,0.07);
--admin-text-secondary: rgba(232,228,220,0.65);
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Compliance pass on TenantHeatmap and ErrorFeed table components</name>
  <files>src/components/admin/tenant-heatmap.tsx, src/components/admin/error-feed.tsx</files>
  <action>
**File 1: `src/components/admin/tenant-heatmap.tsx`** — Fix the following:

1. **Table header typography**: Change all `<th>` elements from `font-medium` to match dashboard.md spec:
   ```diff
   - <th className="py-3 px-4 text-left font-medium" style={{ color: "var(--admin-text-secondary)" }}>
   + <th className="py-3 px-4 text-left text-[11px] font-semibold uppercase tracking-wider" style={{ color: "var(--admin-text-secondary)" }}>
   ```
   Apply this to ALL `<th>` elements in both the skeleton thead and the real data thead (6 headers each).

2. **Expanded row background**: Replace raw Tailwind `bg-white/[0.05]` with the admin token:
   ```diff
   - <td colSpan={6} className="bg-white/[0.05] pl-10 pr-4 py-3">
   + <td colSpan={6} className="pl-10 pr-4 py-3" style={{ background: "var(--admin-thead-bg)" }}>
   ```
   Using `--admin-thead-bg` (rgba(255,255,255,0.05)) which is the exact same value but via the token system.

3. **Nested table header typography**: The per-user breakdown sub-table headers should also use the smaller admin table style:
   ```diff
   - <th className="py-1.5 pr-4 text-left text-muted-foreground font-medium">
   + <th className="py-1.5 pr-4 text-left text-[11px] font-semibold uppercase tracking-wider" style={{ color: "var(--admin-text-secondary)" }}>
   ```
   Apply to all 4 nested table headers (User, Searches, Enrichments, Exports).

4. **Nested table border**: Replace raw class with CSS variable:
   ```diff
   - <tr className="border-b border-[var(--border-subtle)]/50">
   + <tr style={{ borderBottom: "1px solid var(--admin-row-border)" }}>
   ```
   And for the user rows:
   ```diff
   - <tr key={user.id} className="border-b border-[var(--border-subtle)]/30 last:border-0">
   + <tr key={user.id} style={{ borderBottom: "1px solid var(--admin-row-border)" }} className="last:border-0">
   ```

Do NOT modify:
- The `getHeatmapClass()` function (heatmap coloring logic)
- The `isNewTenant()` detection logic
- The expand/collapse interaction
- The `formatRelativeTime()` function
- The `admin-row-hover` class usage (already correct)

**File 2: `src/components/admin/error-feed.tsx`** — Fix the following:

1. **Table header typography**: Same change as TenantHeatmap — all `<th>` elements in both skeleton and real thead:
   ```diff
   - <th className="py-3 px-4 text-left font-medium" style={{ color: "var(--admin-text-secondary)" }}>
   + <th className="py-3 px-4 text-left text-[11px] font-semibold uppercase tracking-wider" style={{ color: "var(--admin-text-secondary)" }}>
   ```
   Apply to ALL 6 headers in both the skeleton and data theads (12 changes total).

2. **Expanded row background**: Replace raw Tailwind with admin token:
   ```diff
   - className="bg-white/[0.05] border-l-2 border-primary/50 px-6 py-3"
   + className="border-l-2 px-6 py-3"
   + style={{ background: "var(--admin-thead-bg)", borderLeftColor: "var(--gold-primary)" }}
   ```
   Note: Also replacing `border-primary/50` with gold variable for the left accent border, matching the design system's gold left-border pattern used in profile-view AI summary.

3. **Skeleton row border**: Replace raw class with admin token:
   ```diff
   - <tr className="border-b border-[var(--border-subtle)] animate-pulse">
   + <tr className="animate-pulse" style={{ borderBottom: "1px solid var(--admin-row-border)" }}>
   ```

Do NOT modify:
- The `getSourceBadgeClass()` function (status badge coloring)
- The pagination logic or button styling
- The expand/collapse interaction
- The `admin-row-hover` or `admin-thead` class usage (already correct)
- The `formatRelativeTime()` function
  </action>
  <verify>
    <automated>cd /Users/aymanbaig/Desktop/Manual\ Library/Phronesis-main && pnpm build 2>&1 | tail -15</automated>
  </verify>
  <done>
    - All table headers in TenantHeatmap and ErrorFeed use `text-[11px] font-semibold uppercase tracking-wider` with `var(--admin-text-secondary)` color
    - Expanded row backgrounds use `var(--admin-thead-bg)` instead of raw `bg-white/[0.05]`
    - Error feed expanded row left border uses `var(--gold-primary)` instead of `border-primary/50`
    - Nested table headers and borders in TenantHeatmap use admin CSS tokens
    - No raw Tailwind border/bg classes remaining in table elements
    - `pnpm build` passes
  </done>
</task>

<task type="auto">
  <name>Task 2: Compliance pass on EnrichmentHealthChart and FunnelChart + admin page header polish</name>
  <files>src/components/admin/enrichment-health-chart.tsx, src/components/admin/funnel-chart.tsx, src/app/admin/page.tsx</files>
  <action>
**File 1: `src/components/admin/enrichment-health-chart.tsx`** — Fix the following:

1. **Chart section label typography**: Change from `text-sm font-medium` to `text-xs font-semibold uppercase tracking-wider`:
   ```diff
   - <p className="text-sm font-medium mb-4" style={{ color: "var(--admin-text-secondary)" }}>
   + <p className="text-xs font-semibold uppercase tracking-wider mb-4" style={{ color: "var(--admin-text-secondary)" }}>
   ```
   Apply this to ALL three occurrences of the section label (skeleton, empty state, and data states).

2. **Chart container border radius**: The `surface-admin-card` class already applies `rounded: 14px`, but the chart also has `p-6` which is correct per dashboard.md override (28px padding but p-6 = 24px is close enough — the p-7 override is for the outer chart container only, p-6 is acceptable for admin cards).

   No change needed for padding or radius — `surface-admin-card p-6` is correct.

3. **Tooltip styling**: Already correct — uses `var(--card)`, `var(--border)`, `borderRadius: "8px"`. No change needed.

4. **Legend styling**: Already uses `var(--muted-foreground)`. No change needed.

Do NOT modify:
- SUCCESS_COLORS or FAILED_COLORS arrays (OKLCH palette is correct)
- Bar animation settings
- The Recharts component structure
- CartesianGrid or axis styling

**File 2: `src/components/admin/funnel-chart.tsx`** — Fix the following:

1. **Chart section label typography**: Same change as EnrichmentHealthChart:
   ```diff
   - <p className="text-sm font-medium mb-4" style={{ color: "var(--admin-text-secondary)" }}>
   + <p className="text-xs font-semibold uppercase tracking-wider mb-4" style={{ color: "var(--admin-text-secondary)" }}>
   ```
   Apply to ALL three occurrences (skeleton, empty state, and data states).

Do NOT modify:
- FUNNEL_COLORS array
- useMemo on funnelData or cells (prevents Recharts color reconciliation bug — Phase 04 decision)
- Tooltip styling (already correct)
- LabelList styling (already correct)

**File 3: `src/app/admin/page.tsx`** — Admin page header polish:

1. **Page title h1**: The current h1 uses `text-3xl font-bold` but MASTER.md h1 spec is 38px weight 500. Update:
   ```diff
   - <h1 className="font-serif text-3xl font-bold tracking-tight">
   + <h1 className="font-serif font-medium tracking-tight" style={{ fontSize: "38px", letterSpacing: "-0.5px" }}>
   ```
   This matches MASTER.md h1: 38px, weight 500 (font-medium), letter-spacing -0.5px.

2. **Verify page-enter class**: The page-enter class is applied by the admin layout.tsx wrapper (`<div className="page-enter p-6 lg:p-8">`), so the page component itself does NOT need it. Confirm and leave as-is.

3. **Verify section headings**: All section h2 elements already use `font-serif text-xl font-semibold mb-4 admin-section-heading`. No change needed.

Do NOT modify:
- The 60-second polling interval
- The error feed pagination callback
- The seconds-ago ticker
- Any state management or data fetching logic
- The overall page layout structure (space-y-8 sections)
  </action>
  <verify>
    <automated>cd /Users/aymanbaig/Desktop/Manual\ Library/Phronesis-main && pnpm build 2>&1 | tail -15</automated>
  </verify>
  <done>
    - EnrichmentHealthChart section labels use `text-xs font-semibold uppercase tracking-wider` (3 occurrences updated)
    - FunnelChart section labels use `text-xs font-semibold uppercase tracking-wider` (3 occurrences updated)
    - Admin page h1 uses 38px font-medium with -0.5px letter-spacing per MASTER.md h1 spec
    - Chart tooltips remain correctly styled (var(--card) bg, var(--border) border, 8px radius)
    - FunnelChart useMemo on data and cells preserved (no Recharts color bug regression)
    - `pnpm build` passes
  </done>
</task>

</tasks>

<verification>
Full design system compliance checklist (from 13-RESEARCH.md):

- [x] All stat card values: font-serif at 36px, gold if non-zero (already correct from platform-pulse.tsx)
- [x] All labels: text-xs font-semibold uppercase tracking-wider, color --admin-text-secondary (updated in charts)
- [x] All card containers: surface-admin-card class (already correct everywhere)
- [x] Section headings: font-serif text-xl font-semibold mb-4 admin-section-heading (already correct)
- [x] Table headers: text-[11px] font-semibold uppercase tracking-wider (updated in heatmap + error feed)
- [x] Table row borders: var(--admin-row-border) (updated in heatmap + error feed)
- [x] Table row hover: admin-row-hover class (already correct)
- [x] Table thead: admin-thead class (already correct)
- [x] Chart tooltips: correct (already correct)
- [x] Empty states: centered muted text (already correct)
- [x] No raw Tailwind color classes for text/borders in table elements (updated)
- [x] Icons: All h-4 w-4 shrink-0, Lucide only (already correct)
- [x] No scale transforms on hover (already correct)
- [x] Page fade-in: page-enter class (applied by layout.tsx, correct)
- [x] H1 matches MASTER.md spec: 38px, weight 500, -0.5px tracking

Final check: `pnpm build` passes with no errors.
</verification>

<success_criteria>
- `pnpm build` passes clean
- All 14 design system compliance items pass
- No raw Tailwind color classes remain in admin table headers, borders, or expanded rows
- Chart section labels are `text-xs` not `text-sm`
- Page h1 is 38px font-medium matching MASTER.md h1 spec
- No functional regressions — all interactions (expand/collapse, pagination, polling) unchanged
</success_criteria>

<output>
After completion, create `.planning/phases/13-admin-dashboard/13-03-SUMMARY.md`
</output>
