---
phase: 08-lead-search
plan: 05
type: execute
wave: 3
depends_on: [08-04]
files_modified: []
autonomous: true
requirements: [UI-01, UI-02, UI-03, UI-05, UI-06]

must_haves:
  truths:
    - "pnpm build completes without errors"
    - "No raw Tailwind color classes in any search component"
    - "All search components use CSS variables from design system"
    - "All new components use font-serif for headings, font-sans for body"
    - "All interactive elements have cursor-pointer"
    - "Slide-over panel controlled by URL param"
  artifacts:
    - path: "src/app/[orgId]/search/components/search-content.tsx"
      provides: "Verified unified layout"
    - path: "src/app/[orgId]/search/components/persona-pills.tsx"
      provides: "Verified persona pills"
    - path: "src/app/[orgId]/search/components/nl-search-bar.tsx"
      provides: "Verified NL search bar"
    - path: "src/app/[orgId]/search/components/advanced-filters-panel.tsx"
      provides: "Verified advanced filters"
    - path: "src/app/[orgId]/search/components/bulk-actions-bar.tsx"
      provides: "Verified bulk actions"
  key_links:
    - from: "search-content.tsx"
      to: "all search components"
      via: "imports verified"
      pattern: "import.*from"
---

<objective>
Build verification and design system compliance audit for Phase 8 search page redesign.

Purpose: Verify everything compiles, no design system violations exist, all components are properly wired, and the search page is ready for visual testing on Vercel.
Output: Clean build, verified compliance, phase complete
</objective>

<execution_context>
@/Users/aymanbaig/.claude/get-shit-done/workflows/execute-plan.md
@/Users/aymanbaig/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/phases/08-lead-search/08-04-SUMMARY.md
@design-system/MASTER.md
@design-system/pages/search.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run pnpm build and fix any TypeScript/compilation errors</name>
  <files></files>
  <action>
  Run `pnpm build` from the project root. If the build fails:

  1. Read the error output carefully.
  2. Fix each error in the affected file:
     - TypeScript type errors: fix type mismatches, add missing types
     - Import errors: fix paths, add missing exports
     - ESLint errors: fix per the eslint config (suppress unused-vars with eslint-disable comments if needed for callback params)
  3. Re-run `pnpm build` after fixes until it passes clean.

  Known expectations:
  - `img-element` warnings are pre-existing linting warnings (not errors) — ignore
  - `Dynamic server usage` messages for cookie-using API routes are expected and informational — ignore
  - Any new errors from Phase 8 changes must be fixed

  If build passes on first run, no changes needed.
  </action>
  <verify>
    <automated>cd /Users/aymanbaig/Desktop/Manual\ Library/Phronesis-main && pnpm build 2>&1 | tail -5</automated>
  </verify>
  <done>pnpm build completes without errors (warnings acceptable)</done>
</task>

<task type="auto">
  <name>Task 2: Design system compliance audit for all Phase 8 search components</name>
  <files></files>
  <action>
  Audit ALL search component files created/modified in Phase 8 for design system compliance. Check each file against the design system rules:

  **Files to audit:**
  - `src/app/[orgId]/search/components/search-content.tsx`
  - `src/app/[orgId]/search/components/persona-pills.tsx`
  - `src/app/[orgId]/search/components/nl-search-bar.tsx`
  - `src/app/[orgId]/search/components/advanced-filters-panel.tsx`
  - `src/app/[orgId]/search/components/bulk-actions-bar.tsx`
  - `src/app/[orgId]/search/components/prospect-result-card.tsx`
  - `src/app/[orgId]/search/hooks/use-search.ts`
  - `src/app/api/search/apollo/route.ts`
  - `src/lib/apollo/schemas.ts`

  **Compliance checks (run grep for each):**

  1. **No raw Tailwind color classes:** Search for `zinc-`, `gray-`, `emerald-`, `yellow-`, `blue-`, `red-`, `green-` in class strings. Zero tolerance.
     ```bash
     grep -rn "zinc-\|gray-\|emerald-\|yellow-\|blue-\|red-\|green-" src/app/[orgId]/search/components/*.tsx | grep -v "node_modules"
     ```

  2. **No inline hex/rgba in className:** Search for hex colors (#xxx) and rgba() in className strings. CSS variable style attributes are OK.
     ```bash
     grep -rn "className.*#[0-9a-f]" src/app/[orgId]/search/components/*.tsx
     ```

  3. **Font-serif for headings only:** Verify `font-serif` is used on h1/h2/h3/card-title elements, not body text or labels.

  4. **cursor-pointer on all clickable elements:** Check all `<button>`, `onClick`, and interactive elements have `cursor-pointer`.

  5. **No scale transforms on hover:** Search for `scale-` in hover contexts.
     ```bash
     grep -rn "hover:scale\|scale(" src/app/[orgId]/search/components/*.tsx
     ```

  6. **Lucide icons only:** Verify no emoji icons, no Heroicons imports.
     ```bash
     grep -rn "from.*heroicons\|from.*@heroicons" src/app/[orgId]/search/components/*.tsx
     ```

  7. **ProspectSlideOver import source:** Verify it comes from `@/components/prospect/prospect-slide-over` (shared), not a local file.

  8. **WealthTierBadge import source:** Verify prospect-result-card.tsx imports from `@/components/ui/wealth-tier-badge` (shared).

  9. **Local wealth-tier-badge.tsx deleted:** Confirm `src/app/[orgId]/search/components/wealth-tier-badge.tsx` does NOT exist.

  10. **page-enter class on root element:** Verify search-content.tsx root div has `page-enter` class for fade-in animation.

  11. **useSearch hook has prospect param:** Verify `prospect.*parseAsString` exists in use-search.ts.

  12. **API route accepts filterOverrides:** Verify `filterOverrides` exists in route.ts and schemas.ts.

  For any violation found, fix the file directly. Then re-run `pnpm build` to verify fixes don't break compilation.
  </action>
  <verify>
    <automated>cd /Users/aymanbaig/Desktop/Manual\ Library/Phronesis-main && echo "=== Raw Tailwind colors ===" && grep -rn "zinc-\|gray-\|emerald-\|yellow-\|blue-\|red-\|green-" src/app/\[orgId\]/search/components/*.tsx 2>/dev/null | grep -v "node_modules" | wc -l && echo "=== Scale transforms ===" && grep -rn "hover:scale\|scale(" src/app/\[orgId\]/search/components/*.tsx 2>/dev/null | wc -l && echo "=== Local WealthTierBadge ===" && test ! -f src/app/\[orgId\]/search/components/wealth-tier-badge.tsx && echo "DELETED" && echo "=== page-enter class ===" && grep -c "page-enter" src/app/\[orgId\]/search/components/search-content.tsx && echo "=== prospect param ===" && grep -c "prospect.*parseAsString" src/app/\[orgId\]/search/hooks/use-search.ts</automated>
  </verify>
  <done>All 12 compliance checks pass: zero raw Tailwind colors, zero scale transforms, local WealthTierBadge deleted, page-enter present, prospect param present, all imports from shared components</done>
</task>

<task type="auto">
  <name>Task 3: Update STATE.md and ROADMAP.md to reflect Phase 8 completion</name>
  <files></files>
  <action>
  1. Update `.planning/STATE.md`:
     - Change "Current Position" section:
       - Phase: 8 of 9 (Lead Search)
       - Plan: 5 of 5 — COMPLETE
       - Status: Phase 8 complete — ready for Phase 9 (Prospect Profile)
       - Last activity: current date — Phase 8 Plan 05 complete: pnpm build passes, design system compliance audit passed
     - Update progress bar to reflect Phase 8 completion
     - Add Phase 08 plan completion table to Performance Metrics

  2. Update `.planning/ROADMAP.md`:
     - Add `**Status:** All 5 plans complete (08-01 through 08-05). Unified search layout with NL bar, persona pills, advanced filters, bulk actions, result cards with checkboxes, slide-over wired via URL params. Build verified, design system compliance audited.` to Phase 8 section.
     - Change Phase 8 status to COMPLETE.
  </action>
  <verify>
    <automated>cd /Users/aymanbaig/Desktop/Manual\ Library/Phronesis-main && grep -c "Phase 8 complete" .planning/STATE.md && grep -c "COMPLETE" .planning/ROADMAP.md | head -1</automated>
  </verify>
  <done>STATE.md and ROADMAP.md updated to reflect Phase 8 completion with current status</done>
</task>

</tasks>

<verification>
- `pnpm build` passes without errors
- Zero raw Tailwind color classes in search components
- Zero scale transforms on hover
- Local wealth-tier-badge.tsx deleted
- page-enter class present on SearchContent root
- prospect URL param wired in useSearch
- filterOverrides accepted by API route
- STATE.md and ROADMAP.md updated
</verification>

<success_criteria>
1. Build compiles clean (pnpm build passes)
2. All 12 design system compliance checks pass
3. STATE.md updated to Phase 8 complete
4. ROADMAP.md updated with Phase 8 completion status
5. Phase 8 is ready for visual verification on Vercel deployment
</success_criteria>

<output>
After completion, create `.planning/phases/08-lead-search/08-05-SUMMARY.md`
</output>
