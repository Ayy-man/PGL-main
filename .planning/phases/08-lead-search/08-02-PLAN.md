---
phase: 08-lead-search
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/[orgId]/search/components/nl-search-bar.tsx
  - src/app/[orgId]/search/components/advanced-filters-panel.tsx
autonomous: true
requirements: [SRCH-05, SRCH-06]

must_haves:
  truths:
    - "NL search bar renders with auto-resize textarea, search icon, gold search button"
    - "Advanced filters panel collapses/expands with filter inputs for titles, location, industry, seniority"
    - "Both components use CSS variables exclusively — no raw Tailwind color classes"
  artifacts:
    - path: "src/app/[orgId]/search/components/nl-search-bar.tsx"
      provides: "Natural language search textarea with search button"
      exports: ["NLSearchBar"]
    - path: "src/app/[orgId]/search/components/advanced-filters-panel.tsx"
      provides: "Collapsible advanced filter panel"
      exports: ["AdvancedFiltersPanel"]
  key_links:
    - from: "nl-search-bar.tsx"
      to: "parent (SearchContent)"
      via: "onSearch callback with keywords string"
      pattern: "onSearch.*string"
    - from: "advanced-filters-panel.tsx"
      to: "parent (SearchContent)"
      via: "onApplyFilters callback with PersonaFilters"
      pattern: "onApplyFilters.*PersonaFilters"
---

<objective>
Create the NL Search Bar and Advanced Filters Panel components for the search page.

Purpose: The NL bar is the primary search entry point (keyword passthrough to Apollo q_keywords). Advanced filters provide power-user override controls on top of the selected persona.
Output: Two standalone components ready to wire into SearchContent in Plan 04.
</objective>

<execution_context>
@/Users/aymanbaig/.claude/get-shit-done/workflows/execute-plan.md
@/Users/aymanbaig/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/phases/08-lead-search/08-RESEARCH.md
@design-system/MASTER.md
@design-system/pages/search.md

<interfaces>
<!-- Types the components will use -->

From src/lib/personas/types.ts:
```typescript
export interface PersonaFilters {
  titles?: string[];
  seniorities?: string[];
  industries?: string[];
  locations?: string[];
  companySize?: string[];
  keywords?: string;
}
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create NLSearchBar component with auto-resize textarea and gold search button</name>
  <files>src/app/[orgId]/search/components/nl-search-bar.tsx</files>
  <action>
  Create `src/app/[orgId]/search/components/nl-search-bar.tsx`:

  1. "use client" directive at top.

  2. Import: `useState`, `useRef`, `useCallback` from React; `Search`, `Mic` from lucide-react; `Button` from `@/components/ui/button`.

  3. Props interface:
     ```typescript
     interface NLSearchBarProps {
       initialValue?: string;
       onSearch: (keywords: string) => void;
       isLoading?: boolean;
     }
     ```

  4. Component implementation:
     - Local `useState<string>` for textarea value, initialized from `initialValue`.
     - `useRef<HTMLTextAreaElement>` for auto-resize.
     - Auto-resize effect: on value change, set `textarea.style.height = "auto"` then `textarea.style.height = textarea.scrollHeight + "px"`. Min height 56px, max height 120px.
     - On Enter key (without Shift), call `onSearch(value.trim())` and prevent default.
     - Search button click calls `onSearch(value.trim())`.

  5. Layout: Outer container with relative positioning, rounded-[12px] (card radius), overflow-hidden.
     ```
     style={{
       background: "var(--bg-input)",
       border: "1px solid var(--border-subtle)",
     }}
     ```
     Focus-within: use a state `isFocused` toggled by textarea onFocus/onBlur, when focused set border to `var(--border-hover)`.

  6. Left icon: `Search` icon at `h-5 w-5`, absolutely positioned left, color `var(--text-muted)`.
     ```
     className="absolute left-5 top-1/2 -translate-y-1/2 h-5 w-5 shrink-0 pointer-events-none"
     style={{ color: "var(--text-muted)" }}
     ```

  7. Textarea:
     ```
     className="w-full resize-none bg-transparent py-4 pl-14 pr-32 text-[16px] font-sans placeholder:italic outline-none"
     style={{ color: "var(--text-primary-ds)", minHeight: "56px", maxHeight: "120px" }}
     placeholder="Describe your ideal prospect... e.g., 'Tech founders in Miami over $5M looking for investment properties'"
     ```

  8. Right section: absolutely positioned right side with two buttons:
     - Mic button (placeholder, no functionality): ghost style, `h-9 w-9 rounded-full`, `Mic` icon `h-4 w-4`, disabled, opacity 0.3.
     - Search button: `Button variant="gold" size="sm"`, text "Search", disabled when `isLoading` or value is empty.

  IMPORTANT: Use native `<textarea>` not shadcn Textarea — finer control of auto-resize. Use CSS variables only, no raw Tailwind color classes.
  </action>
  <verify>
    <automated>cd /Users/aymanbaig/Desktop/Manual\ Library/Phronesis-main && test -f src/app/\[orgId\]/search/components/nl-search-bar.tsx && grep -c "NLSearchBar" src/app/\[orgId\]/search/components/nl-search-bar.tsx && grep -c "onSearch" src/app/\[orgId\]/search/components/nl-search-bar.tsx && grep -c "textarea" src/app/\[orgId\]/search/components/nl-search-bar.tsx</automated>
  </verify>
  <done>NLSearchBar renders auto-resize textarea with search icon left, mic placeholder right, gold search button, Enter key support, CSS variable styling</done>
</task>

<task type="auto">
  <name>Task 2: Create AdvancedFiltersPanel collapsible component with filter inputs</name>
  <files>src/app/[orgId]/search/components/advanced-filters-panel.tsx</files>
  <action>
  Create `src/app/[orgId]/search/components/advanced-filters-panel.tsx`:

  1. "use client" directive at top.

  2. Import: `useState` from React; `SlidersHorizontal`, `ChevronDown`, `X` from lucide-react; `Button` from `@/components/ui/button`; `PersonaFilters` type from `@/lib/personas/types`.

  3. Props interface:
     ```typescript
     interface AdvancedFiltersPanelProps {
       onApplyFilters: (filters: Partial<PersonaFilters>) => void;
       initialFilters?: Partial<PersonaFilters>;
     }
     ```

  4. State:
     - `isOpen: boolean` (default false) — controls panel expand/collapse
     - `titles: string` — comma-separated text input
     - `locations: string` — comma-separated text input
     - `industries: string` — comma-separated text input
     - `seniorities: string` — comma-separated text input
     Initialize from `initialFilters` if provided (join arrays with ", ").

  5. Toggle button (always visible):
     ```
     className="flex items-center gap-2 text-[13px] font-medium cursor-pointer transition-all duration-200"
     style={{ color: "var(--text-secondary-ds)" }}
     ```
     Content: `SlidersHorizontal` icon (h-4 w-4) + "Advanced Filters" + `ChevronDown` icon (rotates 180deg when open, use `transform: rotate(180deg)` via style).
     Hover: `color: "var(--text-primary-ds)"` via onMouseEnter/Leave.

  6. Collapsible panel (conditionally rendered when `isOpen`):
     Container:
     ```
     className="mt-3 rounded-[12px] p-5 grid grid-cols-1 sm:grid-cols-2 gap-4"
     style={{
       background: "var(--bg-elevated)",
       border: "1px solid var(--border-default)",
     }}
     ```

  7. Four filter inputs — each with a label and text input:
     - Label: `text-[11px] uppercase tracking-wider font-semibold mb-1.5` with color `var(--text-tertiary)`
     - Input: `rounded-[8px] px-3 py-2 text-[13px] w-full outline-none` with:
       ```
       style={{
         background: "var(--bg-input)",
         border: "1px solid var(--border-subtle)",
         color: "var(--text-primary-ds)",
       }}
       ```
       Focus: onFocus set borderColor to `var(--border-hover)`, onBlur reset to `var(--border-subtle)`.
     - Placeholder examples: "CEO, VP Finance, Director..." / "New York, Miami, SF..." / "Finance, Technology, Real Estate..." / "C-Suite, VP, Director..."

  8. Bottom row: two buttons aligned right:
     - "Clear" ghost button: resets all filter inputs to empty
     - "Apply Filters" gold button: parses comma-separated strings into arrays, calls `onApplyFilters` with non-empty fields:
       ```typescript
       const filters: Partial<PersonaFilters> = {};
       if (titles.trim()) filters.titles = titles.split(",").map(s => s.trim()).filter(Boolean);
       if (locations.trim()) filters.locations = locations.split(",").map(s => s.trim()).filter(Boolean);
       // ... same for industries, seniorities
       onApplyFilters(filters);
       ```

  IMPORTANT: Use CSS variable styling throughout. No raw Tailwind color classes. Use the onMouseEnter/Leave pattern for hover states on the toggle button.
  </action>
  <verify>
    <automated>cd /Users/aymanbaig/Desktop/Manual\ Library/Phronesis-main && test -f src/app/\[orgId\]/search/components/advanced-filters-panel.tsx && grep -c "AdvancedFiltersPanel" src/app/\[orgId\]/search/components/advanced-filters-panel.tsx && grep -c "SlidersHorizontal" src/app/\[orgId\]/search/components/advanced-filters-panel.tsx && grep -c "onApplyFilters" src/app/\[orgId\]/search/components/advanced-filters-panel.tsx</automated>
  </verify>
  <done>AdvancedFiltersPanel toggles open/closed, shows 4 filter inputs (titles, locations, industries, seniorities), Apply parses comma-separated values into PersonaFilters arrays, Clear resets all</done>
</task>

</tasks>

<verification>
- `test -f src/app/[orgId]/search/components/nl-search-bar.tsx` passes
- `test -f src/app/[orgId]/search/components/advanced-filters-panel.tsx` passes
- Both components export named functions matching their filenames
- No raw Tailwind color classes (no `zinc-*`, `gray-*`, `yellow-*`, `emerald-*`)
- Both use CSS variable hover pattern (onMouseEnter/Leave), not Tailwind hover: with CSS vars
</verification>

<success_criteria>
1. NLSearchBar accepts keywords input, renders with design-system styling, calls onSearch on Enter/button click
2. AdvancedFiltersPanel collapses/expands, contains 4 filter inputs, Apply parses into PersonaFilters structure
3. Both components are standalone and ready for wiring in Plan 04
4. No new npm packages needed
</success_criteria>

<output>
After completion, create `.planning/phases/08-lead-search/08-02-SUMMARY.md`
</output>
