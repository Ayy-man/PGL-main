---
phase: 02-persona-search-lists
plan: 07
type: execute
wave: 5
depends_on: ["02-05", "02-06"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Persona search returns Apollo results with correct filters"
    - "Search results are cached (second search <500ms)"
    - "Pagination works (50 results/page, URL state persists)"
    - "Rate limiting prevents quota exhaustion (429 after limit)"
    - "List management flow complete (create, add prospects, status, notes)"
    - "Cross-tenant isolation maintained"
    - "URL state persistence works (copy URL, open new tab)"
---

<objective>
End-to-end verification of all Phase 02 success criteria. Human verification of the complete persona-search-lists flow.

Purpose: Validate that all 7 success criteria from the roadmap are met before marking Phase 02 complete.

Output: Verification results — pass/fail for each criterion with notes on any issues.
</objective>

<execution_context>
@/Users/aymanbaig/.claude/get-shit-done/workflows/execute-plan.md
@/Users/aymanbaig/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-persona-search-lists/02-05-SUMMARY.md
@.planning/phases/02-persona-search-lists/02-06-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run automated verification checks</name>
  <files></files>
  <action>
Run the following automated checks before human verification:

1. **Build check**: `pnpm build` — must pass with zero errors
2. **Type check**: `pnpm tsc --noEmit` — must pass with zero errors
3. **Test check**: `pnpm test` — all tests must pass (Apollo client tests)
4. **File existence check**: Verify all plan artifacts exist:
   - `src/lib/cache/redis.ts`
   - `src/lib/cache/keys.ts`
   - `src/lib/rate-limit/limiters.ts`
   - `src/lib/rate-limit/middleware.ts`
   - `src/lib/circuit-breaker/apollo-breaker.ts`
   - `src/lib/apollo/types.ts`
   - `src/lib/apollo/schemas.ts`
   - `src/lib/apollo/client.ts`
   - `src/lib/personas/types.ts`
   - `src/lib/personas/queries.ts`
   - `src/lib/personas/seed-data.ts`
   - `src/lib/lists/types.ts`
   - `src/lib/lists/queries.ts`
   - `src/lib/prospects/types.ts`
   - `src/lib/prospects/queries.ts`
   - `src/app/api/search/apollo/route.ts`
   - `src/app/api/prospects/upsert/route.ts`
   - `src/app/(dashboard)/[orgId]/search/page.tsx`
   - `src/app/(dashboard)/[orgId]/personas/page.tsx`
   - `src/app/(dashboard)/[orgId]/lists/page.tsx`
   - `src/app/(dashboard)/[orgId]/lists/[listId]/page.tsx`
5. **Security check**: `grep -r "service_role" src/app/` — should return zero matches in client code
6. **Tenant isolation check**: `grep -rn "params.orgId" src/app/ --include="actions.ts" --include="route.ts"` — verify no server actions or routes use URL params as tenant_id
7. **Cache key check**: `grep -rn "buildCacheKey" src/lib/` — verify all cache operations use buildCacheKey helper

Report results in summary.
  </action>
  <verify>
All automated checks pass. Report any failures.
  </verify>
  <done>
Automated verification complete. Build, types, tests, file existence, security, and tenant isolation checks all pass.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Phase 02: Persona Builder, Apollo.io Search, List Management, with rate limiting, caching, circuit breaking, and URL state persistence.
  </what-built>
  <how-to-verify>
Start the dev server (`pnpm dev`) and verify each success criterion:

**Criterion 1: Persona Search Works End-to-End**
1. Navigate to `/{orgId}/personas`
2. Verify 5 starter personas are listed
3. Click "Search" on Finance Elite persona
4. Verify results appear in table

**Criterion 2: Search Results are Cached**
1. Search for Finance Elite persona
2. Navigate away, then search same persona again
3. Verify second load is notably faster

**Criterion 3: Pagination Functions Correctly**
1. Search for a persona with many results
2. Verify page shows 50 results
3. Click Next page — verify URL changes

**Criterion 4: List Management Flow**
1. Navigate to `/{orgId}/lists`
2. Create a list
3. Search and add prospects to it
4. Verify members appear in list detail

**Criterion 5: Cross-Tenant Isolation**
1. If two test tenants exist, verify data isolation
  </how-to-verify>
  <resume-signal>Type "approved" if all criteria pass, or describe any issues found.</resume-signal>
</task>

</tasks>

<verification>
All 7 roadmap success criteria verified:
1. Persona search returns results with correct filters
2. Cached results load faster
3. Pagination works with URL state persistence
4. Rate limiting active
5. List management: create, add prospects, status tracking, notes
6. Cross-tenant isolation maintained
7. URL state shareable/bookmarkable
</verification>

<success_criteria>
Human approves all success criteria pass. Any blocking issues identified are logged for gap closure.
</success_criteria>

<output>
After completion, create `.planning/phases/02-persona-search-lists/02-07-SUMMARY.md`
</output>
