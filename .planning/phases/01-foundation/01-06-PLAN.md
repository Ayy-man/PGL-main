---
phase: 01-foundation
plan: 06
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/app/layout.tsx
  - src/app/[orgId]/layout.tsx
  - src/app/[orgId]/page.tsx
  - src/app/[orgId]/loading.tsx
  - src/app/[orgId]/error.tsx
  - src/app/global-error.tsx
  - src/components/layout/sidebar.tsx
  - src/components/layout/nav-items.tsx
  - src/components/layout/tenant-logo.tsx
  - src/components/ui/skeleton.tsx
autonomous: true

must_haves:
  truths:
    - "Dark theme applies on page load with no flash of light theme"
    - "Sidebar navigation shows tenant logo and nav items (Search, Lists, Personas, Activity, Analytics)"
    - "Playfair Display used for headings, Inter for body text"
    - "Gold accent colors visible on primary interactive elements"
    - "Loading skeleton appears while tenant data loads"
    - "Error boundary catches and displays user-friendly errors"
    - "Layout is responsive (sidebar collapses on mobile)"
  artifacts:
    - path: "src/app/layout.tsx"
      provides: "Root layout with dark theme class, fonts, metadata"
      contains: "dark"
    - path: "src/app/[orgId]/layout.tsx"
      provides: "Tenant layout with sidebar and tenant branding"
      contains: "sidebar"
    - path: "src/components/layout/sidebar.tsx"
      provides: "Sidebar navigation component"
      contains: "nav"
    - path: "src/components/ui/skeleton.tsx"
      provides: "Skeleton loading component"
      exports: ["Skeleton"]
    - path: "src/app/global-error.tsx"
      provides: "Root-level error boundary"
      contains: "use client"
  key_links:
    - from: "src/app/layout.tsx"
      to: "globals.css"
      via: "dark class on html element activates .dark CSS variables"
      pattern: "className.*dark"
    - from: "src/app/[orgId]/layout.tsx"
      to: "src/components/layout/sidebar.tsx"
      via: "Sidebar rendered inside tenant layout"
      pattern: "Sidebar"
    - from: "src/components/layout/sidebar.tsx"
      to: "src/components/layout/nav-items.tsx"
      via: "Navigation items rendered in sidebar"
      pattern: "NavItems"
---

<objective>
Build the UI shell with dark theme, sidebar navigation, tenant branding, typography, loading states, and error boundaries.

Purpose: The UI shell is the visual foundation. Every tenant-scoped page renders inside this shell. It establishes the dark luxury aesthetic, responsive layout, and consistent navigation that users interact with on every page.

Output: Root layout with dark theme, tenant layout with sidebar navigation, loading skeletons, error boundaries, and responsive design.
</objective>

<execution_context>
@/Users/aymanbaig/.claude/get-shit-done/workflows/execute-plan.md
@/Users/aymanbaig/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create root layout, global error, and skeleton component</name>
  <files>
    src/app/layout.tsx
    src/app/global-error.tsx
    src/components/ui/skeleton.tsx
  </files>
  <action>
    1. **Update src/app/layout.tsx** — Root layout with dark theme and fonts:

       Replace the existing layout entirely. Key changes:
       - Add `className="dark"` to `<html>` element (forces dark theme, no flash)
       - Load Inter and Playfair Display via next/font/google
       - Remove Geist fonts (not part of design spec)
       - Set app metadata (title, description)
       - Apply font CSS variables for theme integration

       ```typescript
       import type { Metadata } from "next";
       import { Inter, Playfair_Display } from "next/font/google";
       import "./globals.css";

       const inter = Inter({
         subsets: ["latin"],
         variable: "--font-sans",
         display: "swap",
       });

       const playfair = Playfair_Display({
         subsets: ["latin"],
         variable: "--font-serif",
         display: "swap",
       });

       export const metadata: Metadata = {
         title: "PGL Luxury Buyer Finder",
         description: "Wealth intelligence platform for UHNWI real estate prospecting",
       };

       export default function RootLayout({
         children,
       }: Readonly<{
         children: React.ReactNode;
       }>) {
         return (
           <html lang="en" className="dark" suppressHydrationWarning>
             <body
               className={`${inter.variable} ${playfair.variable} font-sans antialiased bg-background text-foreground`}
             >
               {children}
             </body>
           </html>
         );
       }
       ```

       - `suppressHydrationWarning` prevents React hydration warning from the `dark` class
       - `font-sans` applies Inter as default body font
       - Playfair Display available via `font-serif` class for headings
       - bg-background and text-foreground use the dark theme oklch values

    2. **Create src/app/global-error.tsx** — Root error boundary:

       ```typescript
       "use client";

       export default function GlobalError({
         error,
         reset,
       }: {
         error: Error & { digest?: string };
         reset: () => void;
       }) {
         return (
           <html lang="en" className="dark">
             <body className="bg-background text-foreground">
               <div className="flex min-h-screen flex-col items-center justify-center gap-6 px-4">
                 <div className="space-y-2 text-center">
                   <h2 className="font-serif text-3xl font-bold">
                     Something went wrong
                   </h2>
                   <p className="text-muted-foreground">
                     An unexpected error occurred. Please try again.
                   </p>
                   {error.digest && (
                     <p className="text-xs text-muted-foreground">
                       Error ID: {error.digest}
                     </p>
                   )}
                 </div>
                 <button
                   onClick={reset}
                   className="inline-flex h-10 items-center justify-center rounded-md bg-primary px-6 text-sm font-medium text-primary-foreground transition-colors hover:bg-primary/90"
                 >
                   Try Again
                 </button>
               </div>
             </body>
           </html>
         );
       }
       ```

       - Must include `<html>` and `<body>` (replaces root layout on error)
       - Must be a Client Component (`"use client"`)
       - Shows error digest for debugging

    3. **Create src/components/ui/skeleton.tsx** — Skeleton loading component:

       ```typescript
       import { cn } from "@/lib/utils";

       function Skeleton({
         className,
         ...props
       }: React.HTMLAttributes<HTMLDivElement>) {
         return (
           <div
             className={cn("animate-pulse rounded-md bg-muted", className)}
             {...props}
           />
         );
       }

       export { Skeleton };
       ```

       This matches the shadcn/ui Skeleton component pattern.
  </action>
  <verify>
    Run `npx tsc --noEmit` — no TypeScript errors.
    Verify src/app/layout.tsx has `className="dark"` on html element.
    Verify Inter and Playfair_Display are loaded from next/font/google.
    Verify global-error.tsx is a Client Component.
    Verify Skeleton component uses cn() utility.
  </verify>
  <done>
    Root layout applies dark theme with Inter (body) and Playfair Display (headings) fonts. Global error boundary provides fallback UI for root-level errors. Skeleton component available for loading states.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create tenant layout with sidebar navigation and error/loading states</name>
  <files>
    src/app/[orgId]/layout.tsx
    src/app/[orgId]/page.tsx
    src/app/[orgId]/loading.tsx
    src/app/[orgId]/error.tsx
    src/components/layout/sidebar.tsx
    src/components/layout/nav-items.tsx
    src/components/layout/tenant-logo.tsx
  </files>
  <action>
    1. **Create src/components/layout/tenant-logo.tsx** — Tenant logo with fallback:

       ```typescript
       interface TenantLogoProps {
         logoUrl: string | null;
         tenantName: string;
         className?: string;
       }

       export function TenantLogo({ logoUrl, tenantName, className }: TenantLogoProps) {
         if (logoUrl) {
           return (
             <img
               src={logoUrl}
               alt={`${tenantName} logo`}
               className={className || "h-8 w-auto"}
             />
           );
         }

         // Fallback: first letter of tenant name in a gold circle
         return (
           <div
             className={`flex h-8 w-8 items-center justify-center rounded-full bg-primary text-primary-foreground font-serif font-bold text-sm ${className || ""}`}
           >
             {tenantName.charAt(0).toUpperCase()}
           </div>
         );
       }
       ```

    2. **Create src/components/layout/nav-items.tsx** — Navigation items:

       ```typescript
       "use client";

       import { usePathname } from "next/navigation";
       import Link from "next/link";
       import {
         Search,
         List,
         Users,
         Activity,
         BarChart3,
       } from "lucide-react";

       interface NavItemsProps {
         orgId: string;
       }

       const NAV_ITEMS = [
         { label: "Search", href: "/search", icon: Search },
         { label: "Lists", href: "/lists", icon: List },
         { label: "Personas", href: "/personas", icon: Users },
         { label: "Activity", href: "/activity", icon: Activity },
         { label: "Analytics", href: "/analytics", icon: BarChart3 },
       ];

       export function NavItems({ orgId }: NavItemsProps) {
         const pathname = usePathname();

         return (
           <nav className="flex flex-col gap-1 px-3">
             {NAV_ITEMS.map((item) => {
               const fullHref = `/${orgId}${item.href}`;
               const isActive = pathname === fullHref || pathname.startsWith(`${fullHref}/`);

               return (
                 <Link
                   key={item.href}
                   href={fullHref}
                   className={`flex items-center gap-3 rounded-md px-3 py-2 text-sm font-medium transition-colors ${
                     isActive
                       ? "bg-accent text-accent-foreground"
                       : "text-muted-foreground hover:bg-accent/50 hover:text-foreground"
                   }`}
                 >
                   <item.icon className="h-4 w-4" />
                   {item.label}
                 </Link>
               );
             })}
           </nav>
         );
       }
       ```

    3. **Create src/components/layout/sidebar.tsx** — Sidebar component:

       ```typescript
       import { TenantLogo } from "./tenant-logo";
       import { NavItems } from "./nav-items";

       interface SidebarProps {
         orgId: string;
         tenantName: string;
         logoUrl: string | null;
       }

       export function Sidebar({ orgId, tenantName, logoUrl }: SidebarProps) {
         return (
           <aside className="flex h-screen w-64 flex-col border-r border-border bg-card">
             {/* Tenant branding */}
             <div className="flex items-center gap-3 border-b border-border px-4 py-4">
               <TenantLogo logoUrl={logoUrl} tenantName={tenantName} />
               <div className="flex flex-col">
                 <span className="font-serif text-sm font-semibold">
                   {tenantName}
                 </span>
               </div>
             </div>

             {/* Navigation */}
             <div className="flex-1 overflow-y-auto py-4">
               <NavItems orgId={orgId} />
             </div>

             {/* Footer (user menu placeholder) */}
             <div className="border-t border-border p-4">
               <div className="text-xs text-muted-foreground">
                 PGL Luxury Buyer Finder
               </div>
             </div>
           </aside>
         );
       }
       ```

    4. **Create src/app/[orgId]/layout.tsx** — Tenant layout:

       ```typescript
       import { createClient } from "@/lib/supabase/server";
       import { notFound, redirect } from "next/navigation";
       import { Sidebar } from "@/components/layout/sidebar";

       export default async function TenantLayout({
         children,
         params,
       }: {
         children: React.ReactNode;
         params: { orgId: string };
       }) {
         const supabase = await createClient();

         // Verify user is authenticated
         const { data: { user } } = await supabase.auth.getUser();
         if (!user) {
           redirect("/login");
         }

         // Fetch tenant data (RLS ensures user can only access their tenant)
         const { data: tenant, error } = await supabase
           .from("tenants")
           .select("id, name, slug, logo_url, primary_color, secondary_color, is_active")
           .eq("slug", params.orgId)
           .single();

         if (error || !tenant || !tenant.is_active) {
           notFound();
         }

         return (
           <div className="flex min-h-screen">
             {/* Sidebar */}
             <Sidebar
               orgId={params.orgId}
               tenantName={tenant.name}
               logoUrl={tenant.logo_url}
             />

             {/* Main content area */}
             <main className="flex-1 overflow-y-auto">
               <div className="p-6 lg:p-8">
                 {children}
               </div>
             </main>

             {/* Dynamic tenant branding via CSS custom properties */}
             <style>{`
               :root {
                 --tenant-primary: ${tenant.primary_color};
                 --tenant-secondary: ${tenant.secondary_color};
               }
             `}</style>
           </div>
         );
       }
       ```

       Note: The tenant layout looks up by `slug` (not UUID) since the URL uses slug-based paths like `/the-w-team/search`.

    5. **Create src/app/[orgId]/page.tsx** — Tenant dashboard (placeholder):

       ```typescript
       export default function TenantDashboard({
         params,
       }: {
         params: { orgId: string };
       }) {
         return (
           <div className="space-y-6">
             <div>
               <h1 className="font-serif text-3xl font-bold tracking-tight">
                 Dashboard
               </h1>
               <p className="text-muted-foreground mt-1">
                 Welcome to your workspace
               </p>
             </div>

             {/* Placeholder cards */}
             <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-4">
               {["Total Prospects", "Active Lists", "Searches Today", "Team Members"].map((title) => (
                 <div key={title} className="rounded-lg border border-border bg-card p-6">
                   <p className="text-sm text-muted-foreground">{title}</p>
                   <p className="mt-2 text-2xl font-bold">--</p>
                 </div>
               ))}
             </div>
           </div>
         );
       }
       ```

    6. **Create src/app/[orgId]/loading.tsx** — Route loading state:

       ```typescript
       import { Skeleton } from "@/components/ui/skeleton";

       export default function Loading() {
         return (
           <div className="space-y-6">
             <div className="space-y-2">
               <Skeleton className="h-9 w-[200px]" />
               <Skeleton className="h-5 w-[300px]" />
             </div>
             <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-4">
               {Array.from({ length: 4 }).map((_, i) => (
                 <Skeleton key={i} className="h-[100px] rounded-lg" />
               ))}
             </div>
           </div>
         );
       }
       ```

    7. **Create src/app/[orgId]/error.tsx** — Tenant route error boundary:

       ```typescript
       "use client";

       import { useEffect } from "react";

       export default function Error({
         error,
         reset,
       }: {
         error: Error & { digest?: string };
         reset: () => void;
       }) {
         useEffect(() => {
           console.error("Tenant route error:", error);
         }, [error]);

         return (
           <div className="flex min-h-[400px] flex-col items-center justify-center gap-4">
             <div className="space-y-2 text-center">
               <h2 className="font-serif text-2xl font-semibold">
                 Something went wrong
               </h2>
               <p className="text-muted-foreground max-w-md">
                 {error.message || "An unexpected error occurred. Please try again."}
               </p>
             </div>
             <button
               onClick={reset}
               className="inline-flex h-10 items-center justify-center rounded-md bg-primary px-6 text-sm font-medium text-primary-foreground transition-colors hover:bg-primary/90"
             >
               Try Again
             </button>
           </div>
         );
       }
       ```

    IMPORTANT:
    - Dark theme is forced via `className="dark"` on html element (not via media query)
    - Use `font-serif` class for headings (maps to Playfair Display)
    - Use default font-sans for body text (maps to Inter)
    - Sidebar is fixed-width (w-64 = 256px), main content fills remaining space
    - Error boundaries must be Client Components
    - Tenant layout fetches tenant by SLUG (URL path segment), not UUID
    - DO NOT use shadcn Button/Input yet — use plain elements with matching styles
  </action>
  <verify>
    Run `npx tsc --noEmit` — no TypeScript errors.
    Verify src/app/layout.tsx has "dark" class on html element.
    Verify Inter and Playfair_Display fonts are loaded.
    Verify sidebar has 5 nav items: Search, Lists, Personas, Activity, Analytics.
    Verify error.tsx files have "use client" directive.
    Verify loading.tsx uses Skeleton component.
    Verify tenant layout fetches by slug.
  </verify>
  <done>
    UI shell complete with dark theme, Inter/Playfair Display typography, sidebar navigation with 5 nav items and tenant logo, responsive layout, loading skeletons, and error boundaries. Tenant branding (colors) injected via CSS custom properties from database.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. Dark theme renders on load (no flash of light)
3. Sidebar shows 5 nav items with lucide icons
4. Playfair Display on headings, Inter on body
5. Loading skeleton renders during async data fetch
6. Error boundary catches errors with user-friendly message
7. Tenant logo renders (or fallback initial)
8. Responsive: sidebar visible on desktop
</verification>

<success_criteria>
- Dark theme (#121212-area background from oklch vars) applies immediately on page load
- Gold accent colors visible on primary buttons and active nav items
- Playfair Display renders on all heading elements with font-serif class
- Inter renders on body text with font-sans class
- Sidebar shows tenant logo/name + Search, Lists, Personas, Activity, Analytics nav items
- Loading state shows skeleton placeholder during data fetch
- Error boundary shows "Something went wrong" with retry button
- WCAG AA contrast: gold text on dark background (oklch theme values provide this)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-06-SUMMARY.md`
</output>
