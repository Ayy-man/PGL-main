---
phase: 01-foundation
plan: 07
type: execute
wave: 3
depends_on: ["01-04", "01-05", "01-06"]
files_modified:
  - src/app/admin/layout.tsx
  - src/app/admin/page.tsx
  - src/app/admin/tenants/page.tsx
  - src/app/admin/tenants/new/page.tsx
  - src/app/admin/users/page.tsx
  - src/app/admin/users/new/page.tsx
  - src/app/admin/loading.tsx
  - src/app/admin/error.tsx
  - src/app/actions/admin.ts
autonomous: true

must_haves:
  truths:
    - "Super admin panel renders at /admin with its own layout (no tenant sidebar)"
    - "Super admin can see a list of all tenants with status"
    - "Super admin can create a new tenant with name, slug, and branding colors"
    - "Super admin can create/invite users to any tenant with assigned role"
    - "Super admin can deactivate tenants and users"
    - "Non-super-admin users cannot access /admin routes"
  artifacts:
    - path: "src/app/admin/layout.tsx"
      provides: "Admin-only layout with super admin navigation"
      contains: "requireSuperAdmin"
    - path: "src/app/admin/tenants/page.tsx"
      provides: "Tenant list page"
      contains: "tenants"
    - path: "src/app/admin/tenants/new/page.tsx"
      provides: "Create tenant form"
      contains: "createTenant"
    - path: "src/app/admin/users/page.tsx"
      provides: "User management page"
      contains: "users"
    - path: "src/app/admin/users/new/page.tsx"
      provides: "Invite user form"
      contains: "inviteUser"
    - path: "src/app/actions/admin.ts"
      provides: "Server Actions for admin operations"
      exports: ["createTenant", "inviteUser", "toggleTenantStatus", "toggleUserStatus"]
  key_links:
    - from: "src/app/admin/layout.tsx"
      to: "src/lib/auth/rbac.ts"
      via: "requireSuperAdmin() guards admin routes"
      pattern: "requireSuperAdmin"
    - from: "src/app/actions/admin.ts"
      to: "src/lib/supabase/admin.ts"
      via: "Service role client for user creation"
      pattern: "createAdminClient"
    - from: "src/app/actions/admin.ts"
      to: "supabase.auth.admin"
      via: "Admin auth API for user provisioning"
      pattern: "auth\\.admin"
---

<objective>
Build the PGL super admin panel with tenant management (CRUD + deactivate), user management (create/invite + deactivate), and admin-only layout.

Purpose: The super admin panel is how PGL manages tenants and users. Adrian (PGL owner) uses this to onboard new real estate teams, assign roles, and manage the platform. This is isolated from tenant-scoped UI.

Output: Complete admin panel at /admin with tenant CRUD, user invitation, and status management.
</objective>

<execution_context>
@/Users/aymanbaig/.claude/get-shit-done/workflows/execute-plan.md
@/Users/aymanbaig/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-04-SUMMARY.md
@.planning/phases/01-foundation/01-06-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create admin layout and Server Actions for tenant/user management</name>
  <files>
    src/app/admin/layout.tsx
    src/app/admin/loading.tsx
    src/app/admin/error.tsx
    src/app/actions/admin.ts
  </files>
  <action>
    1. **Create src/app/admin/layout.tsx** — Admin-only layout:

       ```typescript
       import { requireSuperAdmin } from "@/lib/auth/rbac";
       import Link from "next/link";
       import { Building2, Users, LayoutDashboard } from "lucide-react";

       const ADMIN_NAV = [
         { label: "Dashboard", href: "/admin", icon: LayoutDashboard },
         { label: "Tenants", href: "/admin/tenants", icon: Building2 },
         { label: "Users", href: "/admin/users", icon: Users },
       ];

       export default async function AdminLayout({
         children,
       }: {
         children: React.ReactNode;
       }) {
         // Guard: Only super_admin can access /admin routes
         const user = await requireSuperAdmin();

         return (
           <div className="flex min-h-screen">
             {/* Admin sidebar */}
             <aside className="flex h-screen w-64 flex-col border-r border-border bg-card">
               <div className="border-b border-border px-4 py-4">
                 <span className="font-serif text-lg font-bold text-primary">
                   PGL Admin
                 </span>
                 <p className="text-xs text-muted-foreground mt-1">
                   Super Admin Panel
                 </p>
               </div>

               <nav className="flex-1 overflow-y-auto py-4 px-3">
                 <div className="flex flex-col gap-1">
                   {ADMIN_NAV.map((item) => (
                     <Link
                       key={item.href}
                       href={item.href}
                       className="flex items-center gap-3 rounded-md px-3 py-2 text-sm font-medium text-muted-foreground transition-colors hover:bg-accent/50 hover:text-foreground"
                     >
                       <item.icon className="h-4 w-4" />
                       {item.label}
                     </Link>
                   ))}
                 </div>
               </nav>

               <div className="border-t border-border p-4">
                 <p className="text-xs text-muted-foreground truncate">
                   {user.email}
                 </p>
               </div>
             </aside>

             {/* Main content */}
             <main className="flex-1 overflow-y-auto">
               <div className="p-6 lg:p-8">
                 {children}
               </div>
             </main>
           </div>
         );
       }
       ```

    2. **Create src/app/admin/loading.tsx** — Admin loading state:

       ```typescript
       import { Skeleton } from "@/components/ui/skeleton";

       export default function AdminLoading() {
         return (
           <div className="space-y-6">
             <Skeleton className="h-9 w-[200px]" />
             <div className="space-y-3">
               {Array.from({ length: 5 }).map((_, i) => (
                 <Skeleton key={i} className="h-16 w-full rounded-lg" />
               ))}
             </div>
           </div>
         );
       }
       ```

    3. **Create src/app/admin/error.tsx** — Admin error boundary:

       ```typescript
       "use client";

       import { useEffect } from "react";

       export default function AdminError({
         error,
         reset,
       }: {
         error: Error & { digest?: string };
         reset: () => void;
       }) {
         useEffect(() => {
           console.error("Admin error:", error);
         }, [error]);

         return (
           <div className="flex min-h-[400px] flex-col items-center justify-center gap-4">
             <h2 className="font-serif text-2xl font-semibold">Admin Error</h2>
             <p className="text-muted-foreground">{error.message}</p>
             <button
               onClick={reset}
               className="inline-flex h-10 items-center justify-center rounded-md bg-primary px-6 text-sm font-medium text-primary-foreground hover:bg-primary/90"
             >
               Try Again
             </button>
           </div>
         );
       }
       ```

    4. **Create src/app/actions/admin.ts** — Server Actions for admin CRUD:

       ```typescript
       "use server";

       import { createAdminClient } from "@/lib/supabase/admin";
       import { createClient } from "@/lib/supabase/server";
       import { requireSuperAdmin } from "@/lib/auth/rbac";
       import { createTenantSchema, inviteUserSchema } from "@/lib/validations/schemas";
       import { revalidatePath } from "next/cache";

       /**
        * Create a new tenant. Super admin only.
        */
       export async function createTenant(formData: FormData) {
         await requireSuperAdmin();

         const validated = createTenantSchema.parse({
           name: formData.get("name"),
           slug: formData.get("slug"),
           logo_url: formData.get("logo_url") || null,
           primary_color: formData.get("primary_color") || "#d4af37",
           secondary_color: formData.get("secondary_color") || "#f4d47f",
         });

         const supabase = createAdminClient();

         const { data, error } = await supabase
           .from("tenants")
           .insert(validated)
           .select()
           .single();

         if (error) {
           if (error.code === "23505") {
             throw new Error("A tenant with this slug already exists");
           }
           throw new Error(`Failed to create tenant: ${error.message}`);
         }

         revalidatePath("/admin/tenants");
         return data;
       }

       /**
        * Invite/create a user for a tenant. Super admin only.
        * Uses Supabase Admin API to create user in auth.users
        * and then creates the public.users row.
        */
       export async function inviteUser(formData: FormData) {
         await requireSuperAdmin();

         const validated = inviteUserSchema.parse({
           email: formData.get("email"),
           full_name: formData.get("full_name"),
           role: formData.get("role"),
           tenant_id: formData.get("tenant_id"),
         });

         const supabase = createAdminClient();

         // 1. Create user in Supabase Auth with temporary password
         const tempPassword = `Temp${Date.now()}!`; // User will need to reset
         const { data: authData, error: authError } = await supabase.auth.admin.createUser({
           email: validated.email,
           password: tempPassword,
           email_confirm: true, // Auto-confirm email
           app_metadata: {
             role: validated.role,
             tenant_id: validated.tenant_id,
           },
           user_metadata: {
             full_name: validated.full_name,
           },
         });

         if (authError) {
           if (authError.message.includes("already been registered")) {
             throw new Error("A user with this email already exists");
           }
           throw new Error(`Failed to create user: ${authError.message}`);
         }

         // 2. Create public.users row
         const { error: profileError } = await supabase
           .from("users")
           .insert({
             id: authData.user.id,
             email: validated.email,
             full_name: validated.full_name,
             role: validated.role,
             tenant_id: validated.tenant_id,
             is_active: true,
           });

         if (profileError) {
           // Rollback: delete auth user if profile creation fails
           await supabase.auth.admin.deleteUser(authData.user.id);
           throw new Error(`Failed to create user profile: ${profileError.message}`);
         }

         revalidatePath("/admin/users");
         return { id: authData.user.id, email: validated.email, tempPassword };
       }

       /**
        * Toggle tenant active status. Super admin only.
        */
       export async function toggleTenantStatus(tenantId: string) {
         await requireSuperAdmin();

         const supabase = createAdminClient();

         // Get current status
         const { data: tenant, error: fetchError } = await supabase
           .from("tenants")
           .select("is_active")
           .eq("id", tenantId)
           .single();

         if (fetchError || !tenant) {
           throw new Error("Tenant not found");
         }

         // Toggle
         const { error: updateError } = await supabase
           .from("tenants")
           .update({ is_active: !tenant.is_active })
           .eq("id", tenantId);

         if (updateError) {
           throw new Error(`Failed to update tenant: ${updateError.message}`);
         }

         revalidatePath("/admin/tenants");
       }

       /**
        * Toggle user active status. Super admin only.
        */
       export async function toggleUserStatus(userId: string) {
         await requireSuperAdmin();

         const supabase = createAdminClient();

         // Get current status
         const { data: user, error: fetchError } = await supabase
           .from("users")
           .select("is_active")
           .eq("id", userId)
           .single();

         if (fetchError || !user) {
           throw new Error("User not found");
         }

         // Toggle
         const { error: updateError } = await supabase
           .from("users")
           .update({ is_active: !user.is_active })
           .eq("id", userId);

         if (updateError) {
           throw new Error(`Failed to update user: ${updateError.message}`);
         }

         revalidatePath("/admin/users");
       }
       ```

    IMPORTANT:
    - ALL admin actions use `createAdminClient()` (service role) because admin operations bypass RLS
    - ALL admin actions call `requireSuperAdmin()` at the start for authorization
    - User creation uses `supabase.auth.admin.createUser()` — sets app_metadata (role, tenant_id) immutably
    - Profile creation has rollback: if public.users insert fails, auth.users entry is deleted
    - Temp password is generated for new users — in production, implement password reset flow
  </action>
  <verify>
    Run `npx tsc --noEmit` — no TypeScript errors.
    Verify admin layout calls requireSuperAdmin().
    Verify server actions use "use server" directive.
    Verify server actions use createAdminClient() (service role).
    Verify inviteUser sets app_metadata with role and tenant_id.
    Grep for "getSession" in src/app/actions/ — should return 0 matches.
  </verify>
  <done>
    Admin layout with super admin guard, loading/error states, and 4 Server Actions (createTenant, inviteUser, toggleTenantStatus, toggleUserStatus) created. All actions use service role client and require super admin authorization.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create admin pages (dashboard, tenants, users)</name>
  <files>
    src/app/admin/page.tsx
    src/app/admin/tenants/page.tsx
    src/app/admin/tenants/new/page.tsx
    src/app/admin/users/page.tsx
    src/app/admin/users/new/page.tsx
  </files>
  <action>
    1. **Create src/app/admin/page.tsx** — Admin dashboard:

       ```typescript
       import { createAdminClient } from "@/lib/supabase/admin";

       export default async function AdminDashboard() {
         const supabase = createAdminClient();

         // Fetch summary counts
         const [tenantsResult, usersResult] = await Promise.all([
           supabase.from("tenants").select("id, is_active", { count: "exact" }),
           supabase.from("users").select("id, is_active", { count: "exact" }),
         ]);

         const totalTenants = tenantsResult.count || 0;
         const activeTenants = tenantsResult.data?.filter(t => t.is_active).length || 0;
         const totalUsers = usersResult.count || 0;
         const activeUsers = usersResult.data?.filter(u => u.is_active).length || 0;

         return (
           <div className="space-y-6">
             <div>
               <h1 className="font-serif text-3xl font-bold tracking-tight">
                 Admin Dashboard
               </h1>
               <p className="text-muted-foreground mt-1">
                 Manage tenants and users across the platform
               </p>
             </div>

             <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-4">
               <div className="rounded-lg border border-border bg-card p-6">
                 <p className="text-sm text-muted-foreground">Total Tenants</p>
                 <p className="mt-2 text-3xl font-bold">{totalTenants}</p>
               </div>
               <div className="rounded-lg border border-border bg-card p-6">
                 <p className="text-sm text-muted-foreground">Active Tenants</p>
                 <p className="mt-2 text-3xl font-bold text-primary">{activeTenants}</p>
               </div>
               <div className="rounded-lg border border-border bg-card p-6">
                 <p className="text-sm text-muted-foreground">Total Users</p>
                 <p className="mt-2 text-3xl font-bold">{totalUsers}</p>
               </div>
               <div className="rounded-lg border border-border bg-card p-6">
                 <p className="text-sm text-muted-foreground">Active Users</p>
                 <p className="mt-2 text-3xl font-bold text-primary">{activeUsers}</p>
               </div>
             </div>
           </div>
         );
       }
       ```

    2. **Create src/app/admin/tenants/page.tsx** — Tenant list:

       ```typescript
       import { createAdminClient } from "@/lib/supabase/admin";
       import Link from "next/link";
       import { TenantStatusToggle } from "./tenant-status-toggle";

       export default async function TenantsPage() {
         const supabase = createAdminClient();

         const { data: tenants, error } = await supabase
           .from("tenants")
           .select("*")
           .order("created_at", { ascending: false });

         if (error) throw new Error(`Failed to load tenants: ${error.message}`);

         return (
           <div className="space-y-6">
             <div className="flex items-center justify-between">
               <div>
                 <h1 className="font-serif text-3xl font-bold tracking-tight">
                   Tenants
                 </h1>
                 <p className="text-muted-foreground mt-1">
                   Manage all tenant organizations
                 </p>
               </div>
               <Link
                 href="/admin/tenants/new"
                 className="inline-flex h-10 items-center justify-center rounded-md bg-primary px-4 text-sm font-medium text-primary-foreground hover:bg-primary/90"
               >
                 Create Tenant
               </Link>
             </div>

             <div className="rounded-lg border border-border">
               <table className="w-full">
                 <thead>
                   <tr className="border-b border-border">
                     <th className="px-4 py-3 text-left text-sm font-medium text-muted-foreground">Name</th>
                     <th className="px-4 py-3 text-left text-sm font-medium text-muted-foreground">Slug</th>
                     <th className="px-4 py-3 text-left text-sm font-medium text-muted-foreground">Status</th>
                     <th className="px-4 py-3 text-left text-sm font-medium text-muted-foreground">Created</th>
                     <th className="px-4 py-3 text-left text-sm font-medium text-muted-foreground">Actions</th>
                   </tr>
                 </thead>
                 <tbody>
                   {tenants?.map((tenant) => (
                     <tr key={tenant.id} className="border-b border-border last:border-0">
                       <td className="px-4 py-3 text-sm font-medium">{tenant.name}</td>
                       <td className="px-4 py-3 text-sm text-muted-foreground">{tenant.slug}</td>
                       <td className="px-4 py-3 text-sm">
                         <span className={`inline-flex items-center rounded-full px-2 py-1 text-xs font-medium ${
                           tenant.is_active
                             ? "bg-green-500/10 text-green-400"
                             : "bg-red-500/10 text-red-400"
                         }`}>
                           {tenant.is_active ? "Active" : "Inactive"}
                         </span>
                       </td>
                       <td className="px-4 py-3 text-sm text-muted-foreground">
                         {new Date(tenant.created_at).toLocaleDateString()}
                       </td>
                       <td className="px-4 py-3 text-sm">
                         <TenantStatusToggle tenantId={tenant.id} isActive={tenant.is_active} />
                       </td>
                     </tr>
                   ))}
                   {(!tenants || tenants.length === 0) && (
                     <tr>
                       <td colSpan={5} className="px-4 py-8 text-center text-sm text-muted-foreground">
                         No tenants yet. Create your first tenant to get started.
                       </td>
                     </tr>
                   )}
                 </tbody>
               </table>
             </div>
           </div>
         );
       }
       ```

       Also create `src/app/admin/tenants/tenant-status-toggle.tsx`:
       ```typescript
       "use client";

       import { toggleTenantStatus } from "@/app/actions/admin";
       import { useState } from "react";

       export function TenantStatusToggle({
         tenantId,
         isActive,
       }: {
         tenantId: string;
         isActive: boolean;
       }) {
         const [loading, setLoading] = useState(false);

         async function handleToggle() {
           setLoading(true);
           try {
             await toggleTenantStatus(tenantId);
           } catch (error) {
             console.error("Failed to toggle tenant status:", error);
           } finally {
             setLoading(false);
           }
         }

         return (
           <button
             onClick={handleToggle}
             disabled={loading}
             className="text-sm text-muted-foreground hover:text-foreground disabled:opacity-50"
           >
             {loading ? "..." : isActive ? "Deactivate" : "Activate"}
           </button>
         );
       }
       ```

    3. **Create src/app/admin/tenants/new/page.tsx** — Create tenant form:

       ```typescript
       "use client";

       import { useState } from "react";
       import { useRouter } from "next/navigation";
       import { createTenant } from "@/app/actions/admin";

       export default function NewTenantPage() {
         const [error, setError] = useState<string | null>(null);
         const [loading, setLoading] = useState(false);
         const router = useRouter();

         async function handleSubmit(e: React.FormEvent<HTMLFormElement>) {
           e.preventDefault();
           setError(null);
           setLoading(true);

           try {
             const formData = new FormData(e.currentTarget);
             await createTenant(formData);
             router.push("/admin/tenants");
           } catch (err) {
             setError(err instanceof Error ? err.message : "Failed to create tenant");
           } finally {
             setLoading(false);
           }
         }

         return (
           <div className="max-w-xl space-y-6">
             <div>
               <h1 className="font-serif text-3xl font-bold tracking-tight">
                 Create Tenant
               </h1>
               <p className="text-muted-foreground mt-1">
                 Set up a new tenant organization
               </p>
             </div>

             <form onSubmit={handleSubmit} className="space-y-4">
               {error && (
                 <div className="rounded-md bg-destructive/10 p-3 text-sm text-destructive">
                   {error}
                 </div>
               )}

               <div className="space-y-2">
                 <label htmlFor="name" className="text-sm font-medium">Organization Name</label>
                 <input
                   id="name" name="name" required
                   className="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"
                   placeholder="The W Team"
                 />
               </div>

               <div className="space-y-2">
                 <label htmlFor="slug" className="text-sm font-medium">URL Slug</label>
                 <input
                   id="slug" name="slug" required
                   className="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"
                   placeholder="the-w-team"
                 />
                 <p className="text-xs text-muted-foreground">Lowercase letters, numbers, and hyphens only</p>
               </div>

               <div className="space-y-2">
                 <label htmlFor="logo_url" className="text-sm font-medium">Logo URL (optional)</label>
                 <input
                   id="logo_url" name="logo_url"
                   className="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"
                   placeholder="https://example.com/logo.png"
                 />
               </div>

               <div className="grid grid-cols-2 gap-4">
                 <div className="space-y-2">
                   <label htmlFor="primary_color" className="text-sm font-medium">Primary Color</label>
                   <div className="flex gap-2">
                     <input
                       type="color" id="primary_color_picker"
                       defaultValue="#d4af37"
                       className="h-10 w-10 rounded border border-input cursor-pointer"
                       onChange={(e) => {
                         const input = document.getElementById("primary_color") as HTMLInputElement;
                         if (input) input.value = e.target.value;
                       }}
                     />
                     <input
                       id="primary_color" name="primary_color"
                       defaultValue="#d4af37"
                       className="flex h-10 flex-1 rounded-md border border-input bg-background px-3 py-2 text-sm"
                     />
                   </div>
                 </div>
                 <div className="space-y-2">
                   <label htmlFor="secondary_color" className="text-sm font-medium">Secondary Color</label>
                   <div className="flex gap-2">
                     <input
                       type="color" id="secondary_color_picker"
                       defaultValue="#f4d47f"
                       className="h-10 w-10 rounded border border-input cursor-pointer"
                       onChange={(e) => {
                         const input = document.getElementById("secondary_color") as HTMLInputElement;
                         if (input) input.value = e.target.value;
                       }}
                     />
                     <input
                       id="secondary_color" name="secondary_color"
                       defaultValue="#f4d47f"
                       className="flex h-10 flex-1 rounded-md border border-input bg-background px-3 py-2 text-sm"
                     />
                   </div>
                 </div>
               </div>

               <div className="flex gap-3 pt-4">
                 <button
                   type="submit" disabled={loading}
                   className="inline-flex h-10 items-center justify-center rounded-md bg-primary px-6 text-sm font-medium text-primary-foreground hover:bg-primary/90 disabled:opacity-50"
                 >
                   {loading ? "Creating..." : "Create Tenant"}
                 </button>
                 <button
                   type="button"
                   onClick={() => router.back()}
                   className="inline-flex h-10 items-center justify-center rounded-md border border-input px-6 text-sm font-medium hover:bg-accent"
                 >
                   Cancel
                 </button>
               </div>
             </form>
           </div>
         );
       }
       ```

    4. **Create src/app/admin/users/page.tsx** — User list:

       ```typescript
       import { createAdminClient } from "@/lib/supabase/admin";
       import Link from "next/link";

       export default async function UsersPage() {
         const supabase = createAdminClient();

         const { data: users, error } = await supabase
           .from("users")
           .select(`
             id,
             email,
             full_name,
             role,
             is_active,
             created_at,
             tenant_id,
             tenants (
               name,
               slug
             )
           `)
           .order("created_at", { ascending: false });

         if (error) throw new Error(`Failed to load users: ${error.message}`);

         return (
           <div className="space-y-6">
             <div className="flex items-center justify-between">
               <div>
                 <h1 className="font-serif text-3xl font-bold tracking-tight">Users</h1>
                 <p className="text-muted-foreground mt-1">Manage all users across tenants</p>
               </div>
               <Link
                 href="/admin/users/new"
                 className="inline-flex h-10 items-center justify-center rounded-md bg-primary px-4 text-sm font-medium text-primary-foreground hover:bg-primary/90"
               >
                 Invite User
               </Link>
             </div>

             <div className="rounded-lg border border-border">
               <table className="w-full">
                 <thead>
                   <tr className="border-b border-border">
                     <th className="px-4 py-3 text-left text-sm font-medium text-muted-foreground">Name</th>
                     <th className="px-4 py-3 text-left text-sm font-medium text-muted-foreground">Email</th>
                     <th className="px-4 py-3 text-left text-sm font-medium text-muted-foreground">Tenant</th>
                     <th className="px-4 py-3 text-left text-sm font-medium text-muted-foreground">Role</th>
                     <th className="px-4 py-3 text-left text-sm font-medium text-muted-foreground">Status</th>
                   </tr>
                 </thead>
                 <tbody>
                   {users?.map((user: any) => (
                     <tr key={user.id} className="border-b border-border last:border-0">
                       <td className="px-4 py-3 text-sm font-medium">{user.full_name}</td>
                       <td className="px-4 py-3 text-sm text-muted-foreground">{user.email}</td>
                       <td className="px-4 py-3 text-sm text-muted-foreground">
                         {user.tenants?.name || "—"}
                       </td>
                       <td className="px-4 py-3 text-sm">
                         <span className="inline-flex items-center rounded-full px-2 py-1 text-xs font-medium bg-primary/10 text-primary">
                           {user.role}
                         </span>
                       </td>
                       <td className="px-4 py-3 text-sm">
                         <span className={`inline-flex items-center rounded-full px-2 py-1 text-xs font-medium ${
                           user.is_active ? "bg-green-500/10 text-green-400" : "bg-red-500/10 text-red-400"
                         }`}>
                           {user.is_active ? "Active" : "Inactive"}
                         </span>
                       </td>
                     </tr>
                   ))}
                   {(!users || users.length === 0) && (
                     <tr>
                       <td colSpan={5} className="px-4 py-8 text-center text-sm text-muted-foreground">
                         No users yet.
                       </td>
                     </tr>
                   )}
                 </tbody>
               </table>
             </div>
           </div>
         );
       }
       ```

    5. **Create src/app/admin/users/new/page.tsx** — Invite user form:

       ```typescript
       "use client";

       import { useState, useEffect } from "react";
       import { useRouter } from "next/navigation";
       import { inviteUser } from "@/app/actions/admin";
       import { createClient } from "@/lib/supabase/client";

       export default function NewUserPage() {
         const [error, setError] = useState<string | null>(null);
         const [success, setSuccess] = useState<{ email: string; tempPassword: string } | null>(null);
         const [loading, setLoading] = useState(false);
         const [tenants, setTenants] = useState<Array<{ id: string; name: string }>>([]);
         const router = useRouter();

         useEffect(() => {
           // Fetch tenants for dropdown
           async function loadTenants() {
             const supabase = createClient();
             const { data } = await supabase
               .from("tenants")
               .select("id, name")
               .eq("is_active", true)
               .order("name");
             if (data) setTenants(data);
           }
           loadTenants();
         }, []);

         async function handleSubmit(e: React.FormEvent<HTMLFormElement>) {
           e.preventDefault();
           setError(null);
           setSuccess(null);
           setLoading(true);

           try {
             const formData = new FormData(e.currentTarget);
             const result = await inviteUser(formData);
             setSuccess({ email: result.email, tempPassword: result.tempPassword });
           } catch (err) {
             setError(err instanceof Error ? err.message : "Failed to invite user");
           } finally {
             setLoading(false);
           }
         }

         return (
           <div className="max-w-xl space-y-6">
             <div>
               <h1 className="font-serif text-3xl font-bold tracking-tight">Invite User</h1>
               <p className="text-muted-foreground mt-1">Add a user to a tenant organization</p>
             </div>

             {success && (
               <div className="rounded-md bg-green-500/10 border border-green-500/20 p-4 space-y-2">
                 <p className="text-sm font-medium text-green-400">User created successfully!</p>
                 <p className="text-sm text-muted-foreground">Email: {success.email}</p>
                 <p className="text-sm text-muted-foreground">
                   Temporary password: <code className="bg-muted px-1 rounded">{success.tempPassword}</code>
                 </p>
                 <p className="text-xs text-muted-foreground">Share these credentials securely. User should change password on first login.</p>
               </div>
             )}

             <form onSubmit={handleSubmit} className="space-y-4">
               {error && (
                 <div className="rounded-md bg-destructive/10 p-3 text-sm text-destructive">{error}</div>
               )}

               <div className="space-y-2">
                 <label htmlFor="full_name" className="text-sm font-medium">Full Name</label>
                 <input
                   id="full_name" name="full_name" required
                   className="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"
                   placeholder="Jane Doe"
                 />
               </div>

               <div className="space-y-2">
                 <label htmlFor="email" className="text-sm font-medium">Email</label>
                 <input
                   id="email" name="email" type="email" required
                   className="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"
                   placeholder="jane@example.com"
                 />
               </div>

               <div className="space-y-2">
                 <label htmlFor="tenant_id" className="text-sm font-medium">Tenant</label>
                 <select
                   id="tenant_id" name="tenant_id" required
                   className="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"
                 >
                   <option value="">Select tenant...</option>
                   {tenants.map((t) => (
                     <option key={t.id} value={t.id}>{t.name}</option>
                   ))}
                 </select>
               </div>

               <div className="space-y-2">
                 <label htmlFor="role" className="text-sm font-medium">Role</label>
                 <select
                   id="role" name="role" required
                   className="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"
                 >
                   <option value="">Select role...</option>
                   <option value="tenant_admin">Tenant Admin</option>
                   <option value="agent">Agent</option>
                   <option value="assistant">Assistant (Read Only)</option>
                 </select>
               </div>

               <div className="flex gap-3 pt-4">
                 <button
                   type="submit" disabled={loading}
                   className="inline-flex h-10 items-center justify-center rounded-md bg-primary px-6 text-sm font-medium text-primary-foreground hover:bg-primary/90 disabled:opacity-50"
                 >
                   {loading ? "Creating..." : "Create User"}
                 </button>
                 <button
                   type="button"
                   onClick={() => router.back()}
                   className="inline-flex h-10 items-center justify-center rounded-md border border-input px-6 text-sm font-medium hover:bg-accent"
                 >
                   Cancel
                 </button>
               </div>
             </form>
           </div>
         );
       }
       ```

    IMPORTANT:
    - Admin pages use createAdminClient() for data fetching (bypass RLS to see all tenants/users)
    - Tenant list includes TenantStatusToggle client component for deactivation
    - User invitation shows temp password after creation (for sharing with user)
    - User list shows joined tenant data via Supabase foreign key join
    - All forms use basic HTML elements with Tailwind styles (not shadcn components yet)
    - The invite user page fetches tenants client-side for the dropdown (super admin bypasses RLS via admin client, but client-side fetch uses regular client — super admin policies handle this)
  </action>
  <verify>
    Run `npx tsc --noEmit` — no TypeScript errors.
    Verify all admin pages exist in src/app/admin/ directory.
    Verify tenant list page shows name, slug, status, created date.
    Verify create tenant form has name, slug, logo_url, color fields.
    Verify invite user form has name, email, tenant dropdown, role dropdown.
    Verify tenant status toggle button exists.
  </verify>
  <done>
    Complete admin panel with dashboard (tenant/user counts), tenant list with deactivation toggle, create tenant form with branding fields, user list with tenant/role info, and invite user form with tenant/role selection. All admin pages are isolated at /admin route group.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. Admin layout guards with requireSuperAdmin()
3. Admin dashboard shows tenant and user counts
4. Tenant list displays all tenants with status and actions
5. Create tenant form validates and creates tenant
6. User list shows all users with tenant and role
7. Invite user form creates auth user + public user with app_metadata
8. Server actions use service role client
9. All admin pages use dark theme styling
</verification>

<success_criteria>
- /admin accessible only to super_admin role users
- Admin dashboard displays correct counts
- Create Tenant: fill form -> submit -> tenant appears in list
- Invite User: select tenant + role -> submit -> user created with temp password displayed
- Deactivate Tenant: click toggle -> status changes to "Inactive"
- Admin panel has its own sidebar navigation (separate from tenant sidebar)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-07-SUMMARY.md`
</output>
