---
phase: 10-saved-personas-screen-c
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/[orgId]/personas/components/persona-sparkline.tsx
  - src/app/[orgId]/personas/components/persona-card.tsx
  - src/app/[orgId]/personas/components/persona-card-grid.tsx
autonomous: true
requirements: [PB-01, PB-02, PB-03, PB-05, PB-06]

must_haves:
  truths:
    - "Each persona card shows name (Cormorant 22px), filter criteria tags, last run date, and sparkline trend"
    - "Starter persona cards display a 'Suggested' gold badge and hide Edit/Delete actions"
    - "Custom persona cards show Edit and Delete action buttons"
    - "Create New Persona card (dashed border, + icon) opens PersonaFormDialog in create mode"
    - "Search and Explore buttons on each card link to /${orgId}/search?persona=${id}"
  artifacts:
    - path: "src/app/[orgId]/personas/components/persona-sparkline.tsx"
      provides: "Recharts LineChart sparkline wrapper (no axes, no grid, 36px height)"
      min_lines: 15
    - path: "src/app/[orgId]/personas/components/persona-card.tsx"
      provides: "Individual persona card with full visual treatment per design system"
      min_lines: 80
    - path: "src/app/[orgId]/personas/components/persona-card-grid.tsx"
      provides: "Responsive grid of PersonaCards plus Create New Persona CTA card"
      min_lines: 40
  key_links:
    - from: "src/app/[orgId]/personas/components/persona-card.tsx"
      to: "src/app/[orgId]/personas/components/persona-sparkline.tsx"
      via: "import PersonaSparkline"
      pattern: "PersonaSparkline"
    - from: "src/app/[orgId]/personas/components/persona-card-grid.tsx"
      to: "src/app/[orgId]/personas/components/persona-card.tsx"
      via: "import PersonaCard, maps personas array"
      pattern: "PersonaCard"
    - from: "src/app/[orgId]/personas/components/persona-card-grid.tsx"
      to: "src/app/[orgId]/personas/components/persona-form-dialog.tsx"
      via: "import PersonaFormDialog for Create New Persona card"
      pattern: "PersonaFormDialog"
---

<objective>
Build the persona card components: sparkline, individual card, and card grid with Create New Persona CTA.

Purpose: These are the core visual units of the Saved Personas screen. Each persona is rendered as a rich card with sparkline trend, filter criteria tags, match estimates, action buttons, and design-system-compliant surface treatment.

Output: Three new client components ready to be composed into the three-column layout (Plan 03).
</objective>

<execution_context>
@/Users/aymanbaig/.claude/get-shit-done/workflows/execute-plan.md
@/Users/aymanbaig/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-saved-personas-screen-c/10-RESEARCH.md

<interfaces>
<!-- Key types and contracts the executor needs. Extracted from codebase. -->

From src/lib/personas/types.ts:
```typescript
export interface PersonaFilters {
  titles?: string[];
  seniorities?: string[];
  industries?: string[];
  locations?: string[];
  companySize?: string[];
  keywords?: string;
}

export interface Persona {
  id: string;
  tenant_id: string;
  name: string;
  description: string | null;
  filters: PersonaFilters;
  is_starter: boolean;
  created_by: string;
  last_used_at: string | null;
  created_at: string;
  updated_at: string;
}
```

From src/app/[orgId]/personas/actions.ts:
```typescript
export async function createPersonaAction(formData: FormData): Promise<void>;
export async function updatePersonaAction(id: string, formData: FormData): Promise<void>;
export async function deletePersonaAction(id: string): Promise<void>;
```

From src/app/[orgId]/personas/components/persona-form-dialog.tsx:
```typescript
interface PersonaFormDialogProps {
  mode: "create" | "edit";
  persona?: Persona;
  trigger: React.ReactNode;
}
export function PersonaFormDialog({ mode, persona, trigger }: PersonaFormDialogProps): JSX.Element;
```

From src/components/ui/badge.tsx:
```typescript
// variant="gold" → "bg-[var(--gold-bg-strong)] text-[var(--gold-primary)] border-[var(--border-gold)]"
export function Badge({ className, variant, ...props }: BadgeProps): JSX.Element;
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PersonaSparkline and PersonaCard components</name>
  <files>
    src/app/[orgId]/personas/components/persona-sparkline.tsx
    src/app/[orgId]/personas/components/persona-card.tsx
  </files>
  <action>
**PersonaSparkline** (`persona-sparkline.tsx`):
- `"use client"` directive
- Import `LineChart`, `Line`, `ResponsiveContainer` from `recharts`
- Props: `data: Array<{ value: number }>`, optional `color` defaulting to `"var(--gold-primary)"`
- If `data.length === 0`, return null
- Render `ResponsiveContainer` width="100%" height={36}
- Inside: `LineChart` with margin `{ top: 2, right: 0, bottom: 2, left: 0 }`
- Single `Line` with `type="monotone"`, `dataKey="value"`, `stroke={color}`, `strokeWidth={1.5}`, `dot={false}`, `isAnimationActive={false}`
- No XAxis, YAxis, CartesianGrid, or Tooltip — pure sparkline

**PersonaCard** (`persona-card.tsx`):
- `"use client"` directive
- Import: `useState` from react, `Link` from next/link, `useParams` from next/navigation
- Import: `Persona`, `PersonaFilters` from `@/lib/personas/types`
- Import: `Badge` from `@/components/ui/badge`, icons `Search, Pencil, Trash2, TrendingUp, Compass` from lucide-react
- Import: `PersonaFormDialog` from `./persona-form-dialog`, `deletePersonaAction` from `../actions`, `PersonaSparkline` from `./persona-sparkline`

- Props interface:
  ```typescript
  interface PersonaCardProps {
    persona: Persona;
  }
  ```

- Component body:
  1. Get `orgId` from `useParams()`
  2. `isDeleting` state (boolean)
  3. `handleDelete` async function: `window.confirm()` guard, calls `deletePersonaAction(persona.id)`, error alert fallback. Same pattern as existing persona-list.tsx.

  4. **Synthetic sparkline data** — generate 7 deterministic data points from persona.id hash:
     ```typescript
     const sparklineData = useMemo(() => {
       let seed = persona.id.split("").reduce((acc, c) => acc + c.charCodeAt(0), 0);
       return Array.from({ length: 7 }, () => {
         seed = (seed * 9301 + 49297) % 233280;
         return { value: Math.floor((seed / 233280) * 500) + 100 };
       });
     }, [persona.id]);
     ```

  5. **Filter tags** — extract up to 4 tags from persona.filters:
     ```typescript
     const filterTags = useMemo(() => {
       const tags: string[] = [];
       if (persona.filters.titles) tags.push(...persona.filters.titles.slice(0, 2));
       if (persona.filters.industries) tags.push(...persona.filters.industries.slice(0, 1));
       if (persona.filters.seniorities) {
         tags.push(...persona.filters.seniorities.slice(0, 1).map(s => s.replace("_", " ")));
       }
       return tags.filter(Boolean).slice(0, 4);
     }, [persona.filters]);
     ```

  6. **Last used display**: `persona.last_used_at ? new Date(persona.last_used_at).toLocaleDateString("en-US", { month: "short", day: "numeric" }) : "Never run"`

  7. **Match count placeholder**: derive from sparklineData last value, format as `~${lastValue * 5} matches` (purely decorative estimate).

  8. **Card JSX structure** — all CSS variables, NO raw Tailwind color classes:
     - Outer `div`: `className="rounded-[14px] p-7 cursor-pointer transition-all flex flex-col gap-4"` with inline `style`:
       - `background: "var(--bg-card-gradient)"` (MUST use inline style, not className — Tailwind v3 cannot resolve CSS gradient variables)
       - `border: "1px solid var(--border-subtle)"`
     - Add `onMouseEnter`/`onMouseLeave` handlers to toggle:
       - hover: `background: "var(--bg-card-hover)"`, `borderColor: "var(--border-hover)"`
       - leave: reset to `"var(--bg-card-gradient)"` and `"var(--border-subtle)"`
     - **Row 1: Name + Suggested badge**
       - `h3` with `className="font-serif text-[22px] font-semibold leading-tight"` and `style={{ color: "var(--text-primary)" }}`
       - If `persona.is_starter`: `<Badge variant="gold" className="shrink-0 text-[10px] uppercase tracking-wide">Suggested</Badge>`
     - **Row 2: Description** (if exists): `className="text-[13px] leading-relaxed line-clamp-2"` with `style={{ color: "var(--text-secondary)" }}`
     - **Row 3: Filter tags chips**:
       - `div className="flex flex-wrap gap-1.5"`
       - Each tag: `span` with `className="text-[11px] px-2.5 py-0.5 rounded-[6px]"` and `style={{ background: "var(--bg-elevated)", border: "1px solid var(--border-default)", color: "var(--text-secondary)" }}`
     - **Row 4: Stats row** — flex row between:
       - Left: "Last Run" label (11px uppercase, `--text-tertiary`) + date value (13px, `--text-primary`)
       - Right: "Total" label (11px uppercase, `--text-tertiary`) + match count (13px font-mono, `--gold-primary`)
     - **Row 5: Sparkline**
       - `<PersonaSparkline data={sparklineData} />`
     - **Row 6: Action buttons** — flex row with gap-2:
       - `Link` button to `/${orgId}/search?persona=${persona.id}`: ghost-style button with Search icon + "Search" label
         - `className="flex items-center gap-1.5 text-[12px] px-3 py-1.5 rounded-[8px] cursor-pointer transition-all"`
         - `style={{ background: "rgba(255,255,255,0.03)", border: "1px solid rgba(255,255,255,0.08)", color: "rgba(232,228,220,0.6)" }}`
       - Second `Link` to same URL: ghost button with Compass icon + "Explore" (same href — "Explore" is identical to "Search" for now, per research open question)
       - If `!persona.is_starter`: Edit button using `PersonaFormDialog mode="edit"` with `Pencil` icon trigger (same ghost style), Delete button with `Trash2` icon (ghost style, `hover:text-destructive` via onMouseEnter color change)

  **IMPORTANT constraints:**
  - Do NOT use raw Tailwind color classes (zinc-*, gray-*, emerald-*)
  - Use inline `style` for all CSS variable references that involve gradients or custom properties (bg-card-gradient, border-subtle, text-primary, etc.)
  - `cursor-pointer` on the card and all buttons
  - `font-serif` class for the card name (Cormorant Garamond) — never `font-cormorant`
  </action>
  <verify>
    <automated>cd "/Users/aymanbaig/Desktop/Manual Library/Phronesis-main" && npx tsc --noEmit --pretty 2>&1 | head -30</automated>
  </verify>
  <done>
    PersonaSparkline renders a 36px-height gold sparkline with no axes/grid. PersonaCard renders a full persona card with name (Cormorant 22px), Suggested badge on starters, filter tags as chips, stats row, sparkline, Search/Explore links, and Edit/Delete for non-starters. All styling uses CSS variables via inline style — no raw Tailwind colors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create PersonaCardGrid with Create New Persona CTA card</name>
  <files>
    src/app/[orgId]/personas/components/persona-card-grid.tsx
  </files>
  <action>
**PersonaCardGrid** (`persona-card-grid.tsx`):
- `"use client"` directive
- Import: `Persona` from `@/lib/personas/types`, `PersonaCard` from `./persona-card`, `PersonaFormDialog` from `./persona-form-dialog`, `Plus` from `lucide-react`

- Props: `{ personas: Persona[] }`

- Render a responsive grid:
  - `className="grid gap-5"` with `style={{ gridTemplateColumns: "repeat(auto-fill, minmax(340px, 1fr))" }}`

- Map `personas` into `<PersonaCard key={persona.id} persona={persona} />`

- After the persona cards, render the **Create New Persona card** as the last grid item:
  - Wrap in `<PersonaFormDialog mode="create" trigger={...}>`:
    - Trigger is a `button` element:
      - `className="rounded-[14px] p-7 w-full cursor-pointer flex flex-col items-center justify-center gap-3 transition-all"`
      - `style={{ border: "1px dashed var(--border-default)", background: "transparent", minHeight: "280px" }}`
      - Add `onMouseEnter`/`onMouseLeave` for hover:
        - hover: `borderColor: "var(--border-hover)"`, `background: "rgba(255,255,255,0.01)"`
        - leave: `borderColor: "var(--border-default)"`, `background: "transparent"`
      - Inside:
        1. Circle icon container: `className="flex h-12 w-12 items-center justify-center rounded-full"` with `style={{ background: "var(--gold-bg)" }}`
           - `<Plus className="h-5 w-5" style={{ color: "var(--gold-primary)" }} />`
        2. Label: `span className="text-[14px] font-medium"` with `style={{ color: "var(--text-primary)" }}` — text "Create New Persona"
        3. Subtitle: `span className="text-[12px]"` with `style={{ color: "var(--text-ghost)" }}` — text "Custom filter combination"

  **IMPORTANT:** The PersonaFormDialog wraps the CTA card button as its trigger via the `trigger` prop. This reuses the existing dialog without modification (requirement PB-01).
  </action>
  <verify>
    <automated>cd "/Users/aymanbaig/Desktop/Manual Library/Phronesis-main" && npx tsc --noEmit --pretty 2>&1 | head -30</automated>
  </verify>
  <done>
    PersonaCardGrid renders a responsive CSS Grid of PersonaCard components plus a dashed-border "Create New Persona" CTA card that opens the existing PersonaFormDialog. Grid uses `minmax(340px, 1fr)` auto-fill columns.
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with no errors in the three new files
- PersonaSparkline is a `"use client"` component rendering Recharts LineChart with no axes
- PersonaCard renders all card sections: name (font-serif), Suggested badge (variant="gold"), filter tags (rounded-[6px] chips), stats row, sparkline, action buttons
- Starter persona cards hide Edit/Delete buttons (`!persona.is_starter` guard)
- Create New Persona card uses dashed border and triggers PersonaFormDialog
- All styling uses CSS variables (--bg-card-gradient, --border-subtle, --text-primary, etc.) — no raw Tailwind color classes
</verification>

<success_criteria>
Three new client components compile without TypeScript errors and are ready for composition into the PersonasLayout (Plan 03). Card design matches Screen C mockup: rich data density with sparklines, filter tags, stats, and gold-accent treatments.
</success_criteria>

<output>
After completion, create `.planning/phases/10-saved-personas-screen-c/10-01-SUMMARY.md`
</output>
