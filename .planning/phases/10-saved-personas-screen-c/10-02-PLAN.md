---
phase: 10-saved-personas-screen-c
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/[orgId]/personas/components/personas-library-sidebar.tsx
  - src/app/[orgId]/personas/components/live-data-stream.tsx
autonomous: true
requirements: [PB-04, PB-06]

must_haves:
  truths:
    - "Left sidebar shows Library Stats: active persona count and total matches estimate"
    - "Left sidebar has industry filter checkboxes that call onIndustryChange callback"
    - "Left sidebar has data freshness radio (Live / Past Week) that calls onFreshnessChange callback"
    - "Right sidebar displays a Live Data Stream with simulated events that update every 8 seconds"
    - "Both sidebars are hidden on screens below lg breakpoint (< 1024px)"
  artifacts:
    - path: "src/app/[orgId]/personas/components/personas-library-sidebar.tsx"
      provides: "Left sidebar with stats, industry filter checkboxes, data freshness radio"
      min_lines: 80
    - path: "src/app/[orgId]/personas/components/live-data-stream.tsx"
      provides: "Right sidebar with simulated event feed"
      min_lines: 60
  key_links:
    - from: "src/app/[orgId]/personas/components/personas-library-sidebar.tsx"
      to: "parent PersonasLayout (Plan 03)"
      via: "props: personas, selectedIndustries, onIndustryChange, freshness, onFreshnessChange"
      pattern: "onIndustryChange|onFreshnessChange"
    - from: "src/app/[orgId]/personas/components/live-data-stream.tsx"
      to: "parent PersonasLayout (Plan 03)"
      via: "standalone component, no props needed"
      pattern: "LiveDataStream"
---

<objective>
Build the two sidebar components: Library Stats + Filters (left) and Live Data Stream (right).

Purpose: The sidebars flank the persona card grid to create the three-column "Saved Personas & Living Data" layout from Screen C. The left sidebar provides filtering/stats context; the right sidebar creates a "living data" feel with a simulated event feed.

Output: Two new client components ready to be composed into the PersonasLayout (Plan 03).
</objective>

<execution_context>
@/Users/aymanbaig/.claude/get-shit-done/workflows/execute-plan.md
@/Users/aymanbaig/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-saved-personas-screen-c/10-RESEARCH.md

<interfaces>
<!-- Key types the executor needs -->

From src/lib/personas/types.ts:
```typescript
export interface PersonaFilters {
  titles?: string[];
  seniorities?: string[];
  industries?: string[];
  locations?: string[];
  companySize?: string[];
  keywords?: string;
}

export interface Persona {
  id: string;
  tenant_id: string;
  name: string;
  description: string | null;
  filters: PersonaFilters;
  is_starter: boolean;
  created_by: string;
  last_used_at: string | null;
  created_at: string;
  updated_at: string;
}
```

From src/components/ui/checkbox.tsx (Radix Checkbox, already installed):
```typescript
// Standard shadcn Checkbox component — use directly
import { Checkbox } from "@/components/ui/checkbox";
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PersonasLibrarySidebar component</name>
  <files>
    src/app/[orgId]/personas/components/personas-library-sidebar.tsx
  </files>
  <action>
**PersonasLibrarySidebar** (`personas-library-sidebar.tsx`):
- `"use client"` directive
- Import: `Persona` from `@/lib/personas/types`, `Checkbox` from `@/components/ui/checkbox`, `Label` from `@/components/ui/label`, `Radio, Users, Activity` from `lucide-react`

- Props interface:
  ```typescript
  interface PersonasLibrarySidebarProps {
    personas: Persona[];
    selectedIndustries: string[];
    onIndustryChange: (industries: string[]) => void;
    freshness: "live" | "past_week";
    onFreshnessChange: (freshness: "live" | "past_week") => void;
  }
  ```

- Component body:
  1. **Derive stats from personas array**:
     - `activeCount` = `personas.length`
     - `totalEstimate` = sum of a deterministic pseudo-random value per persona (same seed approach as PersonaCard, multiply by 5), format with comma separator

  2. **Extract unique industries from all personas**:
     ```typescript
     const industries = useMemo(() => {
       const set = new Set<string>();
       personas.forEach(p => p.filters.industries?.forEach(i => set.add(i)));
       return Array.from(set).sort();
     }, [personas]);
     ```

  3. **Industry checkbox toggle handler**:
     ```typescript
     const toggleIndustry = (industry: string) => {
       if (selectedIndustries.includes(industry)) {
         onIndustryChange(selectedIndustries.filter(i => i !== industry));
       } else {
         onIndustryChange([...selectedIndustries, industry]);
       }
     };
     ```

  4. **JSX structure** — all CSS variables, no raw Tailwind colors:

  - Outer `aside`: `className="hidden lg:flex flex-col gap-6 overflow-y-auto"` with `style={{ background: "var(--bg-card-gradient)", border: "1px solid var(--border-subtle)", borderRadius: "14px", padding: "24px" }}`

  - **Section 1: LIBRARY STATS** (uppercase 11px label):
    - Label: `className="text-[11px] font-semibold uppercase tracking-[1px]"` with `style={{ color: "var(--text-tertiary)" }}`
    - Two stat chips side by side (flex row gap-3):
      - Each chip: `div className="flex-1 rounded-[8px] p-3"` with `style={{ background: "var(--bg-elevated)", border: "1px solid var(--border-default)" }}`
        - Number: `className="font-mono text-[22px] font-semibold"` with `style={{ color: "var(--text-primary)" }}`
        - Sub-label: `className="text-[11px]"` with `style={{ color: "var(--text-tertiary)" }}`
      - First chip: `activeCount` number, "Active Personas" label
      - Second chip: `totalEstimate` number, "Est. Matches" label

  - **Divider**: `div` with `style={{ height: "1px", background: "var(--border-subtle)" }}`

  - **Section 2: FILTER BY INDUSTRY**:
    - Section label (same 11px uppercase style as above)
    - Vertical list of checkboxes:
      - For each `industry` in the derived `industries` array:
        - `div className="flex items-center gap-2.5 cursor-pointer"` with onClick to `toggleIndustry(industry)`
        - `Checkbox` with `checked={selectedIndustries.includes(industry)}`, `onCheckedChange={() => toggleIndustry(industry)}`, `id={industry}`
        - `Label htmlFor={industry}` with `className="text-[13px] cursor-pointer"` and `style={{ color: "var(--text-secondary)" }}`
      - If `industries.length === 0`: show a small "No industries defined" message in `--text-tertiary`

  - **Divider** (same as above)

  - **Section 3: DATA FRESHNESS**:
    - Section label (same 11px uppercase style)
    - Two radio options as clickable rows:
      - For each option `{ value: "live", label: "Live" }` and `{ value: "past_week", label: "Past Week" }`:
        - `div className="flex items-center gap-2.5 cursor-pointer"` with `onClick={() => onFreshnessChange(value)}`
        - Custom radio circle: `div className="h-4 w-4 rounded-full border flex items-center justify-center"` with:
          - If selected: `style={{ borderColor: "var(--gold-primary)" }}` + inner dot `div className="h-2 w-2 rounded-full"` with `style={{ background: "var(--gold-primary)" }}`
          - If not selected: `style={{ borderColor: "var(--border-default)" }}`
        - Label: `span className="text-[13px]"` with `style={{ color: freshness === value ? "var(--text-primary)" : "var(--text-secondary)" }}`

  **IMPORTANT constraints:**
  - No raw Tailwind color classes — all colors via CSS variables in inline style
  - `hidden lg:flex` on the outer aside so it disappears below 1024px
  - Checkbox from `@/components/ui/checkbox` (Radix, already installed)
  - Custom radio circles (not an HTML radio input) for consistent styling
  - `cursor-pointer` on all interactive elements
  </action>
  <verify>
    <automated>cd "/Users/aymanbaig/Desktop/Manual Library/Phronesis-main" && npx tsc --noEmit --pretty 2>&1 | head -30</automated>
  </verify>
  <done>
    PersonasLibrarySidebar renders a left sidebar panel with Library Stats (active personas count, estimated matches), industry filter checkboxes derived from personas data, and data freshness radio buttons. All filter state changes propagate via callback props. Hidden on mobile (< lg).
  </done>
</task>

<task type="auto">
  <name>Task 2: Create LiveDataStream component</name>
  <files>
    src/app/[orgId]/personas/components/live-data-stream.tsx
  </files>
  <action>
**LiveDataStream** (`live-data-stream.tsx`):
- `"use client"` directive
- Import: `useEffect, useState, useRef` from react, `Radio, Zap, TrendingUp, AlertCircle, Users` from lucide-react

- Define event types and mock data:
  ```typescript
  interface StreamEvent {
    id: number;
    type: "new_match" | "enrichment" | "lookalike" | "high_value";
    label: string;
    persona: string;
    name: string;
    detail: string;
    time: string;
  }

  const MOCK_EVENTS: Omit<StreamEvent, "id" | "time">[] = [
    { type: "new_match", label: "New Match", persona: "Finance Elite", name: "Jonathan S.", detail: "Director, Goldman Sachs" },
    { type: "enrichment", label: "Enrichment", persona: "Soho Crypto Founders", name: "Sarah K.", detail: "Contact details updated" },
    { type: "new_match", label: "New Match", persona: "Tech Execs", name: "Michael C.", detail: "VP Engineering, Stripe" },
    { type: "lookalike", label: "Lookalike", persona: "BigLaw Partners", name: "David R.", detail: "Managing Partner, Cravath" },
    { type: "high_value", label: "High Value", persona: "NYC Crypto Founders", name: "Elena V.", detail: "Net worth est. $320M" },
    { type: "enrichment", label: "Enrichment", persona: "Startup Founders", name: "Alex T.", detail: "SEC filing detected" },
    { type: "new_match", label: "New Match", persona: "Finance Elite", name: "Robert M.", detail: "CFO, BlackRock" },
    { type: "high_value", label: "High Value", persona: "Tech Execs", name: "Lisa W.", detail: "Recent $50M property purchase" },
  ];
  ```

- **Event type icon/color mapping:**
  ```typescript
  const EVENT_STYLES: Record<StreamEvent["type"], { icon: LucideIcon; color: string; bg: string }> = {
    new_match: { icon: Users, color: "var(--gold-primary)", bg: "var(--gold-bg)" },
    enrichment: { icon: Zap, color: "var(--success)", bg: "rgba(34,197,94,0.08)" },
    lookalike: { icon: TrendingUp, color: "var(--gold-bright)", bg: "rgba(240,208,96,0.08)" },
    high_value: { icon: AlertCircle, color: "var(--gold-primary)", bg: "var(--gold-bg-strong)" },
  };
  ```
  NOTE: Import the LucideIcon type from lucide-react for the type annotation.

- Component body:
  1. Initialize events with first 5 mock events (add `id: Date.now()` and `time: "Xm ago"` values)
  2. `useEffect` with `setInterval` every 8 seconds:
     - Pick a random event from MOCK_EVENTS
     - Prepend it to the events array with `id: Date.now()`, `time: "just now"`
     - Slice to max 8 events
     - **CRITICAL**: Return cleanup function `() => clearInterval(interval)` to avoid memory leaks
  3. `useRef` for the scroll container to auto-scroll to top when new events arrive (optional nice-to-have)

- **JSX structure**:
  - Outer `aside`: `className="hidden lg:flex flex-col gap-0 overflow-hidden"` with `style={{ background: "var(--bg-card-gradient)", border: "1px solid var(--border-subtle)", borderRadius: "14px" }}`

  - **Header section**: `div className="px-5 py-4 flex items-center gap-2"` with bottom border `style={{ borderBottom: "1px solid var(--border-subtle)" }}`
    - Pulsing dot: `div className="h-2 w-2 rounded-full animate-pulse"` with `style={{ background: "var(--gold-primary)" }}`
    - Title: `span className="text-[13px] font-semibold"` with `style={{ color: "var(--text-primary)" }}` — text "Live Data Stream"

  - **Events list**: `div className="flex-1 overflow-y-auto"` (scrollable)
    - Map over events, for each:
      - `div className="px-5 py-3.5 flex gap-3 transition-colors"` with `style={{ borderBottom: "1px solid var(--border-subtle)" }}`
      - Add `onMouseEnter`/`onMouseLeave` for hover background:
        - hover: `background: "rgba(255,255,255,0.02)"`
        - leave: `background: "transparent"`
      - **Left**: Icon circle: `div className="mt-0.5 flex h-8 w-8 shrink-0 items-center justify-center rounded-full"` with `style={{ background: eventStyle.bg }}`
        - `<EventIcon className="h-3.5 w-3.5" style={{ color: eventStyle.color }} />`
      - **Right**: Info block:
        - Row 1: `div className="flex items-center justify-between gap-2"`
          - Name: `span className="text-[13px] font-medium"` with `style={{ color: "var(--text-primary)" }}` — event.name
          - Time: `span className="text-[11px]"` with `style={{ color: "var(--text-tertiary)" }}` — event.time
        - Row 2: Detail: `span className="text-[12px]"` with `style={{ color: "var(--text-secondary)" }}` — event.detail
        - Row 3: Event type pill badge:
          - `span className="inline-flex items-center mt-1 text-[10px] font-semibold uppercase tracking-[0.5px] px-2 py-0.5 rounded-full"`
          - `style={{ background: eventStyle.bg, color: eventStyle.color }}`
          - Text: event.label

  **IMPORTANT constraints:**
  - No raw Tailwind color classes — all colors via CSS variables
  - `hidden lg:flex` on outer aside to hide on mobile
  - `useEffect` cleanup for setInterval is MANDATORY
  - `isAnimationActive={false}` is not relevant here (no Recharts) but the simulated feed must NOT cause unnecessary re-renders — use functional state update in setInterval
  - `animate-pulse` is the one Tailwind animation class allowed (for the pulsing dot)
  </action>
  <verify>
    <automated>cd "/Users/aymanbaig/Desktop/Manual Library/Phronesis-main" && npx tsc --noEmit --pretty 2>&1 | head -30</automated>
  </verify>
  <done>
    LiveDataStream renders a right sidebar panel with a pulsing "Live Data Stream" header and a scrollable feed of simulated events. Events update every 8 seconds via setInterval with proper cleanup. Each event shows an icon circle, name, detail, time, and type badge. Hidden on mobile (< lg).
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with no errors in the two new files
- PersonasLibrarySidebar accepts personas + filter state props, renders stats + checkboxes + radio buttons
- LiveDataStream renders mock events with 8-second auto-update, proper cleanup
- Both components use `hidden lg:flex` for mobile responsiveness
- All styling uses CSS variables — no raw Tailwind color classes
</verification>

<success_criteria>
Two sidebar client components compile without TypeScript errors and are ready for composition into the PersonasLayout (Plan 03). Left sidebar provides filtering context; right sidebar creates the "living data" UX feel.
</success_criteria>

<output>
After completion, create `.planning/phases/10-saved-personas-screen-c/10-02-SUMMARY.md`
</output>
