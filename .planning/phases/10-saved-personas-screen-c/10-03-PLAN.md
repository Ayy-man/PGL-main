---
phase: 10-saved-personas-screen-c
plan: 03
type: execute
wave: 2
depends_on: [10-01, 10-02]
files_modified:
  - src/app/[orgId]/personas/components/personas-layout.tsx
  - src/app/[orgId]/personas/page.tsx
  - src/app/[orgId]/personas/components/persona-list.tsx
autonomous: true
requirements: [PB-01, PB-02, PB-03, PB-04, PB-05, PB-06]

must_haves:
  truths:
    - "Personas page renders a three-column layout: left sidebar (220px) + center card grid (fluid) + right sidebar (280px)"
    - "Sidebars collapse on screens below lg breakpoint — center grid fills full width on mobile"
    - "Industry filter checkboxes in left sidebar filter the persona card grid client-side"
    - "Data freshness radio filters personas by last_used_at within 7 days (Past Week) or shows all (Live)"
    - "Page header shows 'Saved Personas & Living Data' title with Cormorant Garamond and subtitle"
    - "Empty state shows when no personas exist (uses shared EmptyState component)"
    - "Build passes with no TypeScript errors"
  artifacts:
    - path: "src/app/[orgId]/personas/components/personas-layout.tsx"
      provides: "Three-column grid shell with filter state management"
      min_lines: 60
    - path: "src/app/[orgId]/personas/page.tsx"
      provides: "Server Component fetching personas and rendering PersonasLayout"
      min_lines: 30
  key_links:
    - from: "src/app/[orgId]/personas/page.tsx"
      to: "src/app/[orgId]/personas/components/personas-layout.tsx"
      via: "passes personas array as prop"
      pattern: "PersonasLayout"
    - from: "src/app/[orgId]/personas/components/personas-layout.tsx"
      to: "src/app/[orgId]/personas/components/persona-card-grid.tsx"
      via: "renders filtered personas in center column"
      pattern: "PersonaCardGrid"
    - from: "src/app/[orgId]/personas/components/personas-layout.tsx"
      to: "src/app/[orgId]/personas/components/personas-library-sidebar.tsx"
      via: "passes filter state and callbacks"
      pattern: "PersonasLibrarySidebar"
    - from: "src/app/[orgId]/personas/components/personas-layout.tsx"
      to: "src/app/[orgId]/personas/components/live-data-stream.tsx"
      via: "renders in right column"
      pattern: "LiveDataStream"
---

<objective>
Wire all persona components into the PersonasLayout three-column shell and rewire page.tsx to use the new layout.

Purpose: This plan composes all components built in Plans 01 and 02 into the final Screen C layout. The page.tsx Server Component fetches data, the PersonasLayout Client Component manages filter state and renders all three columns. The old PersonaList component is replaced.

Output: Working Saved Personas page matching the Screen C mockup with three-column layout, client-side filtering, and responsive collapse.
</objective>

<execution_context>
@/Users/aymanbaig/.claude/get-shit-done/workflows/execute-plan.md
@/Users/aymanbaig/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-saved-personas-screen-c/10-RESEARCH.md
@.planning/phases/10-saved-personas-screen-c/10-01-SUMMARY.md
@.planning/phases/10-saved-personas-screen-c/10-02-SUMMARY.md

<interfaces>
<!-- Key types and components the executor needs -->

From src/lib/personas/types.ts:
```typescript
export interface Persona {
  id: string;
  tenant_id: string;
  name: string;
  description: string | null;
  filters: PersonaFilters;
  is_starter: boolean;
  created_by: string;
  last_used_at: string | null;
  created_at: string;
  updated_at: string;
}
```

From Plan 01 artifacts:
```typescript
// src/app/[orgId]/personas/components/persona-card-grid.tsx
export function PersonaCardGrid({ personas }: { personas: Persona[] }): JSX.Element;
```

From Plan 02 artifacts:
```typescript
// src/app/[orgId]/personas/components/personas-library-sidebar.tsx
interface PersonasLibrarySidebarProps {
  personas: Persona[];
  selectedIndustries: string[];
  onIndustryChange: (industries: string[]) => void;
  freshness: "live" | "past_week";
  onFreshnessChange: (freshness: "live" | "past_week") => void;
}
export function PersonasLibrarySidebar(props: PersonasLibrarySidebarProps): JSX.Element;

// src/app/[orgId]/personas/components/live-data-stream.tsx
export function LiveDataStream(): JSX.Element;
```

From src/components/ui/breadcrumbs.tsx:
```typescript
interface BreadcrumbItem { label: string; href?: string; }
interface BreadcrumbsProps { items: BreadcrumbItem[]; rightContent?: React.ReactNode; }
export function Breadcrumbs({ items, rightContent }: BreadcrumbsProps): JSX.Element;
```

From src/components/ui/empty-state.tsx:
```typescript
interface EmptyStateProps {
  icon?: LucideIcon;
  title: string;
  description?: string;
  children?: React.ReactNode;
  className?: string;
  variant?: "default" | "error";
}
export function EmptyState(props: EmptyStateProps): JSX.Element;
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PersonasLayout three-column shell with filter state</name>
  <files>
    src/app/[orgId]/personas/components/personas-layout.tsx
  </files>
  <action>
**PersonasLayout** (`personas-layout.tsx`):
- `"use client"` directive
- Import: `useState, useMemo` from react
- Import: `Persona` from `@/lib/personas/types`
- Import: `PersonasLibrarySidebar` from `./personas-library-sidebar`
- Import: `PersonaCardGrid` from `./persona-card-grid`
- Import: `LiveDataStream` from `./live-data-stream`

- Props: `{ personas: Persona[] }`

- **Filter state** (owned here, passed down to sidebar and grid):
  ```typescript
  const [selectedIndustries, setSelectedIndustries] = useState<string[]>([]);
  const [freshness, setFreshness] = useState<"live" | "past_week">("live");
  ```

- **Filtered personas** (client-side filtering, no server round-trip):
  ```typescript
  const filteredPersonas = useMemo(() => {
    let result = personas;

    // Industry filter
    if (selectedIndustries.length > 0) {
      result = result.filter(p =>
        p.filters.industries?.some(ind => selectedIndustries.includes(ind))
      );
    }

    // Freshness filter
    if (freshness === "past_week") {
      const weekAgo = new Date();
      weekAgo.setDate(weekAgo.getDate() - 7);
      result = result.filter(p =>
        p.last_used_at && new Date(p.last_used_at) >= weekAgo
      );
    }

    return result;
  }, [personas, selectedIndustries, freshness]);
  ```

- **JSX structure**:
  - Outer `div` with three-column CSS Grid:
    - `className="grid gap-5 min-h-0"`
    - `style={{ gridTemplateColumns: "220px 1fr 280px" }}`
    - **IMPORTANT**: On mobile (< lg), use a single column. Add a responsive wrapper:
      - Outer container: `className="grid gap-5 min-h-0 lg:grid-cols-[220px_1fr_280px]"` — use Tailwind responsive grid variant instead of inline style so it collapses properly
      - Actually, since the sidebars themselves use `hidden lg:flex`, the grid can use the inline style safely — the hidden children won't affect the grid on mobile. But the grid template columns will still reserve space for invisible items. **SOLUTION**: Use `className="flex flex-col lg:grid gap-5 min-h-0"` with `style` only applied via conditional or use:
        ```
        className="flex flex-col gap-5 min-h-0 lg:gap-5"
        ```
        and at lg breakpoint, use inline style for the grid. **BEST approach**: Use Tailwind responsive utilities:
        ```
        className="grid gap-5 min-h-0 grid-cols-1 lg:grid-cols-[220px_1fr_280px]"
        ```
        This works because Tailwind JIT CAN resolve arbitrary grid-cols values at build time (they're not CSS variable references).

  - Three children:
    1. `<PersonasLibrarySidebar personas={personas} selectedIndustries={selectedIndustries} onIndustryChange={setSelectedIndustries} freshness={freshness} onFreshnessChange={setFreshness} />`
    2. `<PersonaCardGrid personas={filteredPersonas} />`
    3. `<LiveDataStream />`

  **NOTE**: Pass the unfiltered `personas` to the sidebar (so stats and industry extraction always reflect the full set), but pass `filteredPersonas` to the grid.
  </action>
  <verify>
    <automated>cd "/Users/aymanbaig/Desktop/Manual Library/Phronesis-main" && npx tsc --noEmit --pretty 2>&1 | head -30</automated>
  </verify>
  <done>
    PersonasLayout renders a three-column CSS Grid (220px / 1fr / 280px on lg+, single column on mobile). Filter state is managed here and passed to sidebar (callbacks) and grid (filtered array). Unfiltered personas go to sidebar for accurate stats.
  </done>
</task>

<task type="auto">
  <name>Task 2: Rewire page.tsx to use PersonasLayout and add page header</name>
  <files>
    src/app/[orgId]/personas/page.tsx
    src/app/[orgId]/personas/components/persona-list.tsx
  </files>
  <action>
**Rewrite page.tsx** to use the new PersonasLayout:

1. **Imports** — replace PersonaList import with PersonasLayout:
   - Remove: `import { PersonaList } from "./components/persona-list"`
   - Remove: `import { Button } from "@/components/ui/button"`, `import { Plus } from "lucide-react"` (the top-level Create button is now inside the card grid)
   - Keep: `createClient`, `redirect`, `getPersonas`, `EmptyState`, `Users` icon
   - Add: `import { PersonasLayout } from "./components/personas-layout"`
   - Add: `import { Breadcrumbs } from "@/components/ui/breadcrumbs"`

2. **Page structure** — replace the entire return JSX:
   ```tsx
   return (
     <div className="space-y-6 page-enter">
       {/* Breadcrumbs */}
       <Breadcrumbs items={[{ label: "Personas" }]} />

       {/* Page header — matches Screen C mockup */}
       <div>
         <h1
           className="font-serif text-[38px] font-medium"
           style={{ color: "var(--text-primary)", letterSpacing: "-0.5px" }}
         >
           Saved Personas & Living Data
         </h1>
         <p
           className="mt-1 text-[14px] font-light"
           style={{ color: "var(--text-tertiary)" }}
         >
           Your active data streams. These personas are constantly updated with new leads matching your criteria.
         </p>
       </div>

       {/* Main content */}
       {personas.length === 0 ? (
         <EmptyState
           icon={Users}
           title="No personas yet"
           description="Create a persona to define your ideal buyer profile and start searching for qualified prospects."
         />
       ) : (
         <PersonasLayout personas={personas} />
       )}
     </div>
   );
   ```

3. **Remove the old top-level PersonaFormDialog trigger** — the Create New Persona CTA is now inside the PersonaCardGrid (Plan 01). The header no longer has a standalone button.

4. **Remove the PersonaFormDialog import from page.tsx** — it's no longer used here.

5. **Keep the auth checks** — the `await params`, `createClient()`, `getUser()`, tenant_id check, and `getPersonas(tenantId)` calls remain identical.

**persona-list.tsx** — This file is now UNUSED. Do NOT delete it (may be referenced elsewhere or useful for rollback). Instead, add a comment at the top:
```typescript
// DEPRECATED: Replaced by persona-card-grid.tsx + persona-card.tsx in Phase 10 redesign.
// This file is no longer imported by page.tsx.
```

**IMPORTANT page.tsx constraints:**
- Keep it as a Server Component (no `"use client"` directive) — data fetching happens here
- `page-enter` class on the outer div for fade-in animation (design system section 12)
- Page title uses `font-serif text-[38px] font-medium` with letterSpacing `-0.5px` (design system h1 spec)
- Subtitle uses `text-[14px] font-light` with `--text-tertiary` color
- No PersonaFormDialog import or usage in page.tsx — it lives inside PersonaCardGrid now
  </action>
  <verify>
    <automated>cd "/Users/aymanbaig/Desktop/Manual Library/Phronesis-main" && pnpm build 2>&1 | tail -20</automated>
  </verify>
  <done>
    page.tsx is a Server Component that fetches personas and renders either EmptyState (zero personas) or PersonasLayout (three-column grid). Page header shows "Saved Personas & Living Data" with Cormorant 38px title. Breadcrumbs component renders at top. Old PersonaList is deprecated but preserved. `pnpm build` passes.
  </done>
</task>

</tasks>

<verification>
- `pnpm build` passes with no errors
- Personas page renders three-column layout (220px sidebar + fluid center + 280px sidebar) on desktop
- On mobile (< 1024px), sidebars are hidden and center grid fills full width
- Industry filter checkboxes in left sidebar filter the persona cards (client-side)
- Data freshness "Past Week" filters to personas used within 7 days; "Live" shows all
- Page header: "Saved Personas & Living Data" in Cormorant 38px, subtitle in 14px tertiary text
- Empty state renders when no personas exist
- PersonaList component is deprecated with comment but not deleted
- Old PersonaFormDialog + actions.ts are completely unchanged
</verification>

<success_criteria>
The Saved Personas page is fully rebuilt to match Screen C mockup. Three-column layout with left sidebar (Library Stats + filters), center card grid (rich persona cards with sparklines + Create New CTA), and right sidebar (Live Data Stream). All 6 PB-* requirements covered. Build passes clean.
</success_criteria>

<output>
After completion, create `.planning/phases/10-saved-personas-screen-c/10-03-SUMMARY.md`
</output>
