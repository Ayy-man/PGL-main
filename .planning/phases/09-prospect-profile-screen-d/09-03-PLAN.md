# Plan 09-03: Refactor Full Profile Page (ProfileView + page.tsx)

```yaml
wave: 2
depends_on:
  - 09-01
  - 09-02
files_modified:
  - src/components/prospect/profile-view.tsx
  - src/app/[orgId]/prospects/[prospectId]/page.tsx
autonomous: true
requirements:
  - PROF-01
  - PROF-02
  - PROF-03
  - PROF-04
  - PROF-05
  - PROF-06
  - PROF-07
  - PROF-08
  - PROF-09
  - PROF-10
```

## Goal

Rebuild ProfileView to use the two-column layout + tab bar from the design system spec (Section 4c), composing the sub-components built in Plans 09-01 and 09-02. Update page.tsx to add activity log query and pass `orgId` + `activityEntries` to ProfileView. Add Breadcrumbs at the top.

## must_haves

- ProfileView has Breadcrumbs bar at top with "Search Results" back-link and prospect name as current page
- ProfileView has ProfileHeader component below breadcrumbs
- ProfileView has sticky ProfileTabs bar below header
- ProfileView has two-column layout: Left w-[340px] ActivityTimeline + Right flex-1 tab content
- Tab content switches between Overview, Activity, SEC Filings, Enrichment, Notes, Lists
- Overview tab shows: info grid (2x3), AI Insight gold-border block, recent SEC transactions (top 5), contact section
- page.tsx queries `activity_logs` table for this prospect and passes results to ProfileView
- page.tsx passes `orgId` to ProfileView for breadcrumb back-link construction
- All card containers use `surface-card` utility class instead of `bg-card` + inline gradient style
- LookalikeDiscovery accessible via "Find Lookalikes" button in ProfileHeader (not inline section)

## Tasks

<task id="09-03-T1">
**Update `src/app/[orgId]/prospects/[prospectId]/page.tsx` — Add activity query + pass orgId**

Modify the Server Component page.tsx:

1. Add activity log query after the existing list_members query:
```typescript
const { data: activityEntries } = await supabase
  .from("activity_logs")
  .select("id, action_type, user_id, created_at, metadata")
  .eq("target_id", prospectId)
  .eq("target_type", "prospect")
  .order("created_at", { ascending: false })
  .limit(20);
```

2. Extract `orgId` from params (already destructured `prospectId`, add `orgId`):
```typescript
const { orgId, prospectId } = await params;
```

3. Pass new props to ProfileView:
```tsx
<ProfileView
  prospect={prospect}
  enrichmentSourceStatus={enrichmentSourceStatus}
  listMemberships={formattedListMemberships}
  isStale={isStale}
  orgId={orgId}
  activityEntries={activityEntries ?? []}
/>
```

4. Keep all existing logic (auth, enrichment trigger, list memberships) unchanged.
</task>

<task id="09-03-T2">
**Rewrite `src/components/prospect/profile-view.tsx` — Two-column layout + tabs**

Complete structural refactor of ProfileView. The component currently renders a linear vertical stack of sections. Replace with:

**Updated Props interface:**
```typescript
interface ProfileViewProps {
  prospect: Prospect;
  enrichmentSourceStatus: Record<string, SourceStatus>;
  listMemberships: ListMembership[];
  isStale: boolean;
  orgId: string;
  activityEntries: Array<{
    id: string;
    action_type: string;
    user_id: string;
    created_at: string;
    metadata?: Record<string, unknown>;
  }>;
}
```

**Component structure (top to bottom):**

1. **Breadcrumbs**: Import `Breadcrumbs` from `@/components/ui/breadcrumbs`. Items: `[{ label: "Search Results", href: \`/${orgId}/search\` }, { label: prospect.full_name }]`. Wrap in `px-14 pt-6`.

2. **ProfileHeader**: Import from `./profile-header`. Pass prospect, isStale, orgId, and callback handlers.

3. **ProfileTabs**: Import from `./profile-tabs`. Use `useState` for activeTab, default to "overview".

4. **Two-column layout**: `flex gap-8 p-14`
   - Left column: `w-[340px] shrink-0` — render `<ActivityTimeline events={activityEntries} />`
   - Right column: `flex-1 min-w-0` — conditionally render tab content based on activeTab

5. **Tab content (right column):**
   - `"overview"`: Overview tab with:
     - Info grid: `grid grid-cols-2 md:grid-cols-3 gap-4` with cells for Title, Company, Location, Work Email, Work Phone, LinkedIn — each cell: `surface-card rounded-[14px] p-4`, label `text-xs uppercase tracking-wider text-muted-foreground`, value `text-sm font-medium text-foreground`
     - AI Insight block: gold left-border block (existing pattern, move from current code)
     - Contact section: work + personal contact info (move from current code, replace `bg-card` with `surface-card`)
     - Recent SEC transactions (top 5): reuse data from prospect.insider_data, render 5 rows per slide-over pattern
   - `"activity"`: Full activity table with columns: Time (font-mono muted), User, Action (badge), Details
   - `"sec-filings"`: `<SECFilingsTable>` component
   - `"enrichment"`: `<EnrichmentTab>` component
   - `"notes"`: `<NotesTab>` component
   - `"lists"`: `<ListsTab>` component

6. **LookalikeDiscovery**: Triggered by "Find Lookalikes" button in ProfileHeader. Use `useState` to toggle a modal/section below tabs. Import existing LookalikeDiscovery component.

**Migration checklist:**
- Replace ALL `bg-card` + `style={{ background: "var(--bg-card-gradient)" }}` with `surface-card`
- Replace ALL `rounded-lg border bg-card p-6` cards with `surface-card rounded-[14px] p-6`
- Remove old EnrichmentStatus inline import (now in tab)
- Remove old WealthSignals inline import (overview tab handles SEC; WealthSignals refactored in Plan 09-04)
- Remove old Lists table section (replaced by ListsTab)
- Remove inline `availableLists` mock array (lists come from props)
- Keep `"use client"` directive
- Remove `handleExport` placeholder
</task>

## Verification

- [ ] `pnpm tsc --noEmit` passes with no errors
- [ ] page.tsx queries `activity_logs` and passes results to ProfileView
- [ ] page.tsx passes `orgId` to ProfileView
- [ ] ProfileView renders Breadcrumbs > ProfileHeader > ProfileTabs > two-column layout
- [ ] Left column (340px) shows ActivityTimeline
- [ ] Right column shows tab content that switches on tab click
- [ ] Overview tab shows info grid + AI Insight + contact section + recent SEC
- [ ] All card containers use `surface-card` utility (no `bg-card` + inline gradient)
- [ ] No raw zinc-*, no inline hex, no `font-cormorant`
- [ ] LookalikeDiscovery accessible via button (not always-visible section)
