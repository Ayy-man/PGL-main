---
phase: 12-export-log
plan: 02
type: execute
wave: 2
depends_on: [12-01]
files_modified: []
autonomous: true
requirements: [EXP-01, EXP-02, EXP-03, EXP-04, ACT-01, ACT-03]

must_haves:
  truths:
    - "pnpm build passes clean with no TypeScript errors in new files"
    - "All 6 requirement IDs are traceable to implemented code"
    - "Design system compliance verified across all new files"
    - "No raw Tailwind color classes in any new file"
  artifacts:
    - path: "src/app/[orgId]/exports/page.tsx"
      provides: "Verified export log page"
    - path: "src/app/[orgId]/exports/components/export-log-client.tsx"
      provides: "Verified export log client"
    - path: "src/app/[orgId]/exports/components/export-stat-cards.tsx"
      provides: "Verified stat cards"
  key_links:
    - from: "src/components/layout/nav-items.tsx"
      to: "/{orgId}/exports"
      via: "NAV_ITEMS href"
      pattern: "exports"
---

<objective>
Verify the Export Log build: run pnpm build, audit design system compliance across all new files, and validate every Phase 12 requirement ID is traceable to code.

Purpose: Catch build errors, design system violations, and missing requirements before marking Phase 12 complete.

Output: Verified build + compliance audit results documented in summary.
</objective>

<execution_context>
@/Users/aymanbaig/.claude/get-shit-done/workflows/execute-plan.md
@/Users/aymanbaig/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/12-export-log/12-01-SUMMARY.md
@design-system/MASTER.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run pnpm build and fix any errors</name>
  <files></files>
  <action>
Run `pnpm build` from the project root. Analyze output for:

1. **TypeScript errors** in any of the Phase 12 files:
   - `src/components/layout/nav-items.tsx`
   - `src/app/[orgId]/exports/page.tsx`
   - `src/app/[orgId]/exports/components/export-stat-cards.tsx`
   - `src/app/[orgId]/exports/components/export-log-client.tsx`

2. **Build failures** (not warnings). Expected informational messages:
   - `img` element warnings are pre-existing linting warnings (not errors)
   - "Dynamic server usage" for cookie-using API routes are expected and informational

If TypeScript or build errors exist in Phase 12 files, fix them immediately. Common issues to watch for:
- Missing imports (date-fns format, Lucide icons, component imports)
- Type mismatches on `metadata` field access (needs casting through `Record<string, unknown>`)
- Async params pattern: `params: Promise<{ orgId: string }>` for Next.js 15
- Missing "use client" directive on client components

If build passes clean, proceed to Task 2.
  </action>
  <verify>
    <automated>cd /Users/aymanbaig/Desktop/Manual\ Library/Phronesis-main && pnpm build 2>&1 | tail -20</automated>
  </verify>
  <done>pnpm build completes successfully with no TypeScript errors in Phase 12 files</done>
</task>

<task type="auto">
  <name>Task 2: Design system compliance audit + requirement traceability</name>
  <files></files>
  <action>
**Design System Compliance Audit:**

Read each of the 4 files created/modified in Plan 01 and verify against MASTER.md rules:

1. **No raw Tailwind color classes:** Search for `zinc-`, `gray-`, `emerald-`, `yellow-`, `slate-`, `blue-`, `indigo-`, `purple-`, `red-`, `green-` in className strings. If found, replace with CSS variable equivalents.

2. **font-serif only for headings:** Verify `font-serif` is used only on h1, h2, h3, card titles, and stat card values — NOT on body text, labels, or buttons. Verify `font-cormorant` does NOT appear (bypasses variable system).

3. **surface-card on all cards:** Verify Card component is used (which applies `surface-card` automatically) — no raw flat `bg-` on card containers.

4. **Lucide icons only:** Verify no Material Symbols, Heroicons, Font Awesome, or emoji icons. Only `lucide-react` imports.

5. **No scale transforms on hover:** Search for `scale-` in className strings. Must not exist.

6. **CSS variable colors via inline style:** Verify gold accents use `var(--gold-primary)`, `var(--gold-text)`, etc. — never `#d4af37` inline or `text-yellow-*`.

7. **cursor-pointer on all clickable elements:** Verify buttons, links, and clickable elements have `cursor-pointer` class.

8. **border-radius 14px on cards, 8px on buttons/inputs:** Verify via Card component (automatic) and explicit classes.

9. **Typography scale:** h1 at 38px/font-serif, body at 13px/font-sans, labels at 11px uppercase tracking-[1px], data at font-mono.

10. **Table compliance:** Verify using Table/TableHead/TableRow/TableCell components (already design-system compliant).

If any violations found, fix them directly.

**Requirement Traceability:**

Verify each requirement ID maps to implemented code:

| ID | Requirement | Verification |
|----|-------------|-------------|
| EXP-01 | User can export list to CSV | Re-download button calls `/api/export/csv?listId=` in export-log-client.tsx |
| EXP-02 | CSV export uses streaming | Re-download hits the existing streaming route (no new code needed) |
| EXP-03 | Export includes UTF-8 encoding | Re-download hits the existing BOM-enabled route (no new code needed) |
| EXP-04 | Export triggers activity log entry | Export log page reads `csv_exported` entries from activity_log table |
| ACT-01 | System logs csv_exported action type | Page filters `action_type = csv_exported` in both server query and client fetch |
| ACT-03 | Activity log viewable by tenant admin | page.tsx checks role is tenant_admin or super_admin before rendering |

For each: grep the relevant file to confirm the pattern exists. Log results.

**Nav route verification:**

Confirm `src/components/layout/nav-items.tsx` contains the Exports entry and that `src/app/[orgId]/exports/page.tsx` exists as a valid Next.js route.
  </action>
  <verify>
    <automated>cd /Users/aymanbaig/Desktop/Manual\ Library/Phronesis-main && grep -rn "zinc-\|gray-\|emerald-\|yellow-\|slate-\|font-cormorant\|scale-\[" src/app/\[orgId\]/exports/ src/components/layout/nav-items.tsx 2>/dev/null | head -20; echo "---"; grep -c "exports" src/components/layout/nav-items.tsx</automated>
  </verify>
  <done>
    - All 10 design system compliance items pass (or violations fixed)
    - All 6 requirement IDs traced to implemented code
    - Exports nav item confirmed in nav-items.tsx
    - No raw Tailwind color classes in new files
  </done>
</task>

</tasks>

<verification>
1. `pnpm build` passes clean
2. Zero raw Tailwind color classes in Phase 12 files
3. `font-serif` used correctly (headings only)
4. Lucide icons only — no Material Symbols or emoji
5. All 6 requirement IDs traceable to code
6. Exports nav item present in sidebar
</verification>

<success_criteria>
- pnpm build passes with no errors
- 10/10 design system compliance items pass
- 6/6 requirement IDs verified
- Phase 12 complete — Export Log page fully built and verified
</success_criteria>

<output>
After completion, create `.planning/phases/12-export-log/12-02-SUMMARY.md`
</output>
